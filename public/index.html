<!DOCTYPE html>
<html>
  <head>
    <!-- twitter bootstrap CSS stylesheet - included to make things pretty, not needed or used by cornerstone -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.6/css/bootstrap.css"
      rel="stylesheet"
    />
    <style>
      .cornerstone-enabled-image {
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        cursor: default;
      }
    </style>
    <script
      type="text/javascript"
      src="https://unpkg.com/cornerstone-core"
    ></script>
    <script
      type="text/javascript"
      src="https://unpkg.com/dicom-parser@1.8.3/dist/dicomParser.min.js"
    ></script>
  </head>
  <body>
    <div class="container">
      <div class="page-header">
        <h1>Example of displaying a DICOM P10 image using Cornerstone</h1>
      </div>

      <br />
      <div class="row">
        <div class="col-md-6">
          <div
            style="width:512px;height:512px;position:relative;color: white;display:inline-block;border-style:solid;border-color:black;"
            oncontextmenu="return false"
            class="disable-selection noIbar"
            unselectable="on"
            onselectstart="return false;"
            onmousedown="return false;"
          >
            <div
              id="dicomImage"
              style="width:512px;height:512px;top:0px;left:0px; position:absolute"
            ></div>
          </div>
        </div>
      </div>
    </div>
  </body>

  <script>
    window.cornerstoneWADOImageLoader.webWorkerManager.initialize({
      maxWebWorkers: 4,
      startWebWorkersOnDemand: true,
      webWorkerTaskPaths: [],
      taskConfiguration: {
        decodeTask: {
          initializeCodecsOnStartup: false,
          usePDFJS: false,
          strict: true,
        },
      },
    });

    cornerstoneWADOImageLoader.external.dicomParser = dicomParser;
    cornerstoneWADOImageLoader.external.cornerstone = cornerstone;

    cornerstoneWADOImageLoader.configure({
      beforeSend: function(xhr) {
        // Add custom headers here (e.g. auth tokens)
        //xhr.setRequestHeader('APIKEY', 'my auth token');
      },
    });

    const element = document.querySelector('#dicomImage');

    cornerstone.enable(element);

    cornerstone
      .loadImage('dicomweb:http://localhost:3000/1.dcm')
      .then(image => {
        console.log('image from decoder: ', image);
        cornerstone.displayImage(element, image);
      });
  </script>
</html>
