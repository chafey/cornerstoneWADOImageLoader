{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///cornerstoneWADOImageLoader.min.js","webpack:///webpack/bootstrap 3f162b5b26c62318ee42","webpack:///external {\"commonjs\":\"jquery\",\"commonjs2\":\"jquery\",\"amd\":\"jquery\",\"root\":\"$\"}","webpack:///external {\"commonjs\":\"cornerstone-core\",\"commonjs2\":\"cornerstone-core\",\"amd\":\"cornerstone-core\",\"root\":\"cornerstone\"}","webpack:///./imageLoader/internal/index.js","webpack:///./version.js","webpack:///./imageLoader/wadors/metaData/getValue.js","webpack:///./imageLoader/wadouri/parseImageId.js","webpack:///external {\"commonjs\":\"dicom-parser\",\"commonjs2\":\"dicom-parser\",\"amd\":\"dicom-parser\",\"root\":\"dicomParser\"}","webpack:///./imageLoader/createImage.js","webpack:///./imageLoader/wadors/metaDataManager.js","webpack:///./imageLoader/wadouri/dataSetCacheManager.js","webpack:///./imageLoader/colorSpaceConverters/index.js","webpack:///./imageLoader/convertColorSpace.js","webpack:///./imageLoader/decodeImageFrame.js","webpack:///./imageLoader/decodeJPEGBaseline8BitColor.js","webpack:///./imageLoader/events.js","webpack:///./imageLoader/getImageFrame.js","webpack:///./imageLoader/getMinMax.js","webpack:///./imageLoader/isColorImage.js","webpack:///./imageLoader/isJPEGBaseline8BitColor.js","webpack:///./imageLoader/webWorkerManager.js","webpack:///./imageLoader/internal/options.js","webpack:///./imageLoader/wadors/findIndexOfString.js","webpack:///./imageLoader/wadors/getPixelData.js","webpack:///./imageLoader/wadors/metaData/getNumberValue.js","webpack:///./imageLoader/wadors/metaData/getNumberValues.js","webpack:///./imageLoader/wadouri/fileManager.js","webpack:///./imageLoader/wadouri/getEncapsulatedImageFrame.js","webpack:///./imageLoader/wadouri/getUncompressedImageFrame.js","webpack:///./imageLoader/wadouri/loadFileRequest.js","webpack:///./imageLoader/wadouri/metaData/getImagePixelModule.js","webpack:///./imageLoader/wadouri/metaData/getLUTs.js","webpack:///./imageLoader/wadouri/metaData/getModalityLUTOutputPixelRepresentation.js","webpack:///./imageLoader/wadouri/metaData/getNumberValues.js","webpack:///./imageLoader/wadouri/unpackBinaryFrame.js","webpack:///./imageLoader/configure.js","webpack:///./imageLoader/wadors/index.js","webpack:///./imageLoader/wadouri/index.js","webpack:///./imageLoader/colorSpaceConverters/convertPALETTECOLOR.js","webpack:///./imageLoader/colorSpaceConverters/convertRGBColorByPixel.js","webpack:///./imageLoader/colorSpaceConverters/convertRGBColorByPlane.js","webpack:///./imageLoader/colorSpaceConverters/convertYBRFullByPixel.js","webpack:///./imageLoader/colorSpaceConverters/convertYBRFullByPlane.js","webpack:///./imageLoader/index.js","webpack:///./imageLoader/internal/xhrRequest.js","webpack:///./imageLoader/wadors/loadImage.js","webpack:///./imageLoader/wadors/metaData/getNumberString.js","webpack:///./imageLoader/wadors/metaData/index.js","webpack:///./imageLoader/wadors/metaData/metaDataProvider.js","webpack:///./imageLoader/wadouri/loadImage.js","webpack:///./imageLoader/wadouri/metaData/index.js","webpack:///./imageLoader/wadouri/metaData/metaDataProvider.js"],"names":["root","factory","exports","module","require","define","amd","this","__WEBPACK_EXTERNAL_MODULE_0__","__WEBPACK_EXTERNAL_MODULE_1__","__WEBPACK_EXTERNAL_MODULE_6__","modules","__webpack_require__","moduleId","installedModules","i","l","call","m","c","value","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","internal","xhrRequest","getOptions","setOptions","undefined","_xhrRequest","_xhrRequest2","obj","default","_options","getValue","element","index","defaultValue","Value","length","parseImageId","imageId","firstColonIndex","indexOf","url","substring","frameIndex","frame","frameStr","substr","parseInt","scheme","_interopRequireDefault","isModalityLUTForDisplay","sopClassUid","setPixelDataType","imageFrame","bitsAllocated","pixelRepresentation","pixelData","Uint16Array","Int16Array","Uint8Array","createImage","transferSyntax","options","canvas","document","createElement","deferred","_jquery2","Deferred","_getImageFrame2","_decodeImageFrame2","then","imagePlaneModule","cornerstone","metaData","voiLutModule","modalityLutModule","sopCommonModule","isColorImage","_isColorImage2","photometricInterpretation","_isJPEGBaseline8BitColor2","height","rows","width","columns","context","getContext","imageData","createImageData","_convertColorSpace2","data","image","color","columnPixelSpacing","pixelSpacing","intercept","rescaleIntercept","invert","minPixelValue","smallestPixelValue","maxPixelValue","largestPixelValue","render","rowPixelSpacing","sizeInBytes","slope","rescaleSlope","windowCenter","windowWidth","decodeTimeInMS","getPixelData","renderColorImage","getCanvas","lastImageIdDrawn","putImageData","renderGrayscaleImage","minMax","_getMinMax2","min","max","modalityLUTSequence","sopClassUID","modalityLUT","voiLUTSequence","voiLUT","maxVoi","minVoi","resolve","promise","_jquery","_getImageFrame","_decodeImageFrame","_isColorImage","_convertColorSpace","_getMinMax","_isJPEGBaseline8BitColor","_cornerstoneCore","newObj","key","add","metadata","imageIds","remove","purge","isLoaded","uri","loadedDataSets","dataSet","load","loadRequest","alreadyLoadedpromise","cacheCount","promises","loadDeferred","dicomPart10AsArrayBuffer","byteArray","dicomParser","parseDicom","error","reject","_events2","trigger","action","always","unload","_dicomParser","_internal","_events","_convertRGBColorByPixel","_convertRGBColorByPlane","_convertYBRFullByPixel","_convertYBRFullByPlane","_convertPALETTECOLOR","convertRGB","rgbaBuffer","planarConfiguration","_colorSpaceConverters","convertRGBColorByPixel","convertRGBColorByPlane","convertYBRFull","convertYBRFullByPixel","convertYBRFullByPlane","convertColorSpace","convertPALETTECOLOR","Error","addDecodeTask","priority","transferList","transferPixelData","buffer","_webWorkerManager2","addTask","decodeImageFrame","samplesPerPixel","_decodeJPEGBaseline8BitColor2","_webWorkerManager","_decodeJPEGBaseline8BitColor","arrayBufferToString","binaryToString","String","fromCharCode","apply","Array","slice","binary","decodeURIComponent","escape","_error","URIError","decodeJPEGBaseline8BitColor","start","Date","getTime","imgBlob","Blob","type","r","FileReader","readAsBinaryString","readAsArrayBuffer","onload","img","Image","drawImage","getImageData","end","onerror","src","window","btoa","result","events","getImageFrame","imagePixelModule","redPaletteColorLookupTableDescriptor","greenPaletteColorLookupTableDescriptor","bluePaletteColorLookupTableDescriptor","redPaletteColorLookupTableData","greenPaletteColorLookupTableData","bluePaletteColorLookupTableData","getMinMax","storedPixelData","storedPixel","numPixels","Math","photoMetricInterpretation","isJPEGBaseline8BitColor","startTaskOnWebWorker","tasks","webWorkers","status","task","shift","statistics","totalTimeDelayedInMS","added","worker","postMessage","taskType","workerIndex","numTasksExecuting","config","maxWebWorkers","spawnWebWorker","handleMessageFromWorker","msg","numTasksCompleted","totalTaskTimeInMS","Worker","webWorkerPath","push","addEventListener","initialize","configObject","defaultConfig","navigator","hardwareConcurrency","startWebWorkersOnDemand","loadWebWorkerTask","sourcePath","taskConfig","webWorkerTaskPaths","taskConfiguration","assign","arguments","taskId","nextTaskId","splice","setTaskPriority","cancelTask","reason","getStatistics","numWebWorkers","numTasksQueued","decodeTask","loadCodecsOnStartup","initializeCodecsOnStartup","codecsPath","usePDFJS","newOptions","beforeSend","imageCreated","checkToken","token","dataOffset","endIndex","stringToUint8Array","str","uint","j","charCodeAt","findIndexOfString","offset","findBoundary","header","findContentType","trim","uint8ArrayToString","mediaType","headers","accept","imageFrameAsArrayBuffer","response","tokenIndex","_findIndexOfString2","split","boundary","contentType","_findIndexOfString","getNumberValue","_getValue2","parseFloat","_getValue","getNumberValues","minimumLength","values","file","files","framesAreFragmented","intString","elements","x7fe00010","fragments","getEncapsulatedImageFrame","basicOffsetTable","readEncapsulatedImageFrame","createJPEGBasicOffsetTable","readEncapsulatedPixelDataFromFragments","getUncompressedImageFrame","pixelDataElement","uint16","pixelDataOffset","pixelsPerFrame","frameOffset","_unpackBinaryFrame2","_unpackBinaryFrame","loadFileRequest","parsedImageId","_parseImageId2","fileIndex","_fileManager2","fileReader","e","target","_parseImageId","_fileManager","getLutDescriptor","tag","getLutData","lutDataSet","lutDescriptor","lut","lutData","numLutEntries","populatePaletteColorLut","x00281101","populateSmallestLargestPixelValues","int16","getImagePixelModule","string","bitsStored","highBit","pixelAspectRatio","getLUT","numLUTEntries","firstValueMapped","numBitsPerEntry","id","getLUTs","lutSequence","items","luts","getMinStoredPixelValue","getModalityLUTOutputPixelRepresentation","floatString","x00283000","valueAsString","isBitSet","byte","bitPos","unpackBinaryFrame","bytePos","floor","configure","_metaData","_getPixelData","_getPixelData2","_metaDataManager","_metaDataManager2","_loadImage","_loadImage2","getNumberString","metaDataProvider","loadImage","metaDataManager","_dataSetCacheManager","_dataSetCacheManager2","_getEncapsulatedImageFrame","_getEncapsulatedImageFrame2","_getUncompressedImageFrame","_getUncompressedImageFrame2","_loadFileRequest","_loadFileRequest2","dataSetCacheManager","fileManager","palIndex","rgbaIndex","rData","gData","bData","len","rgbIndex","rIndex","gIndex","bIndex","ybrIndex","y","cb","cr","yIndex","cbIndex","crIndex","keys","forEach","_wadouri","_wadors","_configure","_createImage","_version","xhr","XMLHttpRequest","open","responseType","setRequestHeader","onreadystatechange","readyState","onprogress","oProgress","lengthComputable","loaded","total","percentComplete","round","send","getTransferSyntaxForContentType","_createImage2","loadTimeInMS","fail","registerImageLoader","_getNumberString","_getNumberValue","_getNumberValues","_metaDataProvider","_interopRequireWildcard","modality","seriesInstanceUID","seriesNumber","_getNumberValue2","studyInstanceUID","seriesDate","parseDA","seriesTime","parseTM","patientAge","patientSize","patientWeight","_getNumberValues2","imageOrientationPatient","imagePositionPatient","sliceThickness","sliceLocation","rescaleType","sopInstanceUID","radiopharmaceuticalInfo","radiopharmaceuticalStartTime","radionuclideTotalDose","radionuclideHalfLife","addProvider","addDecache","decache","encapsulatedPixelData","loadImageFromPromise","dataSetPromise","sharedCacheKey","loadEnd","totalTimeInMS","getLoaderForScheme","loader","_getImagePixelModule","_getLUTs","_getModalityLUTOutputPixelRepresentation","frameOfReferenceUID","_getImagePixelModule2","_getLUTs2","modalityLUTOutputPixelRepresentation","_getModalityLUTOutputPixelRepresentation2","x00283010","x00540016","firstRadiopharmaceuticalInfoDataSet"],"mappings":";CAAA,SAAAA,EAAAC,GACA,gBAAAC,UAAA,gBAAAC,QACAA,OAAAD,QAAAD,EAAAG,QAAA,UAAAA,QAAA,oBAAAA,QAAA,iBACA,kBAAAC,gBAAAC,IACAD,OAAA,0EAAAJ,GACA,gBAAAC,SACAA,QAAA,2BAAAD,EAAAG,QAAA,UAAAA,QAAA,oBAAAA,QAAA,iBAEAJ,EAAA,2BAAAC,EAAAD,EAAA,EAAAA,EAAA,YAAAA,EAAA,cACCO,KAAA,SAAAC,EAAAC,EAAAC,GACD,MCCgB,UAAUC,GCP1B,QAAAC,GAAAC,GAGA,GAAAC,EAAAD,GACA,MAAAC,GAAAD,GAAAX,OAGA,IAAAC,GAAAW,EAAAD,IACAE,EAAAF,EACAG,GAAA,EACAd,WAUA,OANAS,GAAAE,GAAAI,KAAAd,EAAAD,QAAAC,IAAAD,QAAAU,GAGAT,EAAAa,GAAA,EAGAb,EAAAD,QAvBA,GAAAY,KA+DA,OAnCAF,GAAAM,EAAAP,EAGAC,EAAAO,EAAAL,EAGAF,EAAAG,EAAA,SAAAK,GAA2C,MAAAA,IAG3CR,EAAAS,EAAA,SAAAnB,EAAAoB,EAAAC,GACAX,EAAAY,EAAAtB,EAAAoB,IACAG,OAAAC,eAAAxB,EAAAoB,GACAK,cAAA,EACAC,YAAA,EACAC,IAAAN,KAMAX,EAAAkB,EAAA,SAAA3B,GACA,GAAAoB,GAAApB,KAAA4B,WACA,WAA2B,MAAA5B,GAAA,SAC3B,WAAiC,MAAAA,GAEjC,OADAS,GAAAS,EAAAE,EAAA,IAAAA,GACAA,GAIAX,EAAAY,EAAA,SAAAQ,EAAAC,GAAsD,MAAAR,QAAAS,UAAAC,eAAAlB,KAAAe,EAAAC,IAGtDrB,EAAAwB,EAAA,GAGAxB,IAAAyB,EAAA,MDiBM,SAAUlC,EAAQD,GEjFxBC,EAAAD,QAAAM,GFuFM,SAAUL,EAAQD,GGvFxBC,EAAAD,QAAAO,GH6FM,SAAUN,EAAQD,EAASU,GAEjC,YAGAa,QAAOC,eAAexB,EAAS,cAC7BkB,OAAO,IAETlB,EAAQoC,SAAWpC,EAAQqC,WAAarC,EAAQsC,WAAatC,EAAQuC,eAAaC,EIrGlF,IAAAC,GAAA/B,EAAA,IJyGIgC,EAIJ,SAAgCC,GAAO,MAAOA,IAAOA,EAAId,WAAac,GAAQC,QAASD,IAJ7CF,GIxG1CI,EAAAnC,EAAA,IAEM0B,GACJC,qBACAE,wBACAD,wBJ+GFtC,GI5GSuC,WJ4GYM,EAASN,WAC9BvC,EI7GqBsC,WJ6GAO,EAASP,WAC9BtC,EI9GiCqC,WJ8GZK,EAAaE,QAClC5C,EI/G6CoC,YJmHvC,SAAUnC,EAAQD,EAASU,GAEjC,YAGAa,QAAOC,eAAexB,EAAS,cAC7BkB,OAAO,IAETlB,EAAQ4C,QKpIO,ULwIT,SAAU3C,EAAQD,EAASU,GAEjC,YMhIA,SAASoC,GAAUC,EAASC,EAAOC,GAEjC,MADAD,GAAQA,GAAS,EACZD,GAIAA,EAAQG,MAITH,EAAQG,MAAMC,QAAUH,EACnBC,EAGFF,EAAQG,MAAMF,GAXZC,ENgIX1B,OAAOC,eAAexB,EAAS,cAC7BkB,OAAO,IA6BTlB,EAAQ4C,QMhJOE,GNoJT,SAAU7C,EAAQD,EAASU,GAEjC,YO/KA,SAAS0C,GAAcC,GAErB,GAAMC,GAAkBD,EAAQE,QAAQ,KACpCC,EAAMH,EAAQI,UAAUH,EAAkB,GACxCI,EAAaF,EAAID,QAAQ,UAC3BI,QAEJ,KAAoB,IAAhBD,EAAmB,CACrB,GAAME,GAAWJ,EAAIK,OAAOH,EAAa,EAEzCC,GAAQG,SAASF,EAAU,IAC3BJ,EAAMA,EAAIK,OAAO,EAAGH,EAAa,GAGnC,OACEK,OAAQV,EAAQQ,OAAO,EAAGP,GAC1BE,MACAG,SPiKJpC,OAAOC,eAAexB,EAAS,cAC7BkB,OAAO,IAyBTlB,EAAQ4C,QOvLOQ,GP2LT,SAAUnD,EAAQD,GQlNxBC,EAAAD,QAAAQ,GRwNM,SAAUP,EAAQD,EAASU,GAEjC,YAyCA,SAASsD,GAAuBrB,GAAO,MAAOA,IAAOA,EAAId,WAAac,GAAQC,QAASD,GSxPvF,QAASsB,GAAyBC,GAGhC,MAAuB,iCAAhBA,GACgB,mCAAhBA,EAQT,QAASC,GAAkBC,GACQ,KAA7BA,EAAWC,cAC0B,IAAnCD,EAAWE,oBACbF,EAAWG,UAAY,GAAIC,aAAYJ,EAAWG,WAElDH,EAAWG,UAAY,GAAIE,YAAWL,EAAWG,WAGnDH,EAAWG,UAAY,GAAIG,YAAWN,EAAWG,WAIrD,QAASI,GAAatB,EAASkB,EAAWK,EAAgBC,GACxD,GAAMC,GAASC,SAASC,cAAc,UAChCC,EAAWC,EAAAtC,QAAEuC,WACbf,GAAa,EAAAgB,EAAAxC,SAAcS,EAkHjC,QAjHsB,EAAAgC,EAAAzC,SAAiBwB,EAAYQ,EAAgBL,EAAWO,EAAQD,GAExES,KAAK,SAAUlB,GAE3B,GAAMmB,GAAmBC,EAAYC,SAAS9D,IAAI,mBAAoB0B,GAChEqC,EAAeF,EAAYC,SAAS9D,IAAI,eAAgB0B,GACxDsC,EAAoBH,EAAYC,SAAS9D,IAAI,oBAAqB0B,GAClEuC,EAAkBJ,EAAYC,SAAS9D,IAAI,kBAAmB0B,GAC9DwC,GAAe,EAAAC,EAAAlD,SAAewB,EAAW2B,0BAI/C,MAAK,EAAAC,EAAApD,SAAwBwB,EAAYQ,KACvCT,EAAiBC,GAGbyB,GAAc,CAEhBf,EAAOmB,OAAS7B,EAAW8B,KAC3BpB,EAAOqB,MAAQ/B,EAAWgC,OAE1B,IAAMC,GAAUvB,EAAOwB,WAAW,MAC5BC,EAAYF,EAAQG,gBAAgBpC,EAAWgC,QAAShC,EAAW8B,OAEzE,EAAAO,EAAA7D,SAAkBwB,EAAYmC,GAC9BnC,EAAWmC,UAAYA,EACvBnC,EAAWG,UAAYgC,EAAUG,KAIrC,GAAMC,IACJtD,UACAuD,MAAOf,EACPgB,mBAAoBtB,EAAiBuB,aAAevB,EAAiBuB,aAAa,OAAKtE,GACvF4D,QAAShC,EAAWgC,QACpBH,OAAQ7B,EAAW8B,KACnBa,UAAWpB,EAAkBqB,iBAAmBrB,EAAkBqB,iBAAmB,EACrFC,OAAiD,gBAAzC7C,EAAW2B,0BACnBmB,cAAe9C,EAAW+C,mBAC1BC,cAAehD,EAAWiD,kBAC1BC,WAAQ9E,GACR+E,gBAAiBhC,EAAiBuB,aAAevB,EAAiBuB,aAAa,OAAKtE,GACpF0D,KAAM9B,EAAW8B,KACjBsB,YAAapD,EAAWG,UAAUpB,OAClCsE,MAAO9B,EAAkB+B,aAAe/B,EAAkB+B,aAAe,EACzEvB,MAAO/B,EAAWgC,QAClBuB,aAAcjC,EAAaiC,aAAejC,EAAaiC,aAAa,OAAKnF,GACzEoF,YAAalC,EAAakC,YAAclC,EAAakC,YAAY,OAAKpF,GACtEqF,eAAgBzD,EAAWyD,eA6B7B,IAzBAlB,EAAMmB,aAAe,iBAAM1D,GAAWG,WAGlCoC,EAAMC,OACRD,EAAMW,OAAS9B,EAAYuC,iBAC3BpB,EAAMqB,UAAY,WAChB,MAAIC,KAAqB5E,EAChByB,GAGTA,EAAOmB,OAASU,EAAMT,KACtBpB,EAAOqB,MAAQQ,EAAMP,QACLtB,EAAOwB,WAAW,MAE1B4B,aAAa9D,EAAWmC,UAAW,EAAG,GAC9C0B,EAAmB5E,EAEZyB,KAIT6B,EAAMW,OAAS9B,EAAY2C,yBAID3F,KAAxBmE,EAAMO,mBAAuD1E,KAAxBmE,EAAMS,cAA6B,CAC1E,GAAMgB,IAAS,EAAAC,EAAAzF,SAAUwB,EAAWG,UAEpCoC,GAAMO,cAAgBkB,EAAOE,IAC7B3B,EAAMS,cAAgBgB,EAAOG,IAiB/B,GAbI5C,EAAkB6C,qBACpB7C,EAAkB6C,oBAAoBrF,OAAS,GAC/Cc,EAAwB2B,EAAgB6C,eACxC9B,EAAM+B,YAAc/C,EAAkB6C,oBAAoB,IAIxD9C,EAAaiD,gBACfjD,EAAaiD,eAAexF,OAAS,IACrCwD,EAAMiC,OAASlD,EAAaiD,eAAe,QAIlBnG,KAAvBmE,EAAMgB,kBAAoDnF,KAAtBmE,EAAMiB,YAC5C,GAAIjB,EAAMC,MACRD,EAAMiB,YAAc,IACpBjB,EAAMgB,aAAe,QAChB,CACL,GAAMkB,GAASlC,EAAMS,cAAgBT,EAAMc,MAAQd,EAAMI,UACnD+B,EAASnC,EAAMO,cAAgBP,EAAMc,MAAQd,EAAMI,SAEzDJ,GAAMiB,YAAciB,EAASC,EAC7BnC,EAAMgB,cAAgBkB,EAASC,GAAU,EAG7C7D,EAAS8D,QAAQpC,KAGZ1B,EAAS+D,UTqElBzH,OAAOC,eAAexB,EAAS,cAC7BkB,OAAO,GS9NT,IAAA+H,GAAAvI,EAAA,GTmOIwE,EAAWlB,EAAuBiF,GSlOtCC,EAAAxI,EAAA,ITsOI0E,EAAkBpB,EAAuBkF,GSrO7CC,EAAAzI,EAAA,ITyOI2E,EAAqBrB,EAAuBmF,GSxOhDC,EAAA1I,EAAA,IT4OIoF,EAAiB9B,EAAuBoF,GS3O5CC,EAAA3I,EAAA,IT+OI+F,EAAsBzC,EAAuBqF,GS9OjDC,EAAA5I,EAAA,ITkPI2H,EAAcrE,EAAuBsF,GSjPzCC,EAAA7I,EAAA,ITqPIsF,EAA4BhC,EAAuBuF,GSpPvDC,EAAA9I,EAAA,GAAY8E,ET0PZ,SAAiC7C,GAAO,GAAIA,GAAOA,EAAId,WAAc,MAAOc,EAAc,IAAI8G,KAAa,IAAW,MAAP9G,EAAe,IAAK,GAAI+G,KAAO/G,GAAWpB,OAAOS,UAAUC,eAAelB,KAAK4B,EAAK+G,KAAMD,EAAOC,GAAO/G,EAAI+G,GAAgC,OAAtBD,GAAO7G,QAAUD,EAAY8G,GAFxND,GStPtCvB,EAAmB,ET4YvBjI,GAAQ4C,QS1PO+B,GT8PT,SAAU1E,EAAQD,EAASU,GAEjC,YUvZA,SAASiJ,GAAKtG,EAASuG,GACrBC,EAASxG,GAAWuG,EAGtB,QAASjI,GAAK0B,GACZ,MAAOwG,GAASxG,GAGlB,QAASyG,GAAQzG,GACfwG,EAASxG,OAAWb,GAGtB,QAASuH,KACPF,KV6YFtI,OAAOC,eAAexB,EAAS,cAC7BkB,OAAO,GU7ZT,IAAI2I,KVmbJ7J,GAAQ4C,SUhaN+G,MACAhI,MACAmI,SACAC,UVsaI,SAAU9J,EAAQD,EAASU,GAEjC,YAuBA,SAASsD,GAAuBrB,GAAO,MAAOA,IAAOA,EAAId,WAAac,GAAQC,QAASD,GWxcvF,QAASqH,GAAUC,GACjB,WAA+BzH,KAAxB0H,EAAeD,GAGxB,QAAStI,GAAKsI,GAEZ,GAAKC,EAAeD,GAIpB,MAAOC,GAAeD,GAAKE,QAK7B,QAASC,GAAMH,EAAKI,EAAahH,GAI/B,GAHAgH,EAAcA,gBAGVH,EAAeD,GAAM,CAEvB,GAAMK,GAAuBpF,EAAAtC,QAAEuC,UAK/B,OAHA+E,GAAeD,GAAKM,aACpBD,EAAqBvB,QAAQmB,EAAeD,GAAKE,SAE1CG,EAIT,GAAIE,EAASP,GAEX,MAAOO,GAASP,EAMlB,IAAMjB,GAAUqB,EAAYJ,EAAK5G,GAG3BoH,EAAevF,EAAAtC,QAAEuC,UAoCvB,OAlCA6D,GAAQ1D,KAAK,SAAUoF,GACrB,GAAMC,GAAY,GAAIjG,YAAWgG,GAG7BP,QAEJ,KACEA,EAAUS,EAAYC,WAAWF,GACjC,MAAOG,GAGP,WAFAL,GAAaM,OAAOD,GAKtBZ,EAAeD,IACbE,UACAI,WAAY,IAEd,EAAArF,EAAAtC,SAAAoI,EAAApI,SAAUqI,QAAQ,wBAChBhB,MACAiB,OAAQ,SACRf,QAASD,EAAeD,GAAKE,UAG/BM,EAAa1B,QAAQoB,SAEdK,GAASP,KACfkB,OAAO,iBAEDX,GAASP,KAGlBO,EAASP,GAAOQ,EAETA,EAIT,QAASW,GAAQnB,GAEXC,EAAeD,IAEsB,MADvCC,EAAeD,GAAKM,cAGlB,EAAArF,EAAAtC,SAAAoI,EAAApI,SAAUqI,QAAQ,wBAChBhB,MACAiB,OAAQ,WACRf,QAASD,EAAeD,GAAKE,gBAExBD,GAAeD,IAM5B,QAASF,KACPG,KACAM,KXgVFjJ,OAAOC,eAAexB,EAAS,cAC7BkB,OAAO,GWpcT,IAAA+H,GAAAvI,EAAA,GXycIwE,EAAWlB,EAAuBiF,GWxctCoC,EAAA3K,EAAA,GAAYkK,EXodZ,SAAiCjI,GAAO,GAAIA,GAAOA,EAAId,WAAc,MAAOc,EAAc,IAAI8G,KAAa,IAAW,MAAP9G,EAAe,IAAK,GAAI+G,KAAO/G,GAAWpB,OAAOS,UAAUC,eAAelB,KAAK4B,EAAK+G,KAAMD,EAAOC,GAAO/G,EAAI+G,GAAgC,OAAtBD,GAAO7G,QAAUD,EAAY8G,GARxN4B,GW3c1CC,EAAA5K,EAAA,GACA6K,EAAA7K,EAAA,IXgdIsK,EAAWhH,EAAuBuH,GWxclCrB,KACAM,IX6jBJxK,GAAQ4C,SWldNoH,WACAI,OACAgB,SACArB,QACApI,QXwdI,SAAU1B,EAAQD,EAASU,GAEjC,YAoDA,SAASsD,GAAuBrB,GAAO,MAAOA,IAAOA,EAAId,WAAac,GAAQC,QAASD,GAjDvFpB,OAAOC,eAAexB,EAAS,cAC7BkB,OAAO,GAGT,IAAIsK,GAA0B9K,EAAoB,GAElDa,QAAOC,eAAexB,EAAS,0BAC7B0B,YAAY,EACZC,IAAK,WACH,MAAOqC,GAAuBwH,GYjmBzB5I,UZqmBT,IAAI6I,GAA0B/K,EAAoB,GAElDa,QAAOC,eAAexB,EAAS,0BAC7B0B,YAAY,EACZC,IAAK,WACH,MAAOqC,GAAuByH,GYzmBzB7I,UZ6mBT,IAAI8I,GAAyBhL,EAAoB,GAEjDa,QAAOC,eAAexB,EAAS,yBAC7B0B,YAAY,EACZC,IAAK,WACH,MAAOqC,GAAuB0H,GYjnBzB9I,UZqnBT,IAAI+I,GAAyBjL,EAAoB,GAEjDa,QAAOC,eAAexB,EAAS,yBAC7B0B,YAAY,EACZC,IAAK,WACH,MAAOqC,GAAuB2H,GYznBzB/I,UZ6nBT,IAAIgJ,GAAuBlL,EAAoB,GAE/Ca,QAAOC,eAAexB,EAAS,uBAC7B0B,YAAY,EACZC,IAAK,WACH,MAAOqC,GAAuB4H,GYjoBzBhJ,YZyoBH,SAAU3C,EAAQD,EAASU,GAEjC,Ya3oBA,SAASmL,GAAYzH,EAAY0H,GACQ,IAAnC1H,EAAW2H,qBACb,EAAAC,EAAAC,wBAAuB7H,EAAWG,UAAWuH,IAE7C,EAAAE,EAAAE,wBAAuB9H,EAAWG,UAAWuH,GAIjD,QAASK,GAAgB/H,EAAY0H,GACI,IAAnC1H,EAAW2H,qBACb,EAAAC,EAAAI,uBAAsBhI,EAAWG,UAAWuH,IAE5C,EAAAE,EAAAK,uBAAsBjI,EAAWG,UAAWuH,GAIjC,QAASQ,GAAmBlI,EAAYmC,GACrD,GAAMuF,GAAavF,EAAUG,IAG7B,IAA6C,QAAzCtC,EAAW2B,0BACb8F,EAAWzH,EAAY0H,OAClB,IAA6C,YAAzC1H,EAAW2B,0BACpB8F,EAAWzH,EAAY0H,OAClB,IAA6C,YAAzC1H,EAAW2B,0BACpB8F,EAAWzH,EAAY0H,OAClB,IAA6C,kBAAzC1H,EAAW2B,2BACpB,EAAAiG,EAAAO,qBAAoBnI,EAAY0H,OAC3B,IAA6C,iBAAzC1H,EAAW2B,0BACpB8F,EAAWzH,EAAY0H,OAClB,IAA6C,aAAzC1H,EAAW2B,0BAGpB,KAAM,IAAIyG,OAAJ,4DAAsEpI,EAAW2B,0BAFvFoG,GAAe/H,EAAY0H,Ib+mB/BvK,OAAOC,eAAexB,EAAS,cAC7BkB,OAAO,IAETlB,EAAQ4C,QajoBgB0J,CApBxB,IAAAN,GAAAtL,EAAA,KbgsBM,SAAUT,EAAQD,EAASU,GAEjC,YAeA,SAASsD,GAAuBrB,GAAO,MAAOA,IAAOA,EAAId,WAAac,GAAQC,QAASD,Gc9sBvF,QAAS8J,GAAerI,EAAYQ,EAAgBL,EAAWM,GAC7D,GAAM6H,GAAW7H,EAAQ6H,cAAYlK,GAC/BmK,EAAe9H,EAAQ+H,mBAAqBrI,EAAUsI,YAAUrK,EAEtE,OAAOsK,GAAAlK,QAAiBmK,QACtB,cAEE3I,aACAQ,iBACAL,YACAM,WACC6H,EAAUC,GAAc3D,QAG/B,QAASgE,GAAkB5I,EAAYQ,EAAgBL,EAAWO,EAAQD,GAIxE,GAHAA,EAAUA,MAGa,sBAAnBD,EAEF,MAAO6H,GAAcrI,EAAYQ,EAAgBL,EAAWM,EACvD,IAAuB,wBAAnBD,EAET,MAAO6H,GAAcrI,EAAYQ,EAAgBL,EAAWM,EACvD,IAAuB,wBAAnBD,EAET,MAAO6H,GAAcrI,EAAYQ,EAAgBL,EAAWM,EACvD,IAAuB,2BAAnBD,EAET,MAAO6H,GAAcrI,EAAYQ,EAAgBL,EAAWM,EACvD,IAAuB,wBAAnBD,EAET,MAAO6H,GAAcrI,EAAYQ,EAAgBL,EAAWM,EACvD,IAAuB,2BAAnBD,EAKT,MAAiC,KAA7BR,EAAWC,eACoB,IAA/BD,EAAW6I,iBAAwD,IAA/B7I,EAAW6I,gBAI5CR,EAAcrI,EAAYQ,EAAgBL,EAAWM,IAHnD,EAAAqI,EAAAtK,SAA4BwB,EAAYG,EAAWO,EAIvD,IAAuB,2BAAnBF,EAET,MAAO6H,GAAcrI,EAAYQ,EAAgBL,EAAWM,EACvD,IAAuB,2BAAnBD,EAET,MAAO6H,GAAcrI,EAAYQ,EAAgBL,EAAWM,EACvD,IAAuB,2BAAnBD,EAET,MAAO6H,GAAcrI,EAAYQ,EAAgBL,EAAWM,EACvD,IAAuB,2BAAnBD,EAET,MAAO6H,GAAcrI,EAAYQ,EAAgBL,EAAWM,EACvD,IAAuB,2BAAnBD,EAET,MAAO6H,GAAcrI,EAAYQ,EAAgBL,EAAWM,EACvD,IAAuB,2BAAnBD,EAET,MAAO6H,GAAcrI,EAAYQ,EAAgBL,EAAWM,EACvD,IAAuB,2BAAnBD,EAET,MAAO6H,GAAcrI,EAAYQ,EAAgBL,EAAWM,EAgB9D,MAAM,IAAI2H,OAAJ,kCAA4C5H,GdknBpDrD,OAAOC,eAAexB,EAAS,cAC7BkB,OAAO,GctsBT,IAAAiM,GAAAzM,EAAA,Id2sBIoM,EAAqB9I,EAAuBmJ,Gc1sBhDC,EAAA1M,EAAA,Id8sBIwM,EAAgClJ,EAAuBoJ,EAoF3DpN,GAAQ4C,Qc7sBOoK,GditBT,SAAU/M,EAAQD,EAASU,GAEjC,YenyBA,SAAS2M,GAAqBR,GAC5B,MAAOS,GAAeC,OAAOC,aAAaC,MAAM,KAAMC,MAAM1L,UAAU2L,MAAMF,MAAM,GAAI/I,YAAWmI,MAGnG,QAASS,GAAgBM,GACvB,GAAI9C,SAEJ,KACE,MAAO+C,oBAAmBC,OAAOF,IACjC,MAAOG,GAEP,IADAjD,EAAQiD,YACaC,UACnB,MAAOJ,EAET,MAAM9C,IAKV,QAASmD,GAA6B7J,EAAYG,EAAWO,GAC3D,GAAMoJ,IAAQ,GAAIC,OAAOC,UACnBnJ,EAAWC,EAAAtC,QAAEuC,WAEbkJ,EAAU,GAAIC,OAAM/J,IAAcgK,KAAM,eAExCC,EAAI,GAAIC,WAsCd,YApC6BjM,KAAzBgM,EAAEE,mBACJF,EAAEG,kBAAkBN,GAEpBG,EAAEE,mBAAmBL,GAGvBG,EAAEI,OAAS,WACT,GAAMC,GAAM,GAAIC,MAEhBD,GAAID,OAAS,WACX9J,EAAOmB,OAAS4I,EAAI5I,OACpBnB,EAAOqB,MAAQ0I,EAAI1I,MACnB/B,EAAW8B,KAAO2I,EAAI5I,OACtB7B,EAAWgC,QAAUyI,EAAI1I,KACzB,IAAME,GAAUvB,EAAOwB,WAAW,KAElCD,GAAQ0I,UAAU1O,KAAM,EAAG,EAC3B,IAAMkG,GAAYF,EAAQ2I,aAAa,EAAG,EAAGH,EAAI1I,MAAO0I,EAAI5I,QACtDgJ,GAAM,GAAId,OAAOC,SAEvBhK,GAAWG,UAAYgC,EAAUG,KACjCtC,EAAWmC,UAAYA,EACvBnC,EAAWyD,eAAiBoH,EAAMf,EAClCjJ,EAAS8D,QAAQ3E,IAEnByK,EAAIK,QAAU,SAAUpE,GACtB7F,EAAS8F,OAAOD,QAEWtI,KAAzBgM,EAAEE,mBACJG,EAAIM,IAAJ,0BAAoCC,OAAOC,KAAKhC,EAAoBmB,EAAEc,SAEtET,EAAIM,IAAJ,0BAAoCC,OAAOC,KAAKb,EAAEc,SAK/CrK,EAAS+D,UfuuBlBzH,OAAOC,eAAexB,EAAS,cAC7BkB,OAAO,Ge7yBT,IAAA+H,GAAAvI,EAAA,GfkzBIwE,EAEJ,SAAgCvC,GAAO,MAAOA,IAAOA,EAAId,WAAac,GAAQC,QAASD,IAFjDsG,EAwEtCjJ,GAAQ4C,QelzBOqL,GfszBT,SAAUhO,EAAQD,EAASU,GAEjC,YAGAa,QAAOC,eAAexB,EAAS,cAC7BkB,OAAO,GgBp4BT,IAAMqO,IACJnO,KAAM,6BhBy4BRpB,GAAQ4C,QgBt4BO2M,GhB04BT,SAAUtP,EAAQD,EAASU,GAEjC,YiB94BA,SAAS8O,GAAenM,GACtB,GAAMoM,GAAmBjK,EAAYC,SAAS9D,IAAI,mBAAoB0B,EAEtE,QACE4J,gBAAiBwC,EAAiBxC,gBAClClH,0BAA2B0J,EAAiB1J,0BAC5CgG,oBAAqB0D,EAAiB1D,oBACtC7F,KAAMuJ,EAAiBvJ,KACvBE,QAASqJ,EAAiBrJ,QAC1B/B,cAAeoL,EAAiBpL,cAChCC,oBAAqBmL,EAAiBnL,oBACtC6C,mBAAoBsI,EAAiBtI,mBACrCE,kBAAmBoI,EAAiBpI,kBACpCqI,qCAAsCD,EAAiBC,qCACvDC,uCAAwCF,EAAiBE,uCACzDC,sCAAuCH,EAAiBG,sCACxDC,+BAAgCJ,EAAiBI,+BACjDC,iCAAkCL,EAAiBK,iCACnDC,gCAAiCN,EAAiBM,gCAClDxL,cAAW/B,IjB83BfjB,OAAOC,eAAexB,EAAS,cAC7BkB,OAAO,GiBp5BT,IAAAsI,GAAA9I,EAAA,GAAY8E,EjB25BZ,SAAiC7C,GAAO,GAAIA,GAAOA,EAAId,WAAc,MAAOc,EAAc,IAAI8G,KAAa,IAAW,MAAP9G,EAAe,IAAK,GAAI+G,KAAO/G,GAAWpB,OAAOS,UAAUC,eAAelB,KAAK4B,EAAK+G,KAAMD,EAAOC,GAAO/G,EAAI+G,GAAgC,OAAtBD,GAAO7G,QAAUD,EAAY8G,GAFxND,EA2B1CxJ,GAAQ4C,QiB35BO4M,GjB+5BT,SAAUvP,EAAQD,EAASU,GAEjC,YkB17Be,SAASsP,GAAWC,GASjC,IAAK,GALD3H,GAAM2H,EAAgB,GACtB1H,EAAM0H,EAAgB,GACtBC,SACEC,EAAYF,EAAgB9M,OAEzBH,EAAQ,EAAGA,EAAQmN,EAAWnN,IACrCkN,EAAcD,EAAgBjN,GAC9BsF,EAAM8H,KAAK9H,IAAIA,EAAK4H,GACpB3H,EAAM6H,KAAK7H,IAAIA,EAAK2H,EAGtB,QACE5H,MACAC,OlB46BJhH,OAAOC,eAAexB,EAAS,cAC7BkB,OAAO,IAETlB,EAAQ4C,QkBh8BgBoN,GlBw9BlB,SAAU/P,EAAQD,EAASU,GAEjC,YAGAa,QAAOC,eAAexB,EAAS,cAC7BkB,OAAO,IAGTlB,EAAQ4C,QmBj+BO,SAAUyN,GACvB,MAAsC,QAA9BA,GACwB,kBAA9BA,GAC8B,aAA9BA,GAC8B,iBAA9BA,GAC8B,oBAA9BA,GAC8B,oBAA9BA,GAC8B,YAA9BA,GAC8B,YAA9BA,InB+9BE,SAAUpQ,EAAQD,EAASU,GAEjC,YoBz+BA,SAAS4P,GAAyBlM,EAAYQ,GAG5C,GAFAA,EAAiBA,GAAkBR,EAAWQ,eAEb,IAA7BR,EAAWC,eACO,2BAAnBO,IACgC,IAA/BR,EAAW6I,iBAAwD,IAA/B7I,EAAW6I,iBACjD,OAAO,EpBs+BX1L,OAAOC,eAAexB,EAAS,cAC7BkB,OAAO,IAUTlB,EAAQ4C,QoB7+BO0N,GpBi/BT,SAAUrQ,EAAQD,EAASU,GAEjC,YqBp9BA,SAAS6P,KAEP,GAAKC,EAAMrN,OAAX,CAKA,IAAK,GAAItC,GAAI,EAAGA,EAAI4P,EAAWtN,OAAQtC,IACrC,GAA6B,UAAzB4P,EAAW5P,GAAG6P,OAAoB,CAEpCD,EAAW5P,GAAG6P,OAAS,MAGvB,IAAMC,GAAOH,EAAMI,OAEnBD,GAAKzC,OAAQ,GAAIC,OAAOC,SAGxB,IAAMa,IAAM,GAAId,OAAOC,SAcvB,OAZAyC,GAAWC,sBAAwB7B,EAAM0B,EAAKI,MAI9CN,EAAW5P,GAAG8P,KAAOA,EACrBF,EAAW5P,GAAGmQ,OAAOC,aACnBC,SAAUP,EAAKO,SACfC,YAAatQ,EACb6F,KAAMiK,EAAKjK,MACViK,EAAKhE,kBACRkE,GAAWO,oBAOXX,EAAWtN,OAASkO,EAAOC,eAC7BC,KAQJ,QAASC,GAAyBC,GAEhC,GAA0B,eAAtBA,EAAI/K,KAAKwK,SACXT,EAAWgB,EAAI/K,KAAKyK,aAAaT,OAAS,QAC1CH,QACK,CACL,GAAMrC,GAAQuC,EAAWgB,EAAI/K,KAAKyK,aAAaR,KAAKzC,KAEpDuC,GAAWgB,EAAI/K,KAAKyK,aAAaR,KAAK1L,SAAS8D,QAAQ0I,EAAI/K,KAAK4I,QAChEmB,EAAWgB,EAAI/K,KAAKyK,aAAaR,SAAOnO,GAExCqO,EAAWO,oBACXX,EAAWgB,EAAI/K,KAAKyK,aAAaT,OAAS,QAC1CG,EAAWa,mBAEX,IAAMzC,IAAM,GAAId,OAAOC,SAEvByC,GAAWc,mBAAqB1C,EAAMf,EAEtCqC,KAOJ,QAASgB,KAEP,KAAId,EAAWtN,QAAUkO,EAAOC,eAAhC,CAKA,GAAMN,GAAS,GAAIY,QAAOP,EAAOQ,cAEjCpB,GAAWqB,MACTd,SACAN,OAAQ,iBAEVM,EAAOe,iBAAiB,UAAWP,GACnCR,EAAOC,aACLC,SAAU,aACVC,YAAaV,EAAWtN,OAAS,EACjCkO,YAQJ,QAASW,GAAYC,GAInB,GAHAA,EAAeA,GAAgBC,EAG3Bb,EACF,KAAM,IAAI7E,OAAM,uCAQlB,IALA6E,EAASY,EAETZ,EAAOC,cAAgBD,EAAOC,eAAkBa,UAAUC,qBAAuB,GAG5Ef,EAAOgB,wBACV,IAAK,GAAIxR,GAAI,EAAGA,EAAIwQ,EAAOC,cAAezQ,IACxC0Q,IAUN,QAASe,GAAmBC,EAAYC,GAGtCnB,EAAOoB,mBAAmBX,KAAKS,GAG3BC,IACFnB,EAAOqB,kBAAoBnR,OAAOoR,OAAOtB,EAAOqB,kBAAmBF,GAIrE,KAAK,GAAI3R,GAAI,EAAGA,EAAI4P,EAAWtN,OAAQtC,IACrC4P,EAAW5P,GAAGmQ,OAAOC,aACnBC,SAAU,oBACVC,YAAaV,EAAWtN,OAAS,EACjCoP,aACAlB,WAcN,QAAStE,GAASmE,EAAUxK,GAAkC,GAA5BgG,GAA4BkG,UAAAzP,OAAA,OAAAX,KAAAoQ,UAAA,GAAAA,UAAA,GAAjB,EAAGjG,EAAciG,UAAA,EACvDvB,IACHW,GAGF,IAAM/M,GAAWC,EAAAtC,QAAEuC,WAGftE,QAEJ,KAAKA,EAAI,EAAGA,EAAI2P,EAAMrN,UAChBqN,EAAM3P,GAAG6L,UAAYA,GADG7L,KAM9B,GAAMgS,GAASC,GAiBf,OAdAtC,GAAMuC,OAAOlS,EAAG,GACdgS,SACA3B,WACAR,OAAQ,QACRK,OAAO,GAAI5C,OAAOC,UAClB1H,OACAzB,WACAyH,WACAC,iBAIF4D,KAGEsC,SACA7J,QAAS/D,EAAS+D,WAUtB,QAASgK,GAAiBH,GAExB,IAAK,GAF2BnG,GAAckG,UAAAzP,OAAA,OAAAX,KAAAoQ,UAAA,GAAAA,UAAA,GAAH,EAElC/R,EAAI,EAAGA,EAAI2P,EAAMrN,OAAQtC,IAChC,GAAI2P,EAAM3P,GAAGgS,SAAWA,EAAQ,CAE9B,GAAMlC,GAAOH,EAAMuC,OAAOlS,EAAG,GAAG,EAMhC,KAHA8P,EAAKjE,SAAWA,EAGX7L,EAAI,EAAGA,EAAI2P,EAAMrN,UAChBqN,EAAM3P,GAAG6L,UAAYA,GADG7L,KAS9B,MAFA2P,GAAMuC,OAAOlS,EAAG,EAAG8P,IAEZ,EAIX,OAAO,EAST,QAASsC,GAAYJ,EAAQK,GAE3B,IAAK,GAAIrS,GAAI,EAAGA,EAAI2P,EAAMrN,OAAQtC,IAChC,GAAI2P,EAAM3P,GAAGgS,SAAWA,EAAQ,CAE9B,GAAMlC,GAAOH,EAAMuC,OAAOlS,EAAG,EAI7B,OAFA8P,GAAK3H,QAAQ+B,OAAOmI,IAEb,EAIX,OAAO,EAOT,QAASC,KAKP,MAJAtC,GAAWS,cAAgBD,EAAOC,cAClCT,EAAWuC,cAAgB3C,EAAWtN,OACtC0N,EAAWwC,eAAiB7C,EAAMrN,OAE3B0N,ErBwtBTtP,OAAOC,eAAexB,EAAS,cAC7BkB,OAAO,GqBjgCT,IAAA+H,GAAAvI,EAAA,GrBsgCIwE,EAEJ,SAAgCvC,GAAO,MAAOA,IAAOA,EAAId,WAAac,GAAQC,QAASD,IAFjDsG,GqBngClC6J,EAAa,EAGXtC,KAGAC,KAEAyB,GACJZ,cAAea,UAAUC,qBAAuB,EAChDC,yBAAyB,EACzBR,cAAe,oDACfY,sBACAC,mBACEY,YACEC,qBAAqB,EACrBC,2BAA2B,EAC3BC,WAAY,8CACZC,UAAU,KAKZrC,SAEER,GACJS,cAAe,EACf8B,cAAe,EACfC,eAAgB,EAChBjC,kBAAmB,EACnBM,kBAAmB,EACnBC,kBAAmB,EACnBb,qBAAsB,ErBqxCxB9Q,GAAQ4C,SqB5gCNoP,aACAM,oBACAvF,UACAoG,gBACAH,kBACAC,erBkhCI,SAAUhT,EAAQD,EAASU,GAEjC,YsB5zCO,SAAS6B,GAAYoR,GAC1B9O,EAAU8O,EAGL,QAASrR,KACd,MAAOuC,GtB0zCTtD,OAAOC,eAAexB,EAAS,cAC7BkB,OAAO,IAETlB,EsBl0CgBuC,atBm0ChBvC,EsB/zCgBsC,YAbhB,IAAIuC,IAEF+O,WAFY,aAKZC,aALY,etB+1CR,SAAU5T,EAAQD,EAASU,GAEjC,YuBj2CA,SAASoT,GAAYC,EAAOrN,EAAMsN,GAEhC,GAAIA,EAAaD,EAAM5Q,OAASuD,EAAKvD,OACnC,OAAO,CAKT,KAAK,GAFD8Q,GAAWD,EAENnT,EAAI,EAAGA,EAAIkT,EAAM5Q,OAAQtC,IAChC,GAAIkT,EAAMlT,KAAO6F,EAAKuN,KACpB,OAAO,CAIX,QAAO,EAGT,QAASC,GAAoBC,GAG3B,IAAK,GAFCC,GAAO,GAAI1P,YAAWyP,EAAIhR,QAEvBtC,EAAI,EAAGwT,EAAIF,EAAIhR,OAAQtC,EAAIwT,EAAGxT,IACrCuT,EAAKvT,GAAKsT,EAAIG,WAAWzT,EAG3B,OAAOuT,GAGT,QAASG,GAAmB7N,EAAMyN,EAAKK,GAErCA,EAASA,GAAU,CAInB,KAAK,GAFCT,GAAQG,EAAmBC,GAExBtT,EAAI2T,EAAQ3T,EAAI6F,EAAKvD,OAAQtC,IACpC,GAAIkT,EAAM,KAAOrN,EAAK7F,IAEhBiT,EAAWC,EAAOrN,EAAM7F,GAC1B,MAAOA,EAKb,QAAQ,EvB0zCVU,OAAOC,eAAexB,EAAS,cAC7BkB,OAAO,IA8CTlB,EAAQ4C,QuBv2CO2R,GvB22CT,SAAUtU,EAAQD,EAASU,GAEjC,YAiBA,SAASsD,GAAuBrB,GAAO,MAAOA,IAAOA,EAAId,WAAac,GAAQC,QAASD,GwBt6CvF,QAAS8R,GAAcC,GACrB,IAAK,GAAI7T,GAAI,EAAGA,EAAI6T,EAAOvR,OAAQtC,IACjC,GAA+B,OAA3B6T,EAAO7T,GAAGgD,OAAO,EAAG,GACtB,MAAO6Q,GAAO7T,GAOpB,QAAS8T,GAAiBD,GACxB,IAAK,GAAI7T,GAAI,EAAGA,EAAI6T,EAAOvR,OAAQtC,IACjC,GAAgC,kBAA5B6T,EAAO7T,GAAGgD,OAAO,EAAG,IACtB,MAAO6Q,GAAO7T,GAAGgD,OAAO,IAAI+Q,OAOlC,QAASC,GAAoBnO,EAAM8N,EAAQrR,GACzCqR,EAASA,GAAU,EACnBrR,EAASA,GAAUuD,EAAKvD,OAASqR,CAGjC,KAAK,GAFDL,GAAM,GAEDtT,EAAI2T,EAAQ3T,EAAI2T,EAASrR,EAAQtC,IACxCsT,GAAO5G,OAAOC,aAAa9G,EAAK7F,GAGlC,OAAOsT,GAGT,QAASrM,GAAcmC,EAAK5G,EAASyR,GACnCA,EAAYA,GAAa,0BACzB,IAAMC,IACJC,OAAQF,GAGJ7P,EAAWC,EAAAtC,QAAEuC,UA4CnB,QA1CoB,EAAAmG,EAAAjJ,YAAW4H,EAAK5G,EAAS0R,GAEjCzP,KAAK,SAAU2P,GAGzB,GAAMC,GAAW,GAAIxQ,YAAWuQ,GAG1BE,GAAa,EAAAC,EAAAxS,SAAkBsS,EAAU,aAE3B,IAAhBC,GACFlQ,EAAS8F,OAAO,8CAElB,IAAM2J,GAASG,EAAmBK,EAAU,EAAGC,GAEzCE,EAAQX,EAAOW,MAAM,QACrBC,EAAWb,EAAaY,EAEzBC,IACHrQ,EAAS8F,OAAO,wCAElB,IAAMyJ,GAASW,EAAa,EAGtBlB,GAAW,EAAAmB,EAAAxS,SAAkBsS,EAAUI,EAAUd,IAErC,IAAdP,GACFhP,EAAS8F,OAAO,oDAIlB,IAAM5H,GAAS8Q,EAAWO,EAAS,CAGnCvP,GAAS8D,SACPwM,YAAaZ,EAAgBU,GAC7BjR,YACEG,UAAW,GAAIG,YAAWuQ,EAAyBT,EAAQrR,QAK1D8B,EAAS+D,UxBs0ClBzH,OAAOC,eAAexB,EAAS,cAC7BkB,OAAO,GwB75CT,IAAA+H,GAAAvI,EAAA,GxBk6CIwE,EAAWlB,EAAuBiF,GwBj6CtCqC,EAAA5K,EAAA,GACA8U,EAAA9U,EAAA,IxBs6CI0U,EAAsBpR,EAAuBwR,EAyFjDxV,GAAQ4C,QwBx6COkF,GxB46CT,SAAU7H,EAAQD,EAASU,GAEjC,YyBrgDA,SAAS+U,GAAgB1S,EAASC,GAChC,GAAM9B,IAAQ,EAAAwU,EAAA9S,SAASG,EAASC,EAEhC,QAAcR,KAAVtB,EAIJ,MAAOyU,YAAWzU,GzBigDpBK,OAAOC,eAAexB,EAAS,cAC7BkB,OAAO,GyB3gDT,IAAA0U,GAAAlV,EAAA,GzBghDIgV,EAEJ,SAAgC/S,GAAO,MAAOA,IAAOA,EAAId,WAAac,GAAQC,QAASD,IAF/CiT,EAcxC5V,GAAQ4C,QyBlhDO6S,GzBshDT,SAAUxV,EAAQD,EAASU,GAEjC,Y0B3hDA,SAASmV,GAAiB9S,EAAS+S,GACjC,GAAK/S,GAIAA,EAAQG,SAIT4S,GAAiB/S,EAAQG,MAAMC,OAAS2S,GAA5C,CAMA,IAAK,GAFCC,MAEGlV,EAAI,EAAGA,EAAIkC,EAAQG,MAAMC,OAAQtC,IACxCkV,EAAOjE,KAAK6D,WAAW5S,EAAQG,MAAMrC,IAGvC,OAAOkV,I1B2gDTxU,OAAOC,eAAexB,EAAS,cAC7BkB,OAAO,IAiCTlB,EAAQ4C,Q0B1iDOiT,G1B8iDT,SAAU5V,EAAQD,EAASU,GAEjC,Y2B7kDA,SAASiJ,GAAKqM,GAGZ,oBAFkBC,EAAMnE,KAAKkE,GAEG,GAGlC,QAASrU,GAAKqB,GACZ,MAAOiT,GAAMjT,GAGf,QAAS8G,GAAQ9G,GACfiT,EAAMjT,OAASR,GAGjB,QAASuH,KACPkM,K3BikDF1U,OAAOC,eAAexB,EAAS,cAC7BkB,OAAO,G2BnlDT,IAAI+U,K3BymDJjW,GAAQ4C,S2BplDN+G,MACAhI,MACAmI,SACAC,U3B0lDI,SAAU9J,EAAQD,EAASU,GAEjC,Y4B7mDA,SAASwV,GAAqB/L,GAI5B,MAHuBA,GAAQgM,UAAU,eAChBhM,EAAQiM,SAASC,UAEEC,UAAUnT,OAGzC,QAASoT,GAA2BpM,EAASzG,GAC1D,GAAIyG,EAAQiM,SAASC,UAAUG,iBAAiBrT,OAE9C,MAAOyH,GAAY6L,2BAA2BtM,EAASA,EAAQiM,SAASC,UAAW3S,EAKrF,IAAIwS,EAAoB/L,GAAU,CAChC,GAAMqM,GAAmB5L,EAAY8L,2BAA2BvM,EAASA,EAAQiM,SAASC,UAE1F,OAAOzL,GAAY6L,2BAA2BtM,EAASA,EAAQiM,SAASC,UAAW3S,EAAY8S,GAGjG,MAAO5L,GAAY+L,uCAAuCxM,EAASA,EAAQiM,SAASC,UAAW3S,G5B2lDjGnC,OAAOC,eAAexB,EAAS,cAC7BkB,OAAO,IAETlB,EAAQ4C,Q4B5mDgB2T,CAdxB,IAAAlL,GAAA3K,EAAA,GAAYkK,E5BgoDZ,SAAiCjI,GAAO,GAAIA,GAAOA,EAAId,WAAc,MAAOc,EAAc,IAAI8G,KAAa,IAAW,MAAP9G,EAAe,IAAK,GAAI+G,KAAO/G,GAAWpB,OAAOS,UAAUC,eAAelB,KAAK4B,EAAK+G,KAAMD,EAAOC,GAAO/G,EAAI+G,GAAgC,OAAtBD,GAAO7G,QAAUD,EAAY8G,GAFxN4B,IAkCpC,SAAUpL,EAAQD,EAASU,GAEjC,Y6B5pDA,SAASkW,GAA2BzM,EAASzG,GAC3C,GAAMmT,GAAmB1M,EAAQiM,SAASC,UACpChS,EAAgB8F,EAAQ2M,OAAO,aAC/B5Q,EAAOiE,EAAQ2M,OAAO,aACtB1Q,EAAU+D,EAAQ2M,OAAO,aACzB7J,EAAkB9C,EAAQ2M,OAAO,aAEjCC,EAAkBF,EAAiB7C,WACnCgD,EAAiB9Q,EAAOE,EAAU6G,EAEpCgK,QAEJ,IAAsB,IAAlB5S,EAAqB,CAEvB,IADA4S,EAAcF,EAAkBrT,EAAasT,IAC1B7M,EAAQQ,UAAUxH,OACnC,KAAM,iCAGR,OAAO,IAAIuB,YAAWyF,EAAQQ,UAAUkC,OAAQoK,EAAaD,GACxD,GAAsB,KAAlB3S,EAAsB,CAE/B,IADA4S,EAAcF,EAAkBrT,EAAasT,EAAiB,IAC3C7M,EAAQQ,UAAUxH,OACnC,KAAM,iCAGR,OAAO,IAAIuB,YAAWyF,EAAQQ,UAAUkC,OAAQoK,EAA8B,EAAjBD,GACxD,GAAsB,IAAlB3S,EAAqB,CAE9B,IADA4S,EAAcF,EAAkBrT,EAAasT,EAAiB,OAC3C7M,EAAQQ,UAAUxH,OACnC,KAAM,iCAGR,QAAO,EAAA+T,EAAAtU,SAAkBuH,EAAQQ,UAAWsM,EAAaD,GAG3D,KAAM,2B7B4nDRzV,OAAOC,eAAexB,EAAS,cAC7BkB,OAAO,G6BtqDT,IAAAiW,GAAAzW,EAAA,I7B2qDIwW,EAEJ,SAAgCvU,GAAO,MAAOA,IAAOA,EAAId,WAAac,GAAQC,QAASD,IAFtCwU,EA8CjDnX,GAAQ4C,Q6B7qDOgU,G7BirDT,SAAU3W,EAAQD,EAASU,GAEjC,YAmBA,SAASsD,GAAuBrB,GAAO,MAAOA,IAAOA,EAAId,WAAac,GAAQC,QAASD,G8B9uDvF,QAASyU,GAAiBnN,GACxB,GAAMoN,IAAgB,EAAAC,EAAA1U,SAAaqH,GAC7BsN,EAAYzT,SAASuT,EAAc7T,IAAK,IACxCwS,EAAOwB,EAAA5U,QAAYjB,IAAI4V,GAGvBtS,EAAWC,EAAAtC,QAAEuC,WAEbsS,EAAa,GAAIhJ,WASvB,OAPAgJ,GAAW7I,OAAS,SAAU8I,GAC5B,GAAMhN,GAA2BgN,EAAEC,OAAOrI,MAE1CrK,GAAS8D,QAAQ2B,IAEnB+M,EAAW9I,kBAAkBqH,GAEtB/Q,EAAS+D,U9B6sDlBzH,OAAOC,eAAexB,EAAS,cAC7BkB,OAAO,G8BnuDT,IAAA+H,GAAAvI,EAAA,G9BwuDIwE,EAAWlB,EAAuBiF,G8BvuDtC2O,EAAAlX,EAAA,G9B2uDI4W,EAAiBtT,EAAuB4T,G8B1uD5CC,EAAAnX,EAAA,I9B8uDI8W,EAAgBxT,EAAuB6T,EAwB3C7X,GAAQ4C,Q8BhvDOwU,G9BovDT,SAAUnX,EAAQD,EAASU,GAEjC,Y+B5wDA,SAASoX,GAAkB3N,EAAS4N,GAClC,GAAK5N,EAAQiM,SAAS2B,IAAyC,IAAjC5N,EAAQiM,SAAS2B,GAAK5U,OAIpD,OAAQgH,EAAQ2M,OAAOiB,EAAK,GAAI5N,EAAQ2M,OAAOiB,EAAK,GAAI5N,EAAQ2M,OAAOiB,EAAK,IAG9E,QAASC,GAAYC,EAAYF,EAAKG,GAKpC,IAAK,GAJCC,MACAC,EAAUH,EAAW7B,SAAS2B,GAC9BM,EAAgBH,EAAc,GAE3BrX,EAAI,EAAGA,EAAIwX,EAAexX,IAER,KAArBqX,EAAc,GAChBC,EAAItX,GAAKoX,EAAWnB,OAAOiB,EAAKlX,GAEhCsX,EAAItX,GAAKoX,EAAWtN,UAAU9J,EAAIuX,EAAQpE,WAI9C,OAAOmE,GAGT,QAASG,GAAyBnO,EAASsF,GAEpCtF,EAAQiM,SAASmC,YAGtB9I,EAAiBC,qCAAuCoI,EAAiB3N,EAAS,aAClFsF,EAAiBE,uCAAyCmI,EAAiB3N,EAAS,aACpFsF,EAAiBG,sCAAwCkI,EAAiB3N,EAAS,aAEnFsF,EAAiBI,+BAAiCmI,EAAW7N,EAAS,YAAasF,EAAiBC,sCACpGD,EAAiBK,iCAAmCkI,EAAW7N,EAAS,YAAasF,EAAiBE,wCACtGF,EAAiBM,gCAAkCiI,EAAW7N,EAAS,YAAasF,EAAiBG,wCAGvG,QAAS4I,GAAoCrO,EAASsF,GAGxB,IAFAtF,EAAQ2M,OAAO,cAGzCrH,EAAiBtI,mBAAqBgD,EAAQ2M,OAAO,aACrDrH,EAAiBpI,kBAAoB8C,EAAQ2M,OAAO,eAEpDrH,EAAiBtI,mBAAqBgD,EAAQsO,MAAM,aACpDhJ,EAAiBpI,kBAAoB8C,EAAQsO,MAAM,cAIvD,QAASC,GAAqBvO,GAE5B,GAAMsF,IACJxC,gBAAiB9C,EAAQ2M,OAAO,aAChC/Q,0BAA2BoE,EAAQwO,OAAO,aAC1CzS,KAAMiE,EAAQ2M,OAAO,aACrB1Q,QAAS+D,EAAQ2M,OAAO,aACxBzS,cAAe8F,EAAQ2M,OAAO,aAC9B8B,WAAYzO,EAAQ2M,OAAO,aAC3B+B,QAAS1O,EAAQ2M,OAAO,aACxBxS,oBAAqB6F,EAAQ2M,OAAO,aACpC/K,oBAAqB5B,EAAQ2M,OAAO,aACpCgC,iBAAkB3O,EAAQwO,OAAO,aAMnC,OAHAH,GAAmCrO,EAASsF,GAC5C6I,EAAwBnO,EAASsF,GAE1BA,E/B0sDTlO,OAAOC,eAAexB,EAAS,cAC7BkB,OAAO,IA4ETlB,EAAQ4C,Q+BnxDO8V,G/BuxDT,SAAUzY,EAAQD,EAASU,GAEjC,YgCl2DA,SAASqY,GAAQzU,EAAqB2T,GACpC,GAAIe,GAAgBf,EAAWnB,OAAO,YAAa,EAE7B,KAAlBkC,IACFA,EAAgB,MAElB,IAAIC,GAAmB,CAGrBA,GAD0B,IAAxB3U,EACiB2T,EAAWnB,OAAO,YAAa,GAE/BmB,EAAWQ,MAAM,YAAa,EAYnD,KAAK,GAVCS,GAAkBjB,EAAWnB,OAAO,YAAa,GAEjDqB,GACJgB,GAAI,IACJF,mBACAC,kBACAf,QAIOtX,EAAI,EAAGA,EAAImY,EAAenY,IAE/BsX,EAAIA,IAAItX,GADkB,IAAxByD,EACW2T,EAAWnB,OAAO,YAAajW,GAE/BoX,EAAWQ,MAAM,YAAa5X,EAI/C,OAAOsX,GAIT,QAASiB,GAAS9U,EAAqB+U,GACrC,GAAKA,GAAgBA,EAAYC,MAAMnW,OAAvC,CAKA,IAAK,GAFCoW,MAEG1Y,EAAI,EAAGA,EAAIwY,EAAYC,MAAMnW,OAAQtC,IAAK,CACjD,GAAMoX,GAAaoB,EAAYC,MAAMzY,GAAGsJ,QAClCgO,EAAMY,EAAOzU,EAAqB2T,EAEpCE,IACFoB,EAAKzH,KAAKqG,GAId,MAAOoB,IhCmzDThY,OAAOC,eAAexB,EAAS,cAC7BkB,OAAO,IAwDTlB,EAAQ4C,QgCz2DOwW,GhC62DT,SAAUnZ,EAAQD,EAASU,GAEjC,YiCp6DA,SAAS8Y,GAAwBrP,GAC/B,GAAM7F,GAAsB6F,EAAQ2M,OAAO,aACrC8B,EAAazO,EAAQ2M,OAAO,YAElC,OAA4B,KAAxBxS,EACK,GAGD,GAAMsU,EAAa,EAI7B,QAASa,GAAyCtP,GAGhD,GAAM1B,GAAc0B,EAAQwO,OAAO,YAEnC,IAAoB,8BAAhBlQ,GACc,gCAAhBA,EACA,MAAO,EAKT,IAAMzB,GAAmBmD,EAAQuP,YAAY,aACvChS,EAAeyC,EAAQuP,YAAY,YAEzC,QAAyBlX,KAArBwE,OAAmDxE,KAAjBkF,EAA4B,CAIhE,MAH4B8R,GAAuBrP,GACDzC,EAAeV,EAEvC,EACjB,EAGF,EAKT,MAAImD,GAAQiM,SAASuD,WAAaxP,EAAQiM,SAASuD,UAAUxW,OAAS,EAC7D,EAIFgH,EAAQ2M,OAAO,ajC03DxBvV,OAAOC,eAAexB,EAAS,cAC7BkB,OAAO,IAkDTlB,EAAQ4C,QiC16DO6W,GjC86DT,SAAUxZ,EAAQD,EAASU,GAEjC,YkCl+DA,SAASmV,GAAiB1L,EAAS4N,EAAKjC,GACtC,GAAMC,MACA6D,EAAgBzP,EAAQwO,OAAOZ,EAErC,IAAK6B,EAAL,CAGA,GAAMvE,GAAQuE,EAAcvE,MAAM,KAElC,MAAIS,GAAiBT,EAAMlS,OAAS2S,GAApC,CAGA,IAAK,GAAIjV,GAAI,EAAGA,EAAIwU,EAAMlS,OAAQtC,IAChCkV,EAAOjE,KAAK6D,WAAWN,EAAMxU,IAG/B,OAAOkV,KlCq9DTxU,OAAOC,eAAexB,EAAS,cAC7BkB,OAAO,IAqBTlB,EAAQ4C,QkCx+DOiT,GlC4+DT,SAAU5V,EAAQD,EAASU,GAEjC,YmC//DA,SAASmZ,GAAUC,EAAMC,GACvB,MAAOD,GAAQ,GAAKC,EAMtB,QAASC,GAAmBrP,EAAWsM,EAAaD,GAIlD,IAAK,GAFCzS,GAAY,GAAIG,YAAWsS,GAExBnW,EAAI,EAAGA,EAAImW,EAAgBnW,IAAK,CAEvC,GAAMoZ,GAAU7J,KAAK8J,MAAMrZ,EAAI,GAGzBiZ,EAAOnP,EAAUsP,EAAUhD,GAG3B8C,EAAUlZ,EAAI,CAGpB0D,GAAU1D,GAAKgZ,EAASC,EAAMC,GAAU,EAAI,EAG9C,MAAOxV,GnCy+DThD,OAAOC,eAAexB,EAAS,cAC7BkB,OAAO,IAgCTlB,EAAQ4C,QmCvgEOoX,GnC0gEP,CACA,CAEF,SAAU/Z,EAAQD,EAASU,GAEjC,YoC3iEA,SAASyZ,GAAWtV,IAClB,EAAAyG,EAAA/I,YAAWsC,GpC6iEbtD,OAAOC,eAAexB,EAAS,cAC7BkB,OAAO,GoCjjET,IAAAoK,GAAA5K,EAAA,EpC0jEAV,GAAQ4C,QoCpjEOuX,GpCwjET,SAAUla,EAAQD,EAASU,GAEjC,YAyBA,SAASsD,GAAuBrB,GAAO,MAAOA,IAAOA,EAAId,WAAac,GAAQC,QAASD,GAtBvFpB,OAAOC,eAAexB,EAAS,cAC7BkB,OAAO,GqCpkET,IAAAkZ,GAAA1Z,EAAA,IAMA8U,EAAA9U,EAAA,IrCqkEI0U,EAAsBpR,EAAuBwR,GqCpkEjD6E,EAAA3Z,EAAA,IrCwkEI4Z,EAAiBtW,EAAuBqW,GqCvkE5CE,EAAA7Z,EAAA,GrC2kEI8Z,EAAoBxW,EAAuBuW,GqC1kE/CE,EAAA/Z,EAAA,IrC8kEIga,EAAc1W,EAAuByW,GqC5kEnChV,GACJkV,kCACAlF,gCACAI,kCACA/S,oBACA8X,oCrCmlEF5a,GAAQ4C,SqC/kEN6C,WACA8O,4BACAzM,uBACA+S,oBACAC,4BrCqlEI,SAAU7a,EAAQD,EAASU,GAEjC,YAyCA,SAASsD,GAAuBrB,GAAO,MAAOA,IAAOA,EAAId,WAAac,GAAQC,QAASD,GAtCvFpB,OAAOC,eAAexB,EAAS,cAC7BkB,OAAO,GsCnnET,IAAAkZ,GAAA1Z,EAAA,IAMAqa,EAAAra,EAAA,GtConEIsa,EAAwBhX,EAAuB+W,GsCnnEnDlD,EAAAnX,EAAA,ItCunEI8W,EAAgBxT,EAAuB6T,GsCtnE3CoD,EAAAva,EAAA,ItC0nEIwa,EAA8BlX,EAAuBiX,GsCznEzDE,EAAAza,EAAA,ItC6nEI0a,EAA8BpX,EAAuBmX,GsC5nEzDE,EAAA3a,EAAA,ItCgoEI4a,EAAoBtX,EAAuBqX,GsC/nE/CZ,EAAA/Z,EAAA,ItCmoEIga,EAAc1W,EAAuByW,GsCloEzC7C,EAAAlX,EAAA,GtCsoEI4W,EAAiBtT,EAAuB4T,GsCroE5CT,EAAAzW,EAAA,ItCyoEIwW,EAAsBlT,EAAuBmT,GsCvoE3C1R,GACJiT,0CACAU,kBACAK,kFACA5D,kCACA+E,oCtC8oEF5a,GAAQ4C,SsC1oEN6C,WACA8V,8BACAC,sBACAjF,oCACAK,oCACAQ,0BACAyD,oBACAzX,uBACA4W,8BtC+oEM,CACA,CAEF,SAAU/Z,EAAQD,EAASU,GAEjC,YAGAa,QAAOC,eAAexB,EAAS,cAC7BkB,OAAO,IAGTlB,EAAQ4C,QuCzrEO,SAAUwB,EAAY0H,GACnC,GAAMqE,GAAY/L,EAAWgC,QAAUhC,EAAW8B,KAC9CuV,EAAW,EACXC,EAAY,EACVnX,EAAYH,EAAWG,UACvB2J,EAAQ9J,EAAWsL,qCAAqC,GACxDiM,EAAQvX,EAAWyL,+BACnB+L,EAAQxX,EAAW0L,iCACnB+L,EAAQzX,EAAW2L,gCACnBa,EAA+D,IAAvDxM,EAAWsL,qCAAqC,GAAW,EAAI,EACzEoM,EAAM1X,EAAWyL,+BAA+B1M,MAExC,KAAR2Y,IACFA,EAAM,MAGR,KAAK,GAAIjb,GAAI,EAAGA,EAAIsP,IAAatP,EAAG,CAClC,GAAIK,GAAQqD,EAAUkX,IAElBva,GAAQgN,EACVhN,EAAQ,EACCA,EAAQgN,EAAQ4N,EAAM,EAC/B5a,EAAQ4a,EAAM,EAEd5a,GAASgN,EAGXpC,EAAW4P,KAAeC,EAAMza,IAAU0P,EAC1C9E,EAAW4P,KAAeE,EAAM1a,IAAU0P,EAC1C9E,EAAW4P,KAAeG,EAAM3a,IAAU0P,EAC1C9E,EAAW4P,KAAe,OvC+rExB,SAAUzb,EAAQD,EAASU,GAEjC,YAGAa,QAAOC,eAAexB,EAAS,cAC7BkB,OAAO,IAGTlB,EAAQ4C,QwCxuEO,SAAUwB,EAAY0H,GACnC,OAAmBtJ,KAAf4B,EACF,KAAM,IAAIoI,OAAM,6CAElB,IAAIpI,EAAWjB,OAAS,GAAM,EAC5B,KAAM,IAAIqJ,OAAM,qDAOlB,KAAK,GAJC2D,GAAY/L,EAAWjB,OAAS,EAClC4Y,EAAW,EACXL,EAAY,EAEP7a,EAAI,EAAGA,EAAIsP,EAAWtP,IAC7BiL,EAAW4P,KAAetX,EAAW2X,KACrCjQ,EAAW4P,KAAetX,EAAW2X,KACrCjQ,EAAW4P,KAAetX,EAAW2X,KACrCjQ,EAAW4P,KAAe,MxC8uExB,SAAUzb,EAAQD,EAASU,GAEjC,YAGAa,QAAOC,eAAexB,EAAS,cAC7BkB,OAAO,IAGTlB,EAAQ4C,QyCvwEO,SAAUwB,EAAY0H,GACnC,OAAmBtJ,KAAf4B,EACF,KAAM,IAAIoI,OAAM,6CAElB,IAAIpI,EAAWjB,OAAS,GAAM,EAC5B,KAAM,IAAIqJ,OAAM,qDASlB,KAAK,GANC2D,GAAY/L,EAAWjB,OAAS,EAClCuY,EAAY,EACZM,EAAS,EACTC,EAAS9L,EACT+L,EAAqB,EAAZ/L,EAEJtP,EAAI,EAAGA,EAAIsP,EAAWtP,IAC7BiL,EAAW4P,KAAetX,EAAW4X,KACrClQ,EAAW4P,KAAetX,EAAW6X,KACrCnQ,EAAW4P,KAAetX,EAAW8X,KACrCpQ,EAAW4P,KAAe,MzC6wExB,SAAUzb,EAAQD,EAASU,GAEjC,YAGAa,QAAOC,eAAexB,EAAS,cAC7BkB,OAAO,IAGTlB,EAAQ4C,Q0CxyEO,SAAUwB,EAAY0H,GACnC,OAAmBtJ,KAAf4B,EACF,KAAM,IAAIoI,OAAM,6CAElB,IAAIpI,EAAWjB,OAAS,GAAM,EAC5B,KAAM,IAAIqJ,OAAM,oDAOlB,KAAK,GAJC2D,GAAY/L,EAAWjB,OAAS,EAClCgZ,EAAW,EACXT,EAAY,EAEP7a,EAAI,EAAGA,EAAIsP,EAAWtP,IAAK,CAClC,GAAMub,GAAIhY,EAAW+X,KACfE,EAAKjY,EAAW+X,KAChBG,EAAKlY,EAAW+X,IAEtBrQ,GAAW4P,KAAeU,EAAI,OAAWE,EAAK,KAC9CxQ,EAAW4P,KAAeU,EAAI,QAAWC,EAAK,KAAO,QAAWC,EAAK,KACrExQ,EAAW4P,KAAeU,EAAI,OAAWC,EAAK,KAC9CvQ,EAAW4P,KAAe,O1C8yExB,SAAUzb,EAAQD,EAASU,GAEjC,YAGAa,QAAOC,eAAexB,EAAS,cAC7BkB,OAAO,IAGTlB,EAAQ4C,Q2C30EO,SAAUwB,EAAY0H,GACnC,OAAmBtJ,KAAf4B,EACF,KAAM,IAAIoI,OAAM,6CAElB,IAAIpI,EAAWjB,OAAS,GAAM,EAC5B,KAAM,IAAIqJ,OAAM,oDASlB,KAAK,GANC2D,GAAY/L,EAAWjB,OAAS,EAClCuY,EAAY,EACZa,EAAS,EACTC,EAAUrM,EACVsM,EAAsB,EAAZtM,EAELtP,EAAI,EAAGA,EAAIsP,EAAWtP,IAAK,CAClC,GAAMub,GAAIhY,EAAWmY,KACfF,EAAKjY,EAAWoY,KAChBF,EAAKlY,EAAWqY,IAEtB3Q,GAAW4P,KAAeU,EAAI,OAAWE,EAAK,KAC9CxQ,EAAW4P,KAAeU,EAAI,QAAWC,EAAK,KAAO,QAAWC,EAAK,KACrExQ,EAAW4P,KAAeU,EAAI,OAAWC,EAAK,KAC9CvQ,EAAW4P,KAAe,O3Ci1ExB,SAAUzb,EAAQD,EAASU,GAEjC,YA0JA,SAASsD,GAAuBrB,GAAO,MAAOA,IAAOA,EAAId,WAAac,GAAQC,QAASD,GAvJvFpB,OAAOC,eAAexB,EAAS,cAC7BkB,OAAO,GAGT,IAAI8K,GAAwBtL,EAAoB,G4Ch3EhDa,QAAAmb,KAAA1Q,GAAA2Q,QAAA,SAAAjT,GAAA,YAAAA,GAAA,eAAAA,GAAAnI,OAAAC,eAAAxB,EAAA0J,GAAAhI,YAAA,EAAAC,IAAA,iBAAAqK,GAAAtC,O5C43EA,IAAIkT,GAAWlc,EAAoB,GAEnCa,QAAOC,eAAexB,EAAS,WAC7B0B,YAAY,EACZC,IAAK,WACH,MAAOqC,GAAuB4Y,G4C/3EzBha,U5Cm4ET,IAAIia,GAAUnc,EAAoB,GAElCa,QAAOC,eAAexB,EAAS,UAC7B0B,YAAY,EACZC,IAAK,WACH,MAAOqC,GAAuB6Y,G4Cv4EzBja,U5C24ET,IAAIka,GAAapc,EAAoB,GAErCa,QAAOC,eAAexB,EAAS,aAC7B0B,YAAY,EACZC,IAAK,WACH,MAAOqC,GAAuB8Y,G4C/4EzBla,U5Cm5ET,IAAIyG,GAAqB3I,EAAoB,GAE7Ca,QAAOC,eAAexB,EAAS,qBAC7B0B,YAAY,EACZC,IAAK,WACH,MAAOqC,GAAuBqF,G4Cv5EzBzG,U5C25ET,IAAIma,GAAerc,EAAoB,EAEvCa,QAAOC,eAAexB,EAAS,eAC7B0B,YAAY,EACZC,IAAK,WACH,MAAOqC,GAAuB+Y,G4C/5EzBna,U5Cm6ET,IAAIuG,GAAoBzI,EAAoB,GAE5Ca,QAAOC,eAAexB,EAAS,oBAC7B0B,YAAY,EACZC,IAAK,WACH,MAAOqC,GAAuBmF,G4Cv6EzBvG,U5C26ET,IAAIwK,GAA+B1M,EAAoB,GAEvDa,QAAOC,eAAexB,EAAS,+BAC7B0B,YAAY,EACZC,IAAK,WACH,MAAOqC,GAAuBoJ,G4C/6EzBxK,U5Cm7ET,IAAIsG,GAAiBxI,EAAoB,GAEzCa,QAAOC,eAAexB,EAAS,iBAC7B0B,YAAY,EACZC,IAAK,WACH,MAAOqC,GAAuBkF,G4Cv7EzBtG,U5C27ET,IAAI0G,GAAa5I,EAAoB,GAErCa,QAAOC,eAAexB,EAAS,aAC7B0B,YAAY,EACZC,IAAK,WACH,MAAOqC,GAAuBsF,G4C/7EzB1G,U5Cm8ET,IAAIwG,GAAgB1I,EAAoB,GAExCa,QAAOC,eAAexB,EAAS,gBAC7B0B,YAAY,EACZC,IAAK,WACH,MAAOqC,GAAuBoF,G4Cv8EzBxG,U5C28ET,IAAI2G,GAA2B7I,EAAoB,GAEnDa,QAAOC,eAAexB,EAAS,2BAC7B0B,YAAY,EACZC,IAAK,WACH,MAAOqC,GAAuBuF,G4C/8EzB3G,U5Cm9ET,IAAIuK,GAAoBzM,EAAoB,GAE5Ca,QAAOC,eAAexB,EAAS,oBAC7B0B,YAAY,EACZC,IAAK,WACH,MAAOqC,GAAuBmJ,G4Cv9EzBvK,U5C29ET,IAAIoa,GAAWtc,EAAoB,EAEnCa,QAAOC,eAAexB,EAAS,WAC7B0B,YAAY,EACZC,IAAK,WACH,MAAOqC,GAAuBgZ,G4C/9EzBpa,U5Cm+ET,IAAI0I,GAAY5K,EAAoB,EAEpCa,QAAOC,eAAexB,EAAS,YAC7B0B,YAAY,EACZC,IAAK,WACH,MAAO2J,G4Cv+EFlJ,W5C2+ET,IAAImJ,GAAU7K,EAAoB,GAElCa,QAAOC,eAAexB,EAAS,UAC7B0B,YAAY,EACZC,IAAK,WACH,MAAOqC,GAAuBuH,G4C9+EzB3I,Y5Cs/EH,SAAU3C,EAAQD,EAASU,GAEjC,Y6CrgFA,SAAS2B,GAAYmB,EAAKH,GAAuB,GAAd0R,GAAcnC,UAAAzP,OAAA,OAAAX,KAAAoQ,UAAA,GAAAA,UAAA,MACzC3N,EAAWC,EAAAtC,QAAEuC,WACbN,GAAU,EAAAhC,EAAAP,cAGV2a,EAAM,GAAIC,eA0ChB,OAxCAD,GAAIE,KAAK,MAAO3Z,GAAK,GACrByZ,EAAIG,aAAe,cACnBvY,EAAQ+O,WAAWqJ,GACnB1b,OAAOmb,KAAK3H,GAAS4H,QAAQ,SAAUjT,GACrCuT,EAAII,iBAAiB3T,EAAKqL,EAAQrL,MAIpCuT,EAAIK,mBAAqB,WAEA,IAAnBL,EAAIM,aACa,MAAfN,EAAIvM,OACNzL,EAAS8D,QAAQkU,EAAI/H,SAAU+H,GAG/BhY,EAAS8F,OAAOkS,KAItBA,EAAIO,WAAa,SAAUC,GAGzB,GAAIA,EAAUC,iBAAkB,CAG9B,GAAMC,GAASF,EAAUE,OACnBC,EAAQH,EAAUG,MAClBC,EAAkBzN,KAAK0N,MAAOH,EAASC,EAAS,MAEtD,EAAA1Y,EAAAtC,SAAE4C,EAAY+J,QAAQtE,QAAQ,gCAC5B5H,UACAsa,SACAC,QACAC,sBAKNZ,EAAIc,OAEG9Y,EAAS+D,U7Cy9ElBzH,OAAOC,eAAexB,EAAS,cAC7BkB,OAAO,G6C7gFT,IAAA+H,GAAAvI,EAAA,G7CkhFIwE,EAUJ,SAAgCvC,GAAO,MAAOA,IAAOA,EAAId,WAAac,GAAQC,QAASD,IAVjDsG,G6CjhFtCpG,EAAAnC,EAAA,IACA8I,EAAA9I,EAAA,GAAY8E,E7CwhFZ,SAAiC7C,GAAO,GAAIA,GAAOA,EAAId,WAAc,MAAOc,EAAc,IAAI8G,KAAa,IAAW,MAAP9G,EAAe,IAAK,GAAI+G,KAAO/G,GAAWpB,OAAOS,UAAUC,eAAelB,KAAK4B,EAAK+G,KAAMD,EAAOC,GAAO/G,EAAI+G,GAAgC,OAAtBD,GAAO7G,QAAUD,EAAY8G,GAFxND,EA2D1CxJ,GAAQ4C,Q6C7hFOP,G7CiiFT,SAAUpC,EAAQD,EAASU,GAEjC,YA6BA,SAASsD,GAAuBrB,GAAO,MAAOA,IAAOA,EAAId,WAAac,GAAQC,QAASD,G8ChnFvF,QAASqb,KACP,MAAO,oBAGT,QAASnD,GAAWxX,EAASwB,GAC3B,GAAMqJ,IAAQ,GAAIC,OAAOC,UAEnBnJ,EAAWC,EAAAtC,QAAEuC,WAEb8E,EAAM5G,EAAQI,UAAU,EAK9B,QAAiBjB,KAFAgY,EAAA5X,QAAgBjB,IAAI0B,GAKnC,MAFA4B,GAAS8F,OAAT,2BAA2C1H,GAEpC4B,EAAS+D,SAyBlB,QAjBA,EAAAsR,EAAA1X,SAAaqH,EAAK5G,EAHA,sDAGoBiC,KAAK,SAAUgK,GAEnD,GAAM1K,GAAiBoZ,EAAgC1O,EAAOiG,aACxDhR,EAAY+K,EAAOlL,WAAWG,WACf,EAAA0Z,EAAArb,SAAYS,EAASkB,EAAWK,EAAgBC,GAExDS,KAAK,SAAUqB,GAE1B,GAAMsI,IAAM,GAAId,OAAOC,SAEvBzH,GAAMuX,aAAejP,EAAMf,EAC3BjJ,EAAS8D,QAAQpC,OAElBwX,KAAK,SAAUjL,GAChBjO,EAAS8F,OAAOmI,KAGXjO,E9C4iFT1D,OAAOC,eAAexB,EAAS,cAC7BkB,OAAO,G8C7lFT,IAAA+H,GAAAvI,EAAA,G9CkmFIwE,EAAWlB,EAAuBiF,G8CjmFtCO,EAAA9I,EAAA,GAAY8E,E9CmnFZ,SAAiC7C,GAAO,GAAIA,GAAOA,EAAId,WAAc,MAAOc,EAAc,IAAI8G,KAAa,IAAW,MAAP9G,EAAe,IAAK,GAAI+G,KAAO/G,GAAWpB,OAAOS,UAAUC,eAAelB,KAAK4B,EAAK+G,KAAMD,EAAOC,GAAO/G,EAAI+G,GAAgC,OAAtBD,GAAO7G,QAAUD,EAAY8G,GAdxND,G8CpmF1C+Q,EAAA7Z,EAAA,G9CwmFI8Z,EAAoBxW,EAAuBuW,G8CvmF/CF,EAAA3Z,EAAA,I9C2mFI4Z,EAAiBtW,EAAuBqW,G8C1mF5C0C,EAAArc,EAAA,G9C8mFIud,EAAgBja,EAAuB+Y,E8C9jF3CvX,GAAY4Y,oBAAoB,SAAUvD,G9ConF1C7a,EAAQ4C,Q8ClnFOiY,G9CsnFT,SAAU5a,EAAQD,EAASU,GAEjC,Y+CpqFA,SAASia,GAAiB5X,EAASC,EAAOC,GACxC,GAAM/B,IAAQ,EAAAwU,EAAA9S,SAASG,EAASC,EAAOC,EAEvC,QAAcT,KAAVtB,EAIJ,MAAOyU,YAAWzU,G/CgqFpBK,OAAOC,eAAexB,EAAS,cAC7BkB,OAAO,G+ClrFT,IAAA0U,GAAAlV,EAAA,G/CurFIgV,EAEJ,SAAgC/S,GAAO,MAAOA,IAAOA,EAAId,WAAac,GAAQC,QAASD,IAF/CiT,EAsBxC5V,GAAQ4C,Q+CzrFO+X,G/C6rFT,SAAU1a,EAAQD,EAASU,GAEjC,YAoDA,SAASsD,GAAuBrB,GAAO,MAAOA,IAAOA,EAAId,WAAac,GAAQC,QAASD,GAjDvFpB,OAAOC,eAAexB,EAAS,cAC7BkB,OAAO,GAGT,IAAImd,GAAmB3d,EAAoB,GAE3Ca,QAAOC,eAAexB,EAAS,mBAC7B0B,YAAY,EACZC,IAAK,WACH,MAAOqC,GAAuBqa,GgD/tFzBzb,UhDmuFT,IAAI0b,GAAkB5d,EAAoB,GAE1Ca,QAAOC,eAAexB,EAAS,kBAC7B0B,YAAY,EACZC,IAAK,WACH,MAAOqC,GAAuBsa,GgDvuFzB1b,UhD2uFT,IAAI2b,GAAmB7d,EAAoB,GAE3Ca,QAAOC,eAAexB,EAAS,mBAC7B0B,YAAY,EACZC,IAAK,WACH,MAAOqC,GAAuBua,GgD/uFzB3b,UhDmvFT,IAAIgT,GAAYlV,EAAoB,EAEpCa,QAAOC,eAAexB,EAAS,YAC7B0B,YAAY,EACZC,IAAK,WACH,MAAOqC,GAAuB4R,GgDvvFzBhT,UhD2vFT,IAAI4b,GAAoB9d,EAAoB,GAE5Ca,QAAOC,eAAexB,EAAS,oBAC7B0B,YAAY,EACZC,IAAK,WACH,MAAOqC,GAAuBwa,GgD/vFzB5b,YhDuwFH,SAAU3C,EAAQD,EAASU,GAEjC,YA+BA,SAAS+d,GAAwB9b,GAAO,GAAIA,GAAOA,EAAId,WAAc,MAAOc,EAAc,IAAI8G,KAAa,IAAW,MAAP9G,EAAe,IAAK,GAAI+G,KAAO/G,GAAWpB,OAAOS,UAAUC,eAAelB,KAAK4B,EAAK+G,KAAMD,EAAOC,GAAO/G,EAAI+G,GAAgC,OAAtBD,GAAO7G,QAAUD,EAAY8G,EAElQ,QAASzF,GAAuBrB,GAAO,MAAOA,IAAOA,EAAId,WAAac,GAAQC,QAASD,GiDvyFvF,QAASiY,GAAkBrM,EAAMlL,GAC/B,GAAMoC,GAAW+U,EAAA5X,QAAgBjB,IAAI0B,EAErC,IAAKoC,EAAL,CAIA,GAAa,wBAAT8I,EACF,OACEmQ,UAAU,EAAAhJ,EAAA9S,SAAS6C,EAAS,aAC5BkZ,mBAAmB,EAAAjJ,EAAA9S,SAAS6C,EAAS,aACrCmZ,cAAc,EAAAC,EAAAjc,SAAe6C,EAAS,aACtCqZ,kBAAkB,EAAApJ,EAAA9S,SAAS6C,EAAS,aACpCsZ,WAAYnU,EAAYoU,SAAQ,EAAAtJ,EAAA9S,SAAS6C,EAAS,cAClDwZ,WAAYrU,EAAYsU,SAAQ,EAAAxJ,EAAA9S,SAAS6C,EAAS,YAAa,EAAG,KAItE,IAAa,uBAAT8I,EACF,OACE4Q,YAAY,EAAAN,EAAAjc,SAAe6C,EAAS,aACpC2Z,aAAa,EAAAP,EAAAjc,SAAe6C,EAAS,aACrC4Z,eAAe,EAAAR,EAAAjc,SAAe6C,EAAS,aAI3C,IAAa,qBAAT8I,EACF,OACEzH,cAAc,EAAAwY,EAAA1c,SAAgB6C,EAAS,YAAa,GACpD8Z,yBAAyB,EAAAD,EAAA1c,SAAgB6C,EAAS,YAAa,GAC/D+Z,sBAAsB,EAAAF,EAAA1c,SAAgB6C,EAAS,YAAa,GAC5Dga,gBAAgB,EAAAZ,EAAAjc,SAAe6C,EAAS,aACxCia,eAAe,EAAAb,EAAAjc,SAAe6C,EAAS,aAI3C,IAAa,qBAAT8I,EACF,OACEtB,iBAAiB,EAAA4R,EAAAjc,SAAe6C,EAAS,aACzCM,2BAA2B,EAAA2P,EAAA9S,SAAS6C,EAAS,aAC7CS,MAAM,EAAA2Y,EAAAjc,SAAe6C,EAAS,aAC9BW,SAAS,EAAAyY,EAAAjc,SAAe6C,EAAS,aACjCpB,eAAe,EAAAwa,EAAAjc,SAAe6C,EAAS,aACvCmT,YAAY,EAAAiG,EAAAjc,SAAe6C,EAAS,aACpCoT,SAAS,EAAAnD,EAAA9S,SAAS6C,EAAS,aAC3BnB,qBAAqB,EAAAua,EAAAjc,SAAe6C,EAAS,aAC7CsG,qBAAqB,EAAA8S,EAAAjc,SAAe6C,EAAS,aAC7CqT,kBAAkB,EAAApD,EAAA9S,SAAS6C,EAAS,aACpC0B,oBAAoB,EAAA0X,EAAAjc,SAAe6C,EAAS,aAC5C4B,mBAAmB,EAAAwX,EAAAjc,SAAe6C,EAAS,aAC3CiK,sCAAsC,EAAA4P,EAAA1c,SAAgB6C,EAAS,aAC/DkK,wCAAwC,EAAA2P,EAAA1c,SAAgB6C,EAAS,aACjEmK,uCAAuC,EAAA0P,EAAA1c,SAAgB6C,EAAS,aAChEoK,gCAAgC,EAAAyP,EAAA1c,SAAgB6C,EAAS,aACzDqK,kCAAkC,EAAAwP,EAAA1c,SAAgB6C,EAAS,aAC3DsK,iCAAiC,EAAAuP,EAAA1c,SAAgB6C,EAAS,aAI9D,IAAa,iBAAT8I,EACF,OAEE5G,cAAc,EAAA2X,EAAA1c,SAAgB6C,EAAS,YAAa,GACpDmC,aAAa,EAAA0X,EAAA1c,SAAgB6C,EAAS,YAAa,GAIvD,IAAa,sBAAT8I,EACF,OAEEvH,kBAAkB,EAAA6X,EAAAjc,SAAe6C,EAAS,aAC1CiC,cAAc,EAAAmX,EAAAjc,SAAe6C,EAAS,aACtCka,aAAa,EAAAjK,EAAA9S,SAAS6C,EAAS,aAInC,IAAa,oBAAT8I,EACF,OACE9F,aAAa,EAAAiN,EAAA9S,SAAS6C,EAAS,aAC/Bma,gBAAgB,EAAAlK,EAAA9S,SAAS6C,EAAS,aAItC,IAAa,qBAAT8I,EAA6B,CAC/B,GAAMsR,IAA0B,EAAAnK,EAAA9S,SAAS6C,EAAS,YAElD,QAAgCjD,KAA5Bqd,EACF,MAGF,QACEA,yBACEC,6BAA8BlV,EAAYsU,SAAQ,EAAAxJ,EAAA9S,SAASid,EAAwB,YAAa,EAAG,KACnGE,uBAAuB,EAAAlB,EAAAjc,SAAeid,EAAwB,aAC9DG,sBAAsB,EAAAnB,EAAAjc,SAAeid,EAAwB,iBjD2qFrEte,OAAOC,eAAexB,EAAS,cAC7BkB,OAAO,GiDjxFT,IAAAqd,GAAA7d,EAAA,IjDsxFI4e,EAAoBtb,EAAuBua,GiDrxF/C3I,EAAAlV,EAAA,GjDyxFIgV,EAAa1R,EAAuB4R,GiDxxFxC0I,EAAA5d,EAAA,IjD4xFIme,EAAmB7a,EAAuBsa,GiD3xF9C/D,EAAA7Z,EAAA,GjD+xFI8Z,EAAoBxW,EAAuBuW,GiD9xF/ClP,EAAA3K,EAAA,GAAYkK,EjDkyFM6T,EAAwBpT,EAIxBoT,GiDryFlB/d,EAAA,IAuGY+E,SAASwa,YAAYrF,GjD0yFjC5a,EAAQ4C,QiDxyFOgY,GjD4yFT,SAAU3a,EAAQD,EAASU,GAEjC,YA2CA,SAASsD,GAAuBrB,GAAO,MAAOA,IAAOA,EAAId,WAAac,GAAQC,QAASD,GkD57FvF,QAASud,GAAYvZ,GACnBA,EAAMwZ,QAAU,WAEd,GAAM9I,IAAgB,EAAAC,EAAA1U,SAAa+D,EAAMtD,QAEzC2X,GAAApY,QAAoBwI,OAAOiM,EAAc7T,MAI7C,QAASsE,GAAcqC,EAASzG,GAG9B,MAFyByG,GAAQiM,SAASC,UAErB+J,uBACZ,EAAAlF,EAAAtY,SAA0BuH,EAASzG,IAGrC,EAAA0X,EAAAxY,SAA0BuH,EAASzG,GAI5C,QAAS2c,GAAsBC,EAAgBjd,EAASM,EAAO4c,EAAgB1b,GAE7E,GAAMqJ,IAAQ,GAAIC,OAAOC,SAEzBzK,GAAQA,GAAS,CACjB,IAAMsB,GAAWC,EAAAtC,QAAEuC,UAqBnB,OAnBAmb,GAAehb,KAAK,SAAU6E,GAC5B,GAAM5F,GAAYuD,EAAaqC,EAASxG,GAClCiB,EAAiBuF,EAAQwO,OAAO,aAChC6H,GAAU,GAAIrS,OAAOC,WACN,EAAA6P,EAAArb,SAAYS,EAASkB,EAAWK,EAAgBC,GAExDS,KAAK,SAAUqB,GAC1BA,EAAMD,KAAOyD,CACb,IAAM8E,IAAM,GAAId,OAAOC,SAEvBzH,GAAMuX,aAAesC,EAAUtS,EAC/BvH,EAAM8Z,cAAgBxR,EAAMf,EAC5BgS,EAAWvZ,GACX1B,EAAS8D,QAAQpC,MAElB,SAAUmE,GACX7F,EAAS8F,OAAOD,KAGX7F,EAGT,QAASyb,GAAoB3c,GAC3B,MAAe,aAAXA,GAAoC,YAAXA,EAC3BuH,EAAAjJ,WACoB,cAAX0B,EACTuX,EAAA1Y,YADK,GAKT,QAASiY,GAAWxX,EAASwB,GAC3B,GAAMwS,IAAgB,EAAAC,EAAA1U,SAAaS,GAC7Bsd,EAASD,EAAmBrJ,EAActT,OAGhD,OAAIiX,GAAApY,QAAoBoH,SAASqN,EAAc7T,KACtC6c,EAAqBrF,EAAApY,QAAoBwH,KAAKiN,EAAc7T,IAAKmd,EAAQtd,GAAUA,EAASgU,EAAc1T,MAAO0T,EAAc7T,IAAKqB,GlDq1F/ItD,OAAOC,eAAexB,EAAS,cAC7BkB,OAAO,GkDh6FT,IAAA+H,GAAAvI,EAAA,GlDq6FIwE,EAAWlB,EAAuBiF,GkDp6FtCO,EAAA9I,EAAA,GAAY8E,ElDo8FZ,SAAiC7C,GAAO,GAAIA,GAAOA,EAAId,WAAc,MAAOc,EAAc,IAAI8G,KAAa,IAAW,MAAP9G,EAAe,IAAK,GAAI+G,KAAO/G,GAAWpB,OAAOS,UAAUC,eAAelB,KAAK4B,EAAK+G,KAAMD,EAAOC,GAAO/G,EAAI+G,GAAgC,OAAtBD,GAAO7G,QAAUD,EAAY8G,GA5BxND,GkDv6F1CuT,EAAArc,EAAA,GlD26FIud,EAAgBja,EAAuB+Y,GkD16F3CnF,EAAAlX,EAAA,GlD86FI4W,EAAiBtT,EAAuB4T,GkD76F5CmD,EAAAra,EAAA,GlDi7FIsa,EAAwBhX,EAAuB+W,GkDh7FnDE,EAAAva,EAAA,IlDo7FIwa,EAA8BlX,EAAuBiX,GkDn7FzDE,EAAAza,EAAA,IlDu7FI0a,EAA8BpX,EAAuBmX,GkDt7FzDE,EAAA3a,EAAA,IlD07FI4a,EAAoBtX,EAAuBqX,GkDz7F/C/P,EAAA5K,EAAA,EA0EA8E,GAAY4Y,oBAAoB,WAAYvD,GAC5CrV,EAAY4Y,oBAAoB,UAAWvD,GAC3CrV,EAAY4Y,oBAAoB,YAAavD,GlDg8F7C7a,EAAQ4C,QkD97FOiY,GlDk8FT,SAAU5a,EAAQD,EAASU,GAEjC,YAoDA,SAASsD,GAAuBrB,GAAO,MAAOA,IAAOA,EAAId,WAAac,GAAQC,QAASD,GAjDvFpB,OAAOC,eAAexB,EAAS,cAC7BkB,OAAO,GAGT,IAAI0f,GAAuBlgB,EAAoB,GAE/Ca,QAAOC,eAAexB,EAAS,uBAC7B0B,YAAY,EACZC,IAAK,WACH,MAAOqC,GAAuB4c,GmDtiGzBhe,UnD0iGT,IAAIie,GAAWngB,EAAoB,GAEnCa,QAAOC,eAAexB,EAAS,WAC7B0B,YAAY,EACZC,IAAK,WACH,MAAOqC,GAAuB6c,GmD9iGzBje,UnDkjGT,IAAIke,GAA2CpgB,EAAoB,GAEnEa,QAAOC,eAAexB,EAAS,2CAC7B0B,YAAY,EACZC,IAAK,WACH,MAAOqC,GAAuB8c,GmDtjGzBle,UnD0jGT,IAAI2b,GAAmB7d,EAAoB,GAE3Ca,QAAOC,eAAexB,EAAS,mBAC7B0B,YAAY,EACZC,IAAK,WACH,MAAOqC,GAAuBua,GmD9jGzB3b,UnDkkGT,IAAI4b,GAAoB9d,EAAoB,GAE5Ca,QAAOC,eAAexB,EAAS,oBAC7B0B,YAAY,EACZC,IAAK,WACH,MAAOqC,GAAuBwa,GmDtkGzB5b,YnD8kGH,SAAU3C,EAAQD,EAASU,GAEjC,YAuCA,SAAS+d,GAAwB9b,GAAO,GAAIA,GAAOA,EAAId,WAAc,MAAOc,EAAc,IAAI8G,KAAa,IAAW,MAAP9G,EAAe,IAAK,GAAI+G,KAAO/G,GAAWpB,OAAOS,UAAUC,eAAelB,KAAK4B,EAAK+G,KAAMD,EAAOC,GAAO/G,EAAI+G,GAAgC,OAAtBD,GAAO7G,QAAUD,EAAY8G,EAElQ,QAASzF,GAAuBrB,GAAO,MAAOA,IAAOA,EAAId,WAAac,GAAQC,QAASD,GoDpnGvF,QAASiY,GAAkBrM,EAAMlL,GAC/B,GAAMgU,IAAgB,EAAAC,EAAA1U,SAAaS,GAE7B8G,EAAU6Q,EAAApY,QAAoBjB,IAAI0V,EAAc7T,IAEtD,IAAK2G,EAAL,CAIA,GAAa,wBAAToE,EACF,OACEmQ,SAAUvU,EAAQwO,OAAO,aACzBgG,kBAAmBxU,EAAQwO,OAAO,aAClCiG,aAAczU,EAAQgM,UAAU,aAChC2I,iBAAkB3U,EAAQwO,OAAO,aACjCoG,WAAYnU,EAAYoU,QAAQ7U,EAAQwO,OAAO,cAC/CsG,WAAYrU,EAAYsU,QAAQ/U,EAAQwO,OAAO,cAAgB,IAInE,IAAa,uBAATpK,EACF,OACE4Q,WAAYhV,EAAQgM,UAAU,aAC9BiJ,YAAajV,EAAQuP,YAAY,aACjC2F,cAAelV,EAAQuP,YAAY,aAIvC,IAAa,qBAATnL,EACF,OACEzH,cAAc,EAAAwY,EAAA1c,SAAgBuH,EAAS,YAAa,GACpDoV,yBAAyB,EAAAD,EAAA1c,SAAgBuH,EAAS,YAAa,GAC/DqV,sBAAsB,EAAAF,EAAA1c,SAAgBuH,EAAS,YAAa,GAC5DsV,eAAgBtV,EAAQuP,YAAY,aACpCgG,cAAevV,EAAQuP,YAAY,aACnCqH,oBAAqB5W,EAAQwO,OAAO,aAIxC,IAAa,qBAATpK,EACF,OAAO,EAAAyS,EAAApe,SAAoBuH,EAG7B,IAAa,sBAAToE,EACF,OACEvH,iBAAkBmD,EAAQuP,YAAY,aACtChS,aAAcyC,EAAQuP,YAAY,aAClCiG,YAAaxV,EAAQwO,OAAO,aAC5BnQ,qBAAqB,EAAAyY,EAAAre,SAAQuH,EAAQ2M,OAAO,aAAc3M,EAAQiM,SAASuD,WAI/E,IAAa,iBAATpL,EAAyB,CAC3B,GAAM2S,IAAuC,EAAAC,EAAAve,SAAwCuH,EAGrF,QACExC,cAAc,EAAA2X,EAAA1c,SAAgBuH,EAAS,YAAa,GACpDvC,aAAa,EAAA0X,EAAA1c,SAAgBuH,EAAS,YAAa,GACnDxB,gBAAgB,EAAAsY,EAAAre,SAAQse,EAAsC/W,EAAQiM,SAASgL,YAInF,GAAa,oBAAT7S,EACF,OACE9F,YAAa0B,EAAQwO,OAAO,aAC5BiH,eAAgBzV,EAAQwO,OAAO,aAInC,IAAa,qBAATpK,EAA6B,CAC/B,GAAMsR,GAA0B1V,EAAQiM,SAASiL,SAEjD,QAAgC7e,KAA5Bqd,EACF,MAGF,IAAMyB,GAAsCzB,EAAwBvG,MAAM,GAAGnP,OAG7E,QACE0V,yBACEC,6BAA8BlV,EAAYsU,QAAQoC,EAAoC3I,OAAO,cAAgB,IAC7GoH,sBAAuBuB,EAAoC5H,YAAY,aACvEsG,qBAAsBsB,EAAoC5H,YAAY,iBpD0/F9EnY,OAAOC,eAAexB,EAAS,cAC7BkB,OAAO,GoDxlGT,IAAAqd,GAAA7d,EAAA,IpD6lGI4e,EAAoBtb,EAAuBua,GoD5lG/C3G,EAAAlX,EAAA,GpDgmGI4W,EAAiBtT,EAAuB4T,GoD/lG5CmD,EAAAra,EAAA,GpDmmGIsa,EAAwBhX,EAAuB+W,GoDlmGnD6F,EAAAlgB,EAAA,IpDsmGIsgB,EAAwBhd,EAAuB4c,GoDrmGnDC,EAAAngB,EAAA,IpDymGIugB,EAAYjd,EAAuB6c,GoDxmGvCC,EAAApgB,EAAA,IpD4mGIygB,EAA4Cnd,EAAuB8c,GoD3mGvEzV,EAAA3K,EAAA,GAAYkK,EpD+mGM6T,EAAwBpT,EAIxBoT,GoDlnGlB/d,EAAA,IA8FY+E,SAASwa,YAAYrF,GpDqnGjC5a,EAAQ4C,QoDnnGOgY","file":"cornerstoneWADOImageLoader.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"jquery\"), require(\"cornerstone-core\"), require(\"dicom-parser\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"cornerstoneWADOImageLoader\", [\"jquery\", \"cornerstone-core\", \"dicom-parser\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"cornerstoneWADOImageLoader\"] = factory(require(\"jquery\"), require(\"cornerstone-core\"), require(\"dicom-parser\"));\n\telse\n\t\troot[\"cornerstoneWADOImageLoader\"] = factory(root[\"$\"], root[\"cornerstone\"], root[\"dicomParser\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_0__, __WEBPACK_EXTERNAL_MODULE_1__, __WEBPACK_EXTERNAL_MODULE_6__) {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition","/*! cornerstone-wado-image-loader - 0.14.6 - 2017-08-04 | (c) 2016 Chris Hafey | https://github.com/chafey/cornerstoneWADOImageLoader */\n(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"jquery\"), require(\"cornerstone-core\"), require(\"dicom-parser\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"cornerstoneWADOImageLoader\", [\"jquery\", \"cornerstone-core\", \"dicom-parser\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"cornerstoneWADOImageLoader\"] = factory(require(\"jquery\"), require(\"cornerstone-core\"), require(\"dicom-parser\"));\n\telse\n\t\troot[\"cornerstoneWADOImageLoader\"] = factory(root[\"$\"], root[\"cornerstone\"], root[\"dicomParser\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_0__, __WEBPACK_EXTERNAL_MODULE_1__, __WEBPACK_EXTERNAL_MODULE_6__) {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// identity function for calling harmony imports with the correct context\n/******/ \t__webpack_require__.i = function(value) { return value; };\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 46);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports) {\n\nmodule.exports = __WEBPACK_EXTERNAL_MODULE_0__;\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports) {\n\nmodule.exports = __WEBPACK_EXTERNAL_MODULE_1__;\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.internal = exports.xhrRequest = exports.getOptions = exports.setOptions = undefined;\n\nvar _xhrRequest = __webpack_require__(47);\n\nvar _xhrRequest2 = _interopRequireDefault(_xhrRequest);\n\nvar _options = __webpack_require__(20);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar internal = {\n  xhrRequest: _xhrRequest2.default,\n  setOptions: _options.setOptions,\n  getOptions: _options.getOptions\n};\n\nexports.setOptions = _options.setOptions;\nexports.getOptions = _options.getOptions;\nexports.xhrRequest = _xhrRequest2.default;\nexports.internal = internal;\n\n/***/ }),\n/* 3 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = '0.14.6';\n\n/***/ }),\n/* 4 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\n\n/**\r\n * Returns the raw value\r\n *\r\n * @param element - The javascript object for the specified element in the metadata\r\n * @param [index] - the index of the value in a multi-valued element, default is 0\r\n * @param [defaultValue] - The default value to return if the element does not exist\r\n * @returns {*}\r\n */\nfunction getValue(element, index, defaultValue) {\n  index = index || 0;\n  if (!element) {\n    return defaultValue;\n  }\n  // Value is not present if the attribute has a zero length value\n  if (!element.Value) {\n    return defaultValue;\n  }\n  // make sure we have the specified index\n  if (element.Value.length <= index) {\n    return defaultValue;\n  }\n\n  return element.Value[index];\n}\n\nexports.default = getValue;\n\n/***/ }),\n/* 5 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\n\nfunction parseImageId(imageId) {\n  // build a url by parsing out the url scheme and frame index from the imageId\n  var firstColonIndex = imageId.indexOf(':');\n  var url = imageId.substring(firstColonIndex + 1);\n  var frameIndex = url.indexOf('frame=');\n  var frame = void 0;\n\n  if (frameIndex !== -1) {\n    var frameStr = url.substr(frameIndex + 6);\n\n    frame = parseInt(frameStr, 10);\n    url = url.substr(0, frameIndex - 1);\n  }\n\n  return {\n    scheme: imageId.substr(0, firstColonIndex),\n    url: url,\n    frame: frame\n  };\n}\n\nexports.default = parseImageId;\n\n/***/ }),\n/* 6 */\n/***/ (function(module, exports) {\n\nmodule.exports = __WEBPACK_EXTERNAL_MODULE_6__;\n\n/***/ }),\n/* 7 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _jquery = __webpack_require__(0);\n\nvar _jquery2 = _interopRequireDefault(_jquery);\n\nvar _getImageFrame = __webpack_require__(15);\n\nvar _getImageFrame2 = _interopRequireDefault(_getImageFrame);\n\nvar _decodeImageFrame = __webpack_require__(12);\n\nvar _decodeImageFrame2 = _interopRequireDefault(_decodeImageFrame);\n\nvar _isColorImage = __webpack_require__(17);\n\nvar _isColorImage2 = _interopRequireDefault(_isColorImage);\n\nvar _convertColorSpace = __webpack_require__(11);\n\nvar _convertColorSpace2 = _interopRequireDefault(_convertColorSpace);\n\nvar _getMinMax = __webpack_require__(16);\n\nvar _getMinMax2 = _interopRequireDefault(_getMinMax);\n\nvar _isJPEGBaseline8BitColor = __webpack_require__(18);\n\nvar _isJPEGBaseline8BitColor2 = _interopRequireDefault(_isJPEGBaseline8BitColor);\n\nvar _cornerstoneCore = __webpack_require__(1);\n\nvar cornerstone = _interopRequireWildcard(_cornerstoneCore);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar lastImageIdDrawn = '';\n\nfunction isModalityLUTForDisplay(sopClassUid) {\n  // special case for XA and XRF\n  // https://groups.google.com/forum/#!searchin/comp.protocols.dicom/Modality$20LUT$20XA/comp.protocols.dicom/UBxhOZ2anJ0/D0R_QP8V2wIJ\n  return sopClassUid !== '1.2.840.10008.5.1.4.1.1.12.1' && // XA\n  sopClassUid !== '1.2.840.10008.5.1.4.1.1.12.2.1'; // XRF\n}\n\n/**\r\n * Helper function to set pixel data to the right typed array.  This is needed because web workers\r\n * can transfer array buffers but not typed arrays\r\n * @param imageFrame\r\n */\nfunction setPixelDataType(imageFrame) {\n  if (imageFrame.bitsAllocated === 16) {\n    if (imageFrame.pixelRepresentation === 0) {\n      imageFrame.pixelData = new Uint16Array(imageFrame.pixelData);\n    } else {\n      imageFrame.pixelData = new Int16Array(imageFrame.pixelData);\n    }\n  } else {\n    imageFrame.pixelData = new Uint8Array(imageFrame.pixelData);\n  }\n}\n\nfunction createImage(imageId, pixelData, transferSyntax, options) {\n  var canvas = document.createElement('canvas');\n  var deferred = _jquery2.default.Deferred();\n  var imageFrame = (0, _getImageFrame2.default)(imageId);\n  var decodePromise = (0, _decodeImageFrame2.default)(imageFrame, transferSyntax, pixelData, canvas, options);\n\n  decodePromise.then(function (imageFrame) {\n    // var imagePixelModule = metaDataProvider('imagePixelModule', imageId);\n    var imagePlaneModule = cornerstone.metaData.get('imagePlaneModule', imageId);\n    var voiLutModule = cornerstone.metaData.get('voiLutModule', imageId);\n    var modalityLutModule = cornerstone.metaData.get('modalityLutModule', imageId);\n    var sopCommonModule = cornerstone.metaData.get('sopCommonModule', imageId);\n    var isColorImage = (0, _isColorImage2.default)(imageFrame.photometricInterpretation);\n\n    // JPEGBaseline (8 bits) is already returning the pixel data in the right format (rgba)\n    // because it's using a canvas to load and decode images.\n    if (!(0, _isJPEGBaseline8BitColor2.default)(imageFrame, transferSyntax)) {\n      setPixelDataType(imageFrame);\n\n      // convert color space\n      if (isColorImage) {\n        // setup the canvas context\n        canvas.height = imageFrame.rows;\n        canvas.width = imageFrame.columns;\n\n        var context = canvas.getContext('2d');\n        var imageData = context.createImageData(imageFrame.columns, imageFrame.rows);\n\n        (0, _convertColorSpace2.default)(imageFrame, imageData);\n        imageFrame.imageData = imageData;\n        imageFrame.pixelData = imageData.data;\n      }\n    }\n\n    var image = {\n      imageId: imageId,\n      color: isColorImage,\n      columnPixelSpacing: imagePlaneModule.pixelSpacing ? imagePlaneModule.pixelSpacing[1] : undefined,\n      columns: imageFrame.columns,\n      height: imageFrame.rows,\n      intercept: modalityLutModule.rescaleIntercept ? modalityLutModule.rescaleIntercept : 0,\n      invert: imageFrame.photometricInterpretation === 'MONOCHROME1',\n      minPixelValue: imageFrame.smallestPixelValue,\n      maxPixelValue: imageFrame.largestPixelValue,\n      render: undefined, // set below\n      rowPixelSpacing: imagePlaneModule.pixelSpacing ? imagePlaneModule.pixelSpacing[0] : undefined,\n      rows: imageFrame.rows,\n      sizeInBytes: imageFrame.pixelData.length,\n      slope: modalityLutModule.rescaleSlope ? modalityLutModule.rescaleSlope : 1,\n      width: imageFrame.columns,\n      windowCenter: voiLutModule.windowCenter ? voiLutModule.windowCenter[0] : undefined,\n      windowWidth: voiLutModule.windowWidth ? voiLutModule.windowWidth[0] : undefined,\n      decodeTimeInMS: imageFrame.decodeTimeInMS\n    };\n\n    // add function to return pixel data\n    image.getPixelData = function () {\n      return imageFrame.pixelData;\n    };\n\n    // Setup the renderer\n    if (image.color) {\n      image.render = cornerstone.renderColorImage;\n      image.getCanvas = function () {\n        if (lastImageIdDrawn === imageId) {\n          return canvas;\n        }\n\n        canvas.height = image.rows;\n        canvas.width = image.columns;\n        var context = canvas.getContext('2d');\n\n        context.putImageData(imageFrame.imageData, 0, 0);\n        lastImageIdDrawn = imageId;\n\n        return canvas;\n      };\n    } else {\n      image.render = cornerstone.renderGrayscaleImage;\n    }\n\n    // calculate min/max if not supplied\n    if (image.minPixelValue === undefined || image.maxPixelValue === undefined) {\n      var minMax = (0, _getMinMax2.default)(imageFrame.pixelData);\n\n      image.minPixelValue = minMax.min;\n      image.maxPixelValue = minMax.max;\n    }\n\n    // Modality LUT\n    if (modalityLutModule.modalityLUTSequence && modalityLutModule.modalityLUTSequence.length > 0 && isModalityLUTForDisplay(sopCommonModule.sopClassUID)) {\n      image.modalityLUT = modalityLutModule.modalityLUTSequence[0];\n    }\n\n    // VOI LUT\n    if (voiLutModule.voiLUTSequence && voiLutModule.voiLUTSequence.length > 0) {\n      image.voiLUT = voiLutModule.voiLUTSequence[0];\n    }\n\n    // set the ww/wc to cover the dynamic range of the image if no values are supplied\n    if (image.windowCenter === undefined || image.windowWidth === undefined) {\n      if (image.color) {\n        image.windowWidth = 255;\n        image.windowCenter = 128;\n      } else {\n        var maxVoi = image.maxPixelValue * image.slope + image.intercept;\n        var minVoi = image.minPixelValue * image.slope + image.intercept;\n\n        image.windowWidth = maxVoi - minVoi;\n        image.windowCenter = (maxVoi + minVoi) / 2;\n      }\n    }\n    deferred.resolve(image);\n  });\n\n  return deferred.promise();\n}\n\nexports.default = createImage;\n\n/***/ }),\n/* 8 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\n\nvar imageIds = [];\n\nfunction add(imageId, metadata) {\n  imageIds[imageId] = metadata;\n}\n\nfunction get(imageId) {\n  return imageIds[imageId];\n}\n\nfunction remove(imageId) {\n  imageIds[imageId] = undefined;\n}\n\nfunction purge() {\n  imageIds = [];\n}\n\nexports.default = {\n  add: add,\n  get: get,\n  remove: remove,\n  purge: purge\n};\n\n/***/ }),\n/* 9 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _jquery = __webpack_require__(0);\n\nvar _jquery2 = _interopRequireDefault(_jquery);\n\nvar _dicomParser = __webpack_require__(6);\n\nvar dicomParser = _interopRequireWildcard(_dicomParser);\n\nvar _internal = __webpack_require__(2);\n\nvar _events = __webpack_require__(14);\n\nvar _events2 = _interopRequireDefault(_events);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n * This object supports loading of DICOM P10 dataset from a uri and caching it so it can be accessed\n * by the caller.  This allows a caller to access the datasets without having to go through cornerstone's\n * image loader mechanism.  One reason a caller may need to do this is to determine the number of frames\n * in a multiframe sop instance so it can create the imageId's correctly.\n */\nvar loadedDataSets = {};\nvar promises = {};\n\n// returns true if the wadouri for the specified index has been loaded\nfunction isLoaded(uri) {\n  return loadedDataSets[uri] !== undefined;\n}\n\nfunction get(uri) {\n  // if already loaded return it right away\n  if (!loadedDataSets[uri]) {\n    return;\n  }\n\n  return loadedDataSets[uri].dataSet;\n}\n\n// loads the dicom dataset from the wadouri sp\nfunction load(uri, loadRequest, imageId) {\n  loadRequest = loadRequest || _internal.xhrRequest;\n\n  // if already loaded return it right away\n  if (loadedDataSets[uri]) {\n    // console.log('using loaded dataset ' + uri);\n    var alreadyLoadedpromise = _jquery2.default.Deferred();\n\n    loadedDataSets[uri].cacheCount++;\n    alreadyLoadedpromise.resolve(loadedDataSets[uri].dataSet);\n\n    return alreadyLoadedpromise;\n  }\n\n  // if we are currently loading this uri, return its promise\n  if (promises[uri]) {\n    // console.log('returning existing load promise for ' + uri);\n    return promises[uri];\n  }\n\n  // console.log('loading ' + uri);\n\n  // This uri is not loaded or being loaded, load it via an xhrRequest\n  var promise = loadRequest(uri, imageId);\n\n  // handle success and failure of the XHR request load\n  var loadDeferred = _jquery2.default.Deferred();\n\n  promise.then(function (dicomPart10AsArrayBuffer /* , xhr*/) {\n    var byteArray = new Uint8Array(dicomPart10AsArrayBuffer);\n\n    // Reject the promise if parsing the dicom file fails\n    var dataSet = void 0;\n\n    try {\n      dataSet = dicomParser.parseDicom(byteArray);\n    } catch (error) {\n      loadDeferred.reject(error);\n\n      return;\n    }\n\n    loadedDataSets[uri] = {\n      dataSet: dataSet,\n      cacheCount: 1\n    };\n    (0, _jquery2.default)(_events2.default).trigger('DataSetsCacheChanged', {\n      uri: uri,\n      action: 'loaded',\n      dataSet: loadedDataSets[uri].dataSet\n    });\n\n    loadDeferred.resolve(dataSet);\n    // done loading, remove the promise\n    delete promises[uri];\n  }).always(function () {\n    // error thrown, remove the promise\n    delete promises[uri];\n  });\n\n  promises[uri] = loadDeferred;\n\n  return loadDeferred;\n}\n\n// remove the cached/loaded dicom dataset for the specified wadouri to free up memory\nfunction unload(uri) {\n  // console.log('unload for ' + uri);\n  if (loadedDataSets[uri]) {\n    loadedDataSets[uri].cacheCount--;\n    if (loadedDataSets[uri].cacheCount === 0) {\n      // console.log('removing loaded dataset for ' + uri);\n      (0, _jquery2.default)(_events2.default).trigger('DataSetsCacheChanged', {\n        uri: uri,\n        action: 'unloaded',\n        dataSet: loadedDataSets[uri].dataSet\n      });\n      delete loadedDataSets[uri];\n    }\n  }\n}\n\n// removes all cached datasets from memory\nfunction purge() {\n  loadedDataSets = {};\n  promises = {};\n}\n\nexports.default = {\n  isLoaded: isLoaded,\n  load: load,\n  unload: unload,\n  purge: purge,\n  get: get\n};\n\n/***/ }),\n/* 10 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _convertRGBColorByPixel = __webpack_require__(42);\n\nObject.defineProperty(exports, 'convertRGBColorByPixel', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_convertRGBColorByPixel).default;\n  }\n});\n\nvar _convertRGBColorByPlane = __webpack_require__(43);\n\nObject.defineProperty(exports, 'convertRGBColorByPlane', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_convertRGBColorByPlane).default;\n  }\n});\n\nvar _convertYBRFullByPixel = __webpack_require__(44);\n\nObject.defineProperty(exports, 'convertYBRFullByPixel', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_convertYBRFullByPixel).default;\n  }\n});\n\nvar _convertYBRFullByPlane = __webpack_require__(45);\n\nObject.defineProperty(exports, 'convertYBRFullByPlane', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_convertYBRFullByPlane).default;\n  }\n});\n\nvar _convertPALETTECOLOR = __webpack_require__(41);\n\nObject.defineProperty(exports, 'convertPALETTECOLOR', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_convertPALETTECOLOR).default;\n  }\n});\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/***/ }),\n/* 11 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = convertColorSpace;\n\nvar _colorSpaceConverters = __webpack_require__(10);\n\nfunction convertRGB(imageFrame, rgbaBuffer) {\n  if (imageFrame.planarConfiguration === 0) {\n    (0, _colorSpaceConverters.convertRGBColorByPixel)(imageFrame.pixelData, rgbaBuffer);\n  } else {\n    (0, _colorSpaceConverters.convertRGBColorByPlane)(imageFrame.pixelData, rgbaBuffer);\n  }\n}\n\nfunction convertYBRFull(imageFrame, rgbaBuffer) {\n  if (imageFrame.planarConfiguration === 0) {\n    (0, _colorSpaceConverters.convertYBRFullByPixel)(imageFrame.pixelData, rgbaBuffer);\n  } else {\n    (0, _colorSpaceConverters.convertYBRFullByPlane)(imageFrame.pixelData, rgbaBuffer);\n  }\n}\n\nfunction convertColorSpace(imageFrame, imageData) {\n  var rgbaBuffer = imageData.data;\n  // convert based on the photometric interpretation\n\n  if (imageFrame.photometricInterpretation === 'RGB') {\n    convertRGB(imageFrame, rgbaBuffer);\n  } else if (imageFrame.photometricInterpretation === 'YBR_RCT') {\n    convertRGB(imageFrame, rgbaBuffer);\n  } else if (imageFrame.photometricInterpretation === 'YBR_ICT') {\n    convertRGB(imageFrame, rgbaBuffer);\n  } else if (imageFrame.photometricInterpretation === 'PALETTE COLOR') {\n    (0, _colorSpaceConverters.convertPALETTECOLOR)(imageFrame, rgbaBuffer);\n  } else if (imageFrame.photometricInterpretation === 'YBR_FULL_422') {\n    convertRGB(imageFrame, rgbaBuffer);\n  } else if (imageFrame.photometricInterpretation === 'YBR_FULL') {\n    convertYBRFull(imageFrame, rgbaBuffer);\n  } else {\n    throw new Error('No color space conversion for photometric interpretation ' + imageFrame.photometricInterpretation);\n  }\n}\n\n/***/ }),\n/* 12 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _webWorkerManager = __webpack_require__(19);\n\nvar _webWorkerManager2 = _interopRequireDefault(_webWorkerManager);\n\nvar _decodeJPEGBaseline8BitColor = __webpack_require__(13);\n\nvar _decodeJPEGBaseline8BitColor2 = _interopRequireDefault(_decodeJPEGBaseline8BitColor);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction addDecodeTask(imageFrame, transferSyntax, pixelData, options) {\n  var priority = options.priority || undefined;\n  var transferList = options.transferPixelData ? [pixelData.buffer] : undefined;\n\n  return _webWorkerManager2.default.addTask('decodeTask', {\n    imageFrame: imageFrame,\n    transferSyntax: transferSyntax,\n    pixelData: pixelData,\n    options: options\n  }, priority, transferList).promise;\n}\n\nfunction decodeImageFrame(imageFrame, transferSyntax, pixelData, canvas, options) {\n  options = options || {};\n\n  // TODO: Turn this into a switch statement instead\n  if (transferSyntax === '1.2.840.10008.1.2') {\n    // Implicit VR Little Endian\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\n  } else if (transferSyntax === '1.2.840.10008.1.2.1') {\n    // Explicit VR Little Endian\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\n  } else if (transferSyntax === '1.2.840.10008.1.2.2') {\n    // Explicit VR Big Endian (retired)\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\n  } else if (transferSyntax === '1.2.840.10008.1.2.1.99') {\n    // Deflate transfer syntax (deflated by dicomParser)\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\n  } else if (transferSyntax === '1.2.840.10008.1.2.5') {\n    // RLE Lossless\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.50') {\n    // JPEG Baseline lossy process 1 (8 bit)\n\n    // Handle 8-bit JPEG Baseline color images using the browser's built-in\n    // JPEG decoding\n    if (imageFrame.bitsAllocated === 8 && (imageFrame.samplesPerPixel === 3 || imageFrame.samplesPerPixel === 4)) {\n      return (0, _decodeJPEGBaseline8BitColor2.default)(imageFrame, pixelData, canvas);\n    }\n\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.51') {\n    // JPEG Baseline lossy process 2 & 4 (12 bit)\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.57') {\n    // JPEG Lossless, Nonhierarchical (Processes 14)\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.70') {\n    // JPEG Lossless, Nonhierarchical (Processes 14 [Selection 1])\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.80') {\n    // JPEG-LS Lossless Image Compression\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.81') {\n    // JPEG-LS Lossy (Near-Lossless) Image Compression\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.90') {\n    // JPEG 2000 Lossless\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.91') {\n    // JPEG 2000 Lossy\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\n  }\n\n  /* Don't know if these work...\r\n   // JPEG 2000 Part 2 Multicomponent Image Compression (Lossless Only)\r\n   else if(transferSyntax === \"1.2.840.10008.1.2.4.92\")\r\n   {\r\n   return cornerstoneWADOImageLoader.decodeJPEG2000(dataSet, frame);\r\n   }\r\n   // JPEG 2000 Part 2 Multicomponent Image Compression\r\n   else if(transferSyntax === \"1.2.840.10008.1.2.4.93\")\r\n   {\r\n   return cornerstoneWADOImageLoader.decodeJPEG2000(dataSet, frame);\r\n   }\r\n   */\n\n  throw new Error('No decoder for transfer syntax ' + transferSyntax);\n}\n\nexports.default = decodeImageFrame;\n\n/***/ }),\n/* 13 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _jquery = __webpack_require__(0);\n\nvar _jquery2 = _interopRequireDefault(_jquery);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\r\n * Special decoder for 8 bit jpeg that leverages the browser's built in JPEG decoder for increased performance\r\n */\n\nfunction arrayBufferToString(buffer) {\n  return binaryToString(String.fromCharCode.apply(null, Array.prototype.slice.apply(new Uint8Array(buffer))));\n}\n\nfunction binaryToString(binary) {\n  var error = void 0;\n\n  try {\n    return decodeURIComponent(escape(binary));\n  } catch (_error) {\n    error = _error;\n    if (error instanceof URIError) {\n      return binary;\n    }\n    throw error;\n  }\n}\n\nfunction decodeJPEGBaseline8BitColor(imageFrame, pixelData, canvas) {\n  var start = new Date().getTime();\n  var deferred = _jquery2.default.Deferred();\n\n  var imgBlob = new Blob([pixelData], { type: 'image/jpeg' });\n\n  var r = new FileReader();\n\n  if (r.readAsBinaryString === undefined) {\n    r.readAsArrayBuffer(imgBlob);\n  } else {\n    r.readAsBinaryString(imgBlob); // doesn't work on IE11\n  }\n\n  r.onload = function () {\n    var img = new Image();\n\n    img.onload = function () {\n      canvas.height = img.height;\n      canvas.width = img.width;\n      imageFrame.rows = img.height;\n      imageFrame.columns = img.width;\n      var context = canvas.getContext('2d');\n\n      context.drawImage(this, 0, 0);\n      var imageData = context.getImageData(0, 0, img.width, img.height);\n      var end = new Date().getTime();\n\n      imageFrame.pixelData = imageData.data;\n      imageFrame.imageData = imageData;\n      imageFrame.decodeTimeInMS = end - start;\n      deferred.resolve(imageFrame);\n    };\n    img.onerror = function (error) {\n      deferred.reject(error);\n    };\n    if (r.readAsBinaryString === undefined) {\n      img.src = 'data:image/jpeg;base64,' + window.btoa(arrayBufferToString(r.result));\n    } else {\n      img.src = 'data:image/jpeg;base64,' + window.btoa(r.result); // doesn't work on IE11\n    }\n  };\n\n  return deferred.promise();\n}\n\nexports.default = decodeJPEGBaseline8BitColor;\n\n/***/ }),\n/* 14 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar events = {\n  name: 'cornerstoneWADOImageLoader'\n};\n\nexports.default = events;\n\n/***/ }),\n/* 15 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _cornerstoneCore = __webpack_require__(1);\n\nvar cornerstone = _interopRequireWildcard(_cornerstoneCore);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction getImageFrame(imageId) {\n  var imagePixelModule = cornerstone.metaData.get('imagePixelModule', imageId);\n\n  return {\n    samplesPerPixel: imagePixelModule.samplesPerPixel,\n    photometricInterpretation: imagePixelModule.photometricInterpretation,\n    planarConfiguration: imagePixelModule.planarConfiguration,\n    rows: imagePixelModule.rows,\n    columns: imagePixelModule.columns,\n    bitsAllocated: imagePixelModule.bitsAllocated,\n    pixelRepresentation: imagePixelModule.pixelRepresentation, // 0 = unsigned,\n    smallestPixelValue: imagePixelModule.smallestPixelValue,\n    largestPixelValue: imagePixelModule.largestPixelValue,\n    redPaletteColorLookupTableDescriptor: imagePixelModule.redPaletteColorLookupTableDescriptor,\n    greenPaletteColorLookupTableDescriptor: imagePixelModule.greenPaletteColorLookupTableDescriptor,\n    bluePaletteColorLookupTableDescriptor: imagePixelModule.bluePaletteColorLookupTableDescriptor,\n    redPaletteColorLookupTableData: imagePixelModule.redPaletteColorLookupTableData,\n    greenPaletteColorLookupTableData: imagePixelModule.greenPaletteColorLookupTableData,\n    bluePaletteColorLookupTableData: imagePixelModule.bluePaletteColorLookupTableData,\n    pixelData: undefined // populated later after decoding\n  };\n}\n\nexports.default = getImageFrame;\n\n/***/ }),\n/* 16 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = getMinMax;\nfunction getMinMax(storedPixelData) {\n  // we always calculate the min max values since they are not always\n  // present in DICOM and we don't want to trust them anyway as cornerstone\n  // depends on us providing reliable values for these\n  var min = storedPixelData[0];\n  var max = storedPixelData[0];\n  var storedPixel = void 0;\n  var numPixels = storedPixelData.length;\n\n  for (var index = 0; index < numPixels; index++) {\n    storedPixel = storedPixelData[index];\n    min = Math.min(min, storedPixel);\n    max = Math.max(max, storedPixel);\n  }\n\n  return {\n    min: min,\n    max: max\n  };\n}\n\n/***/ }),\n/* 17 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (photoMetricInterpretation) {\n  return photoMetricInterpretation === 'RGB' || photoMetricInterpretation === 'PALETTE COLOR' || photoMetricInterpretation === 'YBR_FULL' || photoMetricInterpretation === 'YBR_FULL_422' || photoMetricInterpretation === 'YBR_PARTIAL_422' || photoMetricInterpretation === 'YBR_PARTIAL_420' || photoMetricInterpretation === 'YBR_RCT' || photoMetricInterpretation === 'YBR_ICT';\n};\n\n/***/ }),\n/* 18 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nfunction isJPEGBaseline8BitColor(imageFrame, transferSyntax) {\n  transferSyntax = transferSyntax || imageFrame.transferSyntax;\n\n  if (imageFrame.bitsAllocated === 8 && transferSyntax === '1.2.840.10008.1.2.4.50' && (imageFrame.samplesPerPixel === 3 || imageFrame.samplesPerPixel === 4)) {\n    return true;\n  }\n}\n\nexports.default = isJPEGBaseline8BitColor;\n\n/***/ }),\n/* 19 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _jquery = __webpack_require__(0);\n\nvar _jquery2 = _interopRequireDefault(_jquery);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// the taskId to assign to the next task added via addTask()\nvar nextTaskId = 0;\n\n// array of queued tasks sorted with highest priority task first\nvar tasks = [];\n\n// array of web workers to dispatch decode tasks to\nvar webWorkers = [];\n\nvar defaultConfig = {\n  maxWebWorkers: navigator.hardwareConcurrency || 1,\n  startWebWorkersOnDemand: true,\n  webWorkerPath: '../../dist/cornerstoneWADOImageLoaderWebWorker.js',\n  webWorkerTaskPaths: [],\n  taskConfiguration: {\n    decodeTask: {\n      loadCodecsOnStartup: true,\n      initializeCodecsOnStartup: false,\n      codecsPath: '../dist/cornerstoneWADOImageLoaderCodecs.js',\n      usePDFJS: false\n    }\n  }\n};\n\nvar config = void 0;\n\nvar statistics = {\n  maxWebWorkers: 0,\n  numWebWorkers: 0,\n  numTasksQueued: 0,\n  numTasksExecuting: 0,\n  numTasksCompleted: 0,\n  totalTaskTimeInMS: 0,\n  totalTimeDelayedInMS: 0\n};\n\n/**\r\n * Function to start a task on a web worker\r\n */\nfunction startTaskOnWebWorker() {\n  // return immediately if no decode tasks to do\n  if (!tasks.length) {\n    return;\n  }\n\n  // look for a web worker that is ready\n  for (var i = 0; i < webWorkers.length; i++) {\n    if (webWorkers[i].status === 'ready') {\n      // mark it as busy so tasks are not assigned to it\n      webWorkers[i].status = 'busy';\n\n      // get the highest priority task\n      var task = tasks.shift();\n\n      task.start = new Date().getTime();\n\n      // update stats with how long this task was delayed (waiting in queue)\n      var end = new Date().getTime();\n\n      statistics.totalTimeDelayedInMS += end - task.added;\n\n      // assign this task to this web worker and send the web worker\n      // a message to execute it\n      webWorkers[i].task = task;\n      webWorkers[i].worker.postMessage({\n        taskType: task.taskType,\n        workerIndex: i,\n        data: task.data\n      }, task.transferList);\n      statistics.numTasksExecuting++;\n\n      return;\n    }\n  }\n\n  // if no available web workers and we haven't started max web workers, start a new one\n  if (webWorkers.length < config.maxWebWorkers) {\n    spawnWebWorker();\n  }\n}\n\n/**\r\n * Function to handle a message from a web worker\r\n * @param msg\r\n */\nfunction handleMessageFromWorker(msg) {\n  // console.log('handleMessageFromWorker', msg.data);\n  if (msg.data.taskType === 'initialize') {\n    webWorkers[msg.data.workerIndex].status = 'ready';\n    startTaskOnWebWorker();\n  } else {\n    var start = webWorkers[msg.data.workerIndex].task.start;\n\n    webWorkers[msg.data.workerIndex].task.deferred.resolve(msg.data.result);\n    webWorkers[msg.data.workerIndex].task = undefined;\n\n    statistics.numTasksExecuting--;\n    webWorkers[msg.data.workerIndex].status = 'ready';\n    statistics.numTasksCompleted++;\n\n    var end = new Date().getTime();\n\n    statistics.totalTaskTimeInMS += end - start;\n\n    startTaskOnWebWorker();\n  }\n}\n\n/**\r\n * Spawns a new web worker\r\n */\nfunction spawnWebWorker() {\n  // prevent exceeding maxWebWorkers\n  if (webWorkers.length >= config.maxWebWorkers) {\n    return;\n  }\n\n  // spawn the webworker\n  var worker = new Worker(config.webWorkerPath);\n\n  webWorkers.push({\n    worker: worker,\n    status: 'initializing'\n  });\n  worker.addEventListener('message', handleMessageFromWorker);\n  worker.postMessage({\n    taskType: 'initialize',\n    workerIndex: webWorkers.length - 1,\n    config: config\n  });\n}\n\n/**\r\n * Initialization function for the web worker manager - spawns web workers\r\n * @param configObject\r\n */\nfunction initialize(configObject) {\n  configObject = configObject || defaultConfig;\n\n  // prevent being initialized more than once\n  if (config) {\n    throw new Error('WebWorkerManager already initialized');\n  }\n\n  config = configObject;\n\n  config.maxWebWorkers = config.maxWebWorkers || navigator.hardwareConcurrency || 1;\n\n  // Spawn new web workers\n  if (!config.startWebWorkersOnDemand) {\n    for (var i = 0; i < config.maxWebWorkers; i++) {\n      spawnWebWorker();\n    }\n  }\n}\n\n/**\r\n * dynamically loads a web worker task\r\n * @param sourcePath\r\n * @param taskConfig\r\n */\nfunction loadWebWorkerTask(sourcePath, taskConfig) {\n  // add it to the list of web worker tasks paths so on demand web workers\n  // load this properly\n  config.webWorkerTaskPaths.push(sourcePath);\n\n  // if a task specific configuration is provided, merge it into the config\n  if (taskConfig) {\n    config.taskConfiguration = Object.assign(config.taskConfiguration, taskConfig);\n  }\n\n  // tell each spawned web worker to load this task\n  for (var i = 0; i < webWorkers.length; i++) {\n    webWorkers[i].worker.postMessage({\n      taskType: 'loadWebWorkerTask',\n      workerIndex: webWorkers.length - 1,\n      sourcePath: sourcePath,\n      config: config\n    });\n  }\n}\n\n/**\r\n * Function to add a decode task to be performed\r\n *\r\n * @param taskType - the taskType for this task\r\n * @param data - data specific to the task\r\n * @param priority - optional priority of the task (defaults to 0), > 0 is higher, < 0 is lower\r\n * @param transferList - optional array of data to transfer to web worker\r\n * @returns {*}\r\n */\nfunction addTask(taskType, data) {\n  var priority = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n  var transferList = arguments[3];\n\n  if (!config) {\n    initialize();\n  }\n\n  var deferred = _jquery2.default.Deferred();\n\n  // find the right spot to insert this decode task (based on priority)\n  var i = void 0;\n\n  for (i = 0; i < tasks.length; i++) {\n    if (tasks[i].priority <= priority) {\n      break;\n    }\n  }\n\n  var taskId = nextTaskId++;\n\n  // insert the decode task at position i\n  tasks.splice(i, 0, {\n    taskId: taskId,\n    taskType: taskType,\n    status: 'ready',\n    added: new Date().getTime(),\n    data: data,\n    deferred: deferred,\n    priority: priority,\n    transferList: transferList\n  });\n\n  // try to start a task on the web worker since we just added a new task and a web worker may be available\n  startTaskOnWebWorker();\n\n  return {\n    taskId: taskId,\n    promise: deferred.promise()\n  };\n}\n\n/**\r\n * Changes the priority of a queued task\r\n * @param taskId - the taskId to change the priority of\r\n * @param priority - priority of the task (defaults to 0), > 0 is higher, < 0 is lower\r\n * @returns boolean - true on success, false if taskId not found\r\n */\nfunction setTaskPriority(taskId) {\n  var priority = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n\n  // search for this taskId\n  for (var i = 0; i < tasks.length; i++) {\n    if (tasks[i].taskId === taskId) {\n      // taskId found, remove it\n      var task = tasks.splice(i, 1)[0];\n\n      // set its priority\n      task.priority = priority;\n\n      // find the right spot to insert this decode task (based on priority)\n      for (i = 0; i < tasks.length; i++) {\n        if (tasks[i].priority <= priority) {\n          break;\n        }\n      }\n\n      // insert the decode task at position i\n      tasks.splice(i, 0, task);\n\n      return true;\n    }\n  }\n\n  return false;\n}\n\n/**\r\n * Cancels a queued task and rejects\r\n * @param taskId - the taskId to cancel\r\n * @param reason - optional reason the task was rejected\r\n * @returns boolean - true on success, false if taskId not found\r\n */\nfunction cancelTask(taskId, reason) {\n  // search for this taskId\n  for (var i = 0; i < tasks.length; i++) {\n    if (tasks[i].taskId === taskId) {\n      // taskId found, remove it\n      var task = tasks.splice(i, 1);\n\n      task.promise.reject(reason);\n\n      return true;\n    }\n  }\n\n  return false;\n}\n\n/**\r\n * Function to return the statistics on running web workers\r\n * @returns object containing statistics\r\n */\nfunction getStatistics() {\n  statistics.maxWebWorkers = config.maxWebWorkers;\n  statistics.numWebWorkers = webWorkers.length;\n  statistics.numTasksQueued = tasks.length;\n\n  return statistics;\n}\n\nexports.default = {\n  initialize: initialize,\n  loadWebWorkerTask: loadWebWorkerTask,\n  addTask: addTask,\n  getStatistics: getStatistics,\n  setTaskPriority: setTaskPriority,\n  cancelTask: cancelTask\n};\n\n/***/ }),\n/* 20 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.setOptions = setOptions;\nexports.getOptions = getOptions;\nvar options = {\n  // callback allowing customization of the xhr (e.g. adding custom auth headers, cors, etc)\n  beforeSend: function beforeSend() /* xhr */{},\n\n  // callback allowing modification of newly created image objects\n  imageCreated: function imageCreated() /* image */{}\n};\n\nfunction setOptions(newOptions) {\n  options = newOptions;\n}\n\nfunction getOptions() {\n  return options;\n}\n\n/***/ }),\n/* 21 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nfunction checkToken(token, data, dataOffset) {\n\n  if (dataOffset + token.length > data.length) {\n    return false;\n  }\n\n  var endIndex = dataOffset;\n\n  for (var i = 0; i < token.length; i++) {\n    if (token[i] !== data[endIndex++]) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nfunction stringToUint8Array(str) {\n  var uint = new Uint8Array(str.length);\n\n  for (var i = 0, j = str.length; i < j; i++) {\n    uint[i] = str.charCodeAt(i);\n  }\n\n  return uint;\n}\n\nfunction findIndexOfString(data, str, offset) {\n\n  offset = offset || 0;\n\n  var token = stringToUint8Array(str);\n\n  for (var i = offset; i < data.length; i++) {\n    if (token[0] === data[i]) {\n      // console.log('match @', i);\n      if (checkToken(token, data, i)) {\n        return i;\n      }\n    }\n  }\n\n  return -1;\n}\nexports.default = findIndexOfString;\n\n/***/ }),\n/* 22 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _jquery = __webpack_require__(0);\n\nvar _jquery2 = _interopRequireDefault(_jquery);\n\nvar _internal = __webpack_require__(2);\n\nvar _findIndexOfString = __webpack_require__(21);\n\nvar _findIndexOfString2 = _interopRequireDefault(_findIndexOfString);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction findBoundary(header) {\n  for (var i = 0; i < header.length; i++) {\n    if (header[i].substr(0, 2) === '--') {\n      return header[i];\n    }\n  }\n\n  return undefined;\n}\n\nfunction findContentType(header) {\n  for (var i = 0; i < header.length; i++) {\n    if (header[i].substr(0, 13) === 'Content-Type:') {\n      return header[i].substr(13).trim();\n    }\n  }\n\n  return undefined;\n}\n\nfunction uint8ArrayToString(data, offset, length) {\n  offset = offset || 0;\n  length = length || data.length - offset;\n  var str = '';\n\n  for (var i = offset; i < offset + length; i++) {\n    str += String.fromCharCode(data[i]);\n  }\n\n  return str;\n}\n\nfunction getPixelData(uri, imageId, mediaType) {\n  mediaType = mediaType || 'application/octet-stream';\n  var headers = {\n    accept: mediaType\n  };\n\n  var deferred = _jquery2.default.Deferred();\n\n  var loadPromise = (0, _internal.xhrRequest)(uri, imageId, headers);\n\n  loadPromise.then(function (imageFrameAsArrayBuffer /* , xhr*/) {\n\n    // request succeeded, Parse the multi-part mime response\n    var response = new Uint8Array(imageFrameAsArrayBuffer);\n\n    // First look for the multipart mime header\n    var tokenIndex = (0, _findIndexOfString2.default)(response, '\\r\\n\\r\\n');\n\n    if (tokenIndex === -1) {\n      deferred.reject('invalid response - no multipart mime header');\n    }\n    var header = uint8ArrayToString(response, 0, tokenIndex);\n    // Now find the boundary  marker\n    var split = header.split('\\r\\n');\n    var boundary = findBoundary(split);\n\n    if (!boundary) {\n      deferred.reject('invalid response - no boundary marker');\n    }\n    var offset = tokenIndex + 4; // skip over the \\r\\n\\r\\n\n\n    // find the terminal boundary marker\n    var endIndex = (0, _findIndexOfString2.default)(response, boundary, offset);\n\n    if (endIndex === -1) {\n      deferred.reject('invalid response - terminating boundary not found');\n    }\n\n    // Remove \\r\\n from the length\n    var length = endIndex - offset - 2;\n\n    // return the info for this pixel data\n    deferred.resolve({\n      contentType: findContentType(split),\n      imageFrame: {\n        pixelData: new Uint8Array(imageFrameAsArrayBuffer, offset, length)\n      }\n    });\n  });\n\n  return deferred.promise();\n}\n\nexports.default = getPixelData;\n\n/***/ }),\n/* 23 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _getValue = __webpack_require__(4);\n\nvar _getValue2 = _interopRequireDefault(_getValue);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction getNumberValue(element, index) {\n  var value = (0, _getValue2.default)(element, index);\n\n  if (value === undefined) {\n    return;\n  }\n\n  return parseFloat(value);\n}\n\nexports.default = getNumberValue;\n\n/***/ }),\n/* 24 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\n\n/**\r\n * Returns the values as an array of javascript numbers\r\n *\r\n * @param element - The javascript object for the specified element in the metadata\r\n * @param [minimumLength] - the minimum number of values\r\n * @returns {*}\r\n */\nfunction getNumberValues(element, minimumLength) {\n  if (!element) {\n    return;\n  }\n  // Value is not present if the attribute has a zero length value\n  if (!element.Value) {\n    return;\n  }\n  // make sure we have the expected length\n  if (minimumLength && element.Value.length < minimumLength) {\n    return;\n  }\n\n  var values = [];\n\n  for (var i = 0; i < element.Value.length; i++) {\n    values.push(parseFloat(element.Value[i]));\n  }\n\n  return values;\n}\n\nexports.default = getNumberValues;\n\n/***/ }),\n/* 25 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar files = [];\n\nfunction add(file) {\n  var fileIndex = files.push(file);\n\n  return \"dicomfile:\" + (fileIndex - 1);\n}\n\nfunction get(index) {\n  return files[index];\n}\n\nfunction remove(index) {\n  files[index] = undefined;\n}\n\nfunction purge() {\n  files = [];\n}\n\nexports.default = {\n  add: add,\n  get: get,\n  remove: remove,\n  purge: purge\n};\n\n/***/ }),\n/* 26 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = getEncapsulatedImageFrame;\n\nvar _dicomParser = __webpack_require__(6);\n\nvar dicomParser = _interopRequireWildcard(_dicomParser);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\n/**\r\n * Function to deal with extracting an image frame from an encapsulated data set.\r\n */\n\nfunction framesAreFragmented(dataSet) {\n  var numberOfFrames = dataSet.intString('x00280008');\n  var pixelDataElement = dataSet.elements.x7fe00010;\n\n  return numberOfFrames !== pixelDataElement.fragments.length;\n}\n\nfunction getEncapsulatedImageFrame(dataSet, frameIndex) {\n  if (dataSet.elements.x7fe00010.basicOffsetTable.length) {\n    // Basic Offset Table is not empty\n    return dicomParser.readEncapsulatedImageFrame(dataSet, dataSet.elements.x7fe00010, frameIndex);\n  }\n\n  // Empty basic offset table\n\n  if (framesAreFragmented(dataSet)) {\n    var basicOffsetTable = dicomParser.createJPEGBasicOffsetTable(dataSet, dataSet.elements.x7fe00010);\n\n    return dicomParser.readEncapsulatedImageFrame(dataSet, dataSet.elements.x7fe00010, frameIndex, basicOffsetTable);\n  }\n\n  return dicomParser.readEncapsulatedPixelDataFromFragments(dataSet, dataSet.elements.x7fe00010, frameIndex);\n}\n\n/***/ }),\n/* 27 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _unpackBinaryFrame = __webpack_require__(33);\n\nvar _unpackBinaryFrame2 = _interopRequireDefault(_unpackBinaryFrame);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\r\n * Function to deal with extracting an image frame from an encapsulated data set.\r\n */\n\nfunction getUncompressedImageFrame(dataSet, frameIndex) {\n  var pixelDataElement = dataSet.elements.x7fe00010;\n  var bitsAllocated = dataSet.uint16('x00280100');\n  var rows = dataSet.uint16('x00280010');\n  var columns = dataSet.uint16('x00280011');\n  var samplesPerPixel = dataSet.uint16('x00280002');\n\n  var pixelDataOffset = pixelDataElement.dataOffset;\n  var pixelsPerFrame = rows * columns * samplesPerPixel;\n\n  var frameOffset = void 0;\n\n  if (bitsAllocated === 8) {\n    frameOffset = pixelDataOffset + frameIndex * pixelsPerFrame;\n    if (frameOffset >= dataSet.byteArray.length) {\n      throw 'frame exceeds size of pixelData';\n    }\n\n    return new Uint8Array(dataSet.byteArray.buffer, frameOffset, pixelsPerFrame);\n  } else if (bitsAllocated === 16) {\n    frameOffset = pixelDataOffset + frameIndex * pixelsPerFrame * 2;\n    if (frameOffset >= dataSet.byteArray.length) {\n      throw 'frame exceeds size of pixelData';\n    }\n\n    return new Uint8Array(dataSet.byteArray.buffer, frameOffset, pixelsPerFrame * 2);\n  } else if (bitsAllocated === 1) {\n    frameOffset = pixelDataOffset + frameIndex * pixelsPerFrame * 0.125;\n    if (frameOffset >= dataSet.byteArray.length) {\n      throw 'frame exceeds size of pixelData';\n    }\n\n    return (0, _unpackBinaryFrame2.default)(dataSet.byteArray, frameOffset, pixelsPerFrame);\n  }\n\n  throw 'unsupported pixel format';\n}\n\nexports.default = getUncompressedImageFrame;\n\n/***/ }),\n/* 28 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _jquery = __webpack_require__(0);\n\nvar _jquery2 = _interopRequireDefault(_jquery);\n\nvar _parseImageId = __webpack_require__(5);\n\nvar _parseImageId2 = _interopRequireDefault(_parseImageId);\n\nvar _fileManager = __webpack_require__(25);\n\nvar _fileManager2 = _interopRequireDefault(_fileManager);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction loadFileRequest(uri) {\n  var parsedImageId = (0, _parseImageId2.default)(uri);\n  var fileIndex = parseInt(parsedImageId.url, 10);\n  var file = _fileManager2.default.get(fileIndex);\n\n  // create a deferred object\n  var deferred = _jquery2.default.Deferred();\n\n  var fileReader = new FileReader();\n\n  fileReader.onload = function (e) {\n    var dicomPart10AsArrayBuffer = e.target.result;\n\n    deferred.resolve(dicomPart10AsArrayBuffer);\n  };\n  fileReader.readAsArrayBuffer(file);\n\n  return deferred.promise();\n}\n\nexports.default = loadFileRequest;\n\n/***/ }),\n/* 29 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\n\nfunction getLutDescriptor(dataSet, tag) {\n  if (!dataSet.elements[tag] || dataSet.elements[tag].length !== 6) {\n    return;\n  }\n\n  return [dataSet.uint16(tag, 0), dataSet.uint16(tag, 1), dataSet.uint16(tag, 2)];\n}\n\nfunction getLutData(lutDataSet, tag, lutDescriptor) {\n  var lut = [];\n  var lutData = lutDataSet.elements[tag];\n  var numLutEntries = lutDescriptor[0];\n\n  for (var i = 0; i < numLutEntries; i++) {\n    // Output range is always unsigned\n    if (lutDescriptor[2] === 16) {\n      lut[i] = lutDataSet.uint16(tag, i);\n    } else {\n      lut[i] = lutDataSet.byteArray[i + lutData.dataOffset];\n    }\n  }\n\n  return lut;\n}\n\nfunction populatePaletteColorLut(dataSet, imagePixelModule) {\n  // return immediately if no palette lut elements\n  if (!dataSet.elements.x00281101) {\n    return;\n  }\n  imagePixelModule.redPaletteColorLookupTableDescriptor = getLutDescriptor(dataSet, 'x00281101');\n  imagePixelModule.greenPaletteColorLookupTableDescriptor = getLutDescriptor(dataSet, 'x00281102');\n  imagePixelModule.bluePaletteColorLookupTableDescriptor = getLutDescriptor(dataSet, 'x00281103');\n\n  imagePixelModule.redPaletteColorLookupTableData = getLutData(dataSet, 'x00281201', imagePixelModule.redPaletteColorLookupTableDescriptor);\n  imagePixelModule.greenPaletteColorLookupTableData = getLutData(dataSet, 'x00281202', imagePixelModule.greenPaletteColorLookupTableDescriptor);\n  imagePixelModule.bluePaletteColorLookupTableData = getLutData(dataSet, 'x00281203', imagePixelModule.bluePaletteColorLookupTableDescriptor);\n}\n\nfunction populateSmallestLargestPixelValues(dataSet, imagePixelModule) {\n  var pixelRepresentation = dataSet.uint16('x00280103');\n\n  if (pixelRepresentation === 0) {\n    imagePixelModule.smallestPixelValue = dataSet.uint16('x00280106');\n    imagePixelModule.largestPixelValue = dataSet.uint16('x00280107');\n  } else {\n    imagePixelModule.smallestPixelValue = dataSet.int16('x00280106');\n    imagePixelModule.largestPixelValue = dataSet.int16('x00280107');\n  }\n}\n\nfunction getImagePixelModule(dataSet) {\n\n  var imagePixelModule = {\n    samplesPerPixel: dataSet.uint16('x00280002'),\n    photometricInterpretation: dataSet.string('x00280004'),\n    rows: dataSet.uint16('x00280010'),\n    columns: dataSet.uint16('x00280011'),\n    bitsAllocated: dataSet.uint16('x00280100'),\n    bitsStored: dataSet.uint16('x00280101'),\n    highBit: dataSet.uint16('x00280102'),\n    pixelRepresentation: dataSet.uint16('x00280103'),\n    planarConfiguration: dataSet.uint16('x00280006'),\n    pixelAspectRatio: dataSet.string('x00280034')\n  };\n\n  populateSmallestLargestPixelValues(dataSet, imagePixelModule);\n  populatePaletteColorLut(dataSet, imagePixelModule);\n\n  return imagePixelModule;\n}\n\nexports.default = getImagePixelModule;\n\n/***/ }),\n/* 30 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\n\nfunction getLUT(pixelRepresentation, lutDataSet) {\n  var numLUTEntries = lutDataSet.uint16('x00283002', 0);\n\n  if (numLUTEntries === 0) {\n    numLUTEntries = 65535;\n  }\n  var firstValueMapped = 0;\n\n  if (pixelRepresentation === 0) {\n    firstValueMapped = lutDataSet.uint16('x00283002', 1);\n  } else {\n    firstValueMapped = lutDataSet.int16('x00283002', 1);\n  }\n  var numBitsPerEntry = lutDataSet.uint16('x00283002', 2);\n  // console.log('LUT(', numLUTEntries, ',', firstValueMapped, ',', numBitsPerEntry, ')');\n  var lut = {\n    id: '1',\n    firstValueMapped: firstValueMapped,\n    numBitsPerEntry: numBitsPerEntry,\n    lut: []\n  };\n\n  // console.log(\"minValue=\", minValue, \"; maxValue=\", maxValue);\n  for (var i = 0; i < numLUTEntries; i++) {\n    if (pixelRepresentation === 0) {\n      lut.lut[i] = lutDataSet.uint16('x00283006', i);\n    } else {\n      lut.lut[i] = lutDataSet.int16('x00283006', i);\n    }\n  }\n\n  return lut;\n}\n\nfunction getLUTs(pixelRepresentation, lutSequence) {\n  if (!lutSequence || !lutSequence.items.length) {\n    return;\n  }\n  var luts = [];\n\n  for (var i = 0; i < lutSequence.items.length; i++) {\n    var lutDataSet = lutSequence.items[i].dataSet;\n    var lut = getLUT(pixelRepresentation, lutDataSet);\n\n    if (lut) {\n      luts.push(lut);\n    }\n  }\n\n  return luts;\n}\n\nexports.default = getLUTs;\n\n/***/ }),\n/* 31 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n/* eslint no-bitwise: 0 */\n\nfunction getMinStoredPixelValue(dataSet) {\n  var pixelRepresentation = dataSet.uint16('x00280103');\n  var bitsStored = dataSet.uint16('x00280101');\n\n  if (pixelRepresentation === 0) {\n    return 0;\n  }\n\n  return -1 << bitsStored - 1;\n}\n\n// 0 = unsigned / US, 1 = signed / SS\nfunction getModalityLUTOutputPixelRepresentation(dataSet) {\n\n  // CT SOP Classes are always signed\n  var sopClassUID = dataSet.string('x00080016');\n\n  if (sopClassUID === '1.2.840.10008.5.1.4.1.1.2' || sopClassUID === '1.2.840.10008.5.1.4.1.1.2.1') {\n    return 1;\n  }\n\n  // if rescale intercept and rescale slope are present, pass the minimum stored\n  // pixel value through them to see if we get a signed output range\n  var rescaleIntercept = dataSet.floatString('x00281052');\n  var rescaleSlope = dataSet.floatString('x00281053');\n\n  if (rescaleIntercept !== undefined && rescaleSlope !== undefined) {\n    var minStoredPixelValue = getMinStoredPixelValue(dataSet); //\n    var minModalityLutValue = minStoredPixelValue * rescaleSlope + rescaleIntercept;\n\n    if (minModalityLutValue < 0) {\n      return 1;\n    }\n\n    return 0;\n  }\n\n  // Output of non linear modality lut is always unsigned\n  if (dataSet.elements.x00283000 && dataSet.elements.x00283000.length > 0) {\n    return 0;\n  }\n\n  // If no modality lut transform, output is same as pixel representation\n  return dataSet.uint16('x00280103');\n}\n\nexports.default = getModalityLUTOutputPixelRepresentation;\n\n/***/ }),\n/* 32 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nfunction getNumberValues(dataSet, tag, minimumLength) {\n  var values = [];\n  var valueAsString = dataSet.string(tag);\n\n  if (!valueAsString) {\n    return;\n  }\n  var split = valueAsString.split('\\\\');\n\n  if (minimumLength && split.length < minimumLength) {\n    return;\n  }\n  for (var i = 0; i < split.length; i++) {\n    values.push(parseFloat(split[i]));\n  }\n\n  return values;\n}\n\nexports.default = getNumberValues;\n\n/***/ }),\n/* 33 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n/* eslint no-bitwise: 0 */\n\nfunction isBitSet(byte, bitPos) {\n  return byte & 1 << bitPos;\n}\n\n/**\r\n * Function to deal with unpacking a binary frame\r\n */\nfunction unpackBinaryFrame(byteArray, frameOffset, pixelsPerFrame) {\n  // Create a new pixel array given the image size\n  var pixelData = new Uint8Array(pixelsPerFrame);\n\n  for (var i = 0; i < pixelsPerFrame; i++) {\n    // Compute byte position\n    var bytePos = Math.floor(i / 8);\n\n    // Get the current byte\n    var byte = byteArray[bytePos + frameOffset];\n\n    // Bit position (0-7) within byte\n    var bitPos = i % 8;\n\n    // Check whether bit at bitpos is set\n    pixelData[i] = isBitSet(byte, bitPos) ? 1 : 0;\n  }\n\n  return pixelData;\n}\n\nexports.default = unpackBinaryFrame;\n\n/***/ }),\n/* 34 */,\n/* 35 */,\n/* 36 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _internal = __webpack_require__(2);\n\nfunction configure(options) {\n  (0, _internal.setOptions)(options);\n}\n\nexports.default = configure;\n\n/***/ }),\n/* 37 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _metaData = __webpack_require__(50);\n\nvar _findIndexOfString = __webpack_require__(21);\n\nvar _findIndexOfString2 = _interopRequireDefault(_findIndexOfString);\n\nvar _getPixelData = __webpack_require__(22);\n\nvar _getPixelData2 = _interopRequireDefault(_getPixelData);\n\nvar _metaDataManager = __webpack_require__(8);\n\nvar _metaDataManager2 = _interopRequireDefault(_metaDataManager);\n\nvar _loadImage = __webpack_require__(48);\n\nvar _loadImage2 = _interopRequireDefault(_loadImage);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar metaData = {\n  getNumberString: _metaData.getNumberString,\n  getNumberValue: _metaData.getNumberValue,\n  getNumberValues: _metaData.getNumberValues,\n  getValue: _metaData.getValue,\n  metaDataProvider: _metaData.metaDataProvider\n};\n\nexports.default = {\n  metaData: metaData,\n  findIndexOfString: _findIndexOfString2.default,\n  getPixelData: _getPixelData2.default,\n  loadImage: _loadImage2.default,\n  metaDataManager: _metaDataManager2.default\n};\n\n/***/ }),\n/* 38 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _metaData = __webpack_require__(53);\n\nvar _dataSetCacheManager = __webpack_require__(9);\n\nvar _dataSetCacheManager2 = _interopRequireDefault(_dataSetCacheManager);\n\nvar _fileManager = __webpack_require__(25);\n\nvar _fileManager2 = _interopRequireDefault(_fileManager);\n\nvar _getEncapsulatedImageFrame = __webpack_require__(26);\n\nvar _getEncapsulatedImageFrame2 = _interopRequireDefault(_getEncapsulatedImageFrame);\n\nvar _getUncompressedImageFrame = __webpack_require__(27);\n\nvar _getUncompressedImageFrame2 = _interopRequireDefault(_getUncompressedImageFrame);\n\nvar _loadFileRequest = __webpack_require__(28);\n\nvar _loadFileRequest2 = _interopRequireDefault(_loadFileRequest);\n\nvar _loadImage = __webpack_require__(52);\n\nvar _loadImage2 = _interopRequireDefault(_loadImage);\n\nvar _parseImageId = __webpack_require__(5);\n\nvar _parseImageId2 = _interopRequireDefault(_parseImageId);\n\nvar _unpackBinaryFrame = __webpack_require__(33);\n\nvar _unpackBinaryFrame2 = _interopRequireDefault(_unpackBinaryFrame);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar metaData = {\n  getImagePixelModule: _metaData.getImagePixelModule,\n  getLUTs: _metaData.getLUTs,\n  getModalityLUTOutputPixelRepresentation: _metaData.getModalityLUTOutputPixelRepresentation,\n  getNumberValues: _metaData.getNumberValues,\n  metaDataProvider: _metaData.metaDataProvider\n};\n\nexports.default = {\n  metaData: metaData,\n  dataSetCacheManager: _dataSetCacheManager2.default,\n  fileManager: _fileManager2.default,\n  getEncapsulatedImageFrame: _getEncapsulatedImageFrame2.default,\n  getUncompressedImageFrame: _getUncompressedImageFrame2.default,\n  loadFileRequest: _loadFileRequest2.default,\n  loadImage: _loadImage2.default,\n  parseImageId: _parseImageId2.default,\n  unpackBinaryFrame: _unpackBinaryFrame2.default\n};\n\n/***/ }),\n/* 39 */,\n/* 40 */,\n/* 41 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (imageFrame, rgbaBuffer) {\n  var numPixels = imageFrame.columns * imageFrame.rows;\n  var palIndex = 0;\n  var rgbaIndex = 0;\n  var pixelData = imageFrame.pixelData;\n  var start = imageFrame.redPaletteColorLookupTableDescriptor[1];\n  var rData = imageFrame.redPaletteColorLookupTableData;\n  var gData = imageFrame.greenPaletteColorLookupTableData;\n  var bData = imageFrame.bluePaletteColorLookupTableData;\n  var shift = imageFrame.redPaletteColorLookupTableDescriptor[2] === 8 ? 0 : 8;\n  var len = imageFrame.redPaletteColorLookupTableData.length;\n\n  if (len === 0) {\n    len = 65535;\n  }\n\n  for (var i = 0; i < numPixels; ++i) {\n    var value = pixelData[palIndex++];\n\n    if (value < start) {\n      value = 0;\n    } else if (value > start + len - 1) {\n      value = len - 1;\n    } else {\n      value -= start;\n    }\n\n    rgbaBuffer[rgbaIndex++] = rData[value] >> shift;\n    rgbaBuffer[rgbaIndex++] = gData[value] >> shift;\n    rgbaBuffer[rgbaIndex++] = bData[value] >> shift;\n    rgbaBuffer[rgbaIndex++] = 255;\n  }\n};\n\n/***/ }),\n/* 42 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (imageFrame, rgbaBuffer) {\n  if (imageFrame === undefined) {\n    throw new Error('decodeRGB: rgbBuffer must not be undefined');\n  }\n  if (imageFrame.length % 3 !== 0) {\n    throw new Error('decodeRGB: rgbBuffer length must be divisible by 3');\n  }\n\n  var numPixels = imageFrame.length / 3;\n  var rgbIndex = 0;\n  var rgbaIndex = 0;\n\n  for (var i = 0; i < numPixels; i++) {\n    rgbaBuffer[rgbaIndex++] = imageFrame[rgbIndex++]; // red\n    rgbaBuffer[rgbaIndex++] = imageFrame[rgbIndex++]; // green\n    rgbaBuffer[rgbaIndex++] = imageFrame[rgbIndex++]; // blue\n    rgbaBuffer[rgbaIndex++] = 255; // alpha\n  }\n};\n\n/***/ }),\n/* 43 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (imageFrame, rgbaBuffer) {\n  if (imageFrame === undefined) {\n    throw new Error('decodeRGB: rgbBuffer must not be undefined');\n  }\n  if (imageFrame.length % 3 !== 0) {\n    throw new Error('decodeRGB: rgbBuffer length must be divisible by 3');\n  }\n\n  var numPixels = imageFrame.length / 3;\n  var rgbaIndex = 0;\n  var rIndex = 0;\n  var gIndex = numPixels;\n  var bIndex = numPixels * 2;\n\n  for (var i = 0; i < numPixels; i++) {\n    rgbaBuffer[rgbaIndex++] = imageFrame[rIndex++]; // red\n    rgbaBuffer[rgbaIndex++] = imageFrame[gIndex++]; // green\n    rgbaBuffer[rgbaIndex++] = imageFrame[bIndex++]; // blue\n    rgbaBuffer[rgbaIndex++] = 255; // alpha\n  }\n};\n\n/***/ }),\n/* 44 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (imageFrame, rgbaBuffer) {\n  if (imageFrame === undefined) {\n    throw new Error('decodeRGB: ybrBuffer must not be undefined');\n  }\n  if (imageFrame.length % 3 !== 0) {\n    throw new Error('decodeRGB: ybrBuffer length must be divisble by 3');\n  }\n\n  var numPixels = imageFrame.length / 3;\n  var ybrIndex = 0;\n  var rgbaIndex = 0;\n\n  for (var i = 0; i < numPixels; i++) {\n    var y = imageFrame[ybrIndex++];\n    var cb = imageFrame[ybrIndex++];\n    var cr = imageFrame[ybrIndex++];\n\n    rgbaBuffer[rgbaIndex++] = y + 1.40200 * (cr - 128); // red\n    rgbaBuffer[rgbaIndex++] = y - 0.34414 * (cb - 128) - 0.71414 * (cr - 128); // green\n    rgbaBuffer[rgbaIndex++] = y + 1.77200 * (cb - 128); // blue\n    rgbaBuffer[rgbaIndex++] = 255; // alpha\n  }\n};\n\n/***/ }),\n/* 45 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (imageFrame, rgbaBuffer) {\n  if (imageFrame === undefined) {\n    throw new Error('decodeRGB: ybrBuffer must not be undefined');\n  }\n  if (imageFrame.length % 3 !== 0) {\n    throw new Error('decodeRGB: ybrBuffer length must be divisble by 3');\n  }\n\n  var numPixels = imageFrame.length / 3;\n  var rgbaIndex = 0;\n  var yIndex = 0;\n  var cbIndex = numPixels;\n  var crIndex = numPixels * 2;\n\n  for (var i = 0; i < numPixels; i++) {\n    var y = imageFrame[yIndex++];\n    var cb = imageFrame[cbIndex++];\n    var cr = imageFrame[crIndex++];\n\n    rgbaBuffer[rgbaIndex++] = y + 1.40200 * (cr - 128); // red\n    rgbaBuffer[rgbaIndex++] = y - 0.34414 * (cb - 128) - 0.71414 * (cr - 128); // green\n    rgbaBuffer[rgbaIndex++] = y + 1.77200 * (cb - 128); // blue\n    rgbaBuffer[rgbaIndex++] = 255; // alpha\n  }\n};\n\n/***/ }),\n/* 46 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _colorSpaceConverters = __webpack_require__(10);\n\nObject.keys(_colorSpaceConverters).forEach(function (key) {\n  if (key === \"default\" || key === \"__esModule\") return;\n  Object.defineProperty(exports, key, {\n    enumerable: true,\n    get: function get() {\n      return _colorSpaceConverters[key];\n    }\n  });\n});\n\nvar _wadouri = __webpack_require__(38);\n\nObject.defineProperty(exports, 'wadouri', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_wadouri).default;\n  }\n});\n\nvar _wadors = __webpack_require__(37);\n\nObject.defineProperty(exports, 'wadors', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_wadors).default;\n  }\n});\n\nvar _configure = __webpack_require__(36);\n\nObject.defineProperty(exports, 'configure', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_configure).default;\n  }\n});\n\nvar _convertColorSpace = __webpack_require__(11);\n\nObject.defineProperty(exports, 'convertColorSpace', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_convertColorSpace).default;\n  }\n});\n\nvar _createImage = __webpack_require__(7);\n\nObject.defineProperty(exports, 'createImage', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_createImage).default;\n  }\n});\n\nvar _decodeImageFrame = __webpack_require__(12);\n\nObject.defineProperty(exports, 'decodeImageFrame', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_decodeImageFrame).default;\n  }\n});\n\nvar _decodeJPEGBaseline8BitColor = __webpack_require__(13);\n\nObject.defineProperty(exports, 'decodeJPEGBaseline8BitColor', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_decodeJPEGBaseline8BitColor).default;\n  }\n});\n\nvar _getImageFrame = __webpack_require__(15);\n\nObject.defineProperty(exports, 'getImageFrame', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_getImageFrame).default;\n  }\n});\n\nvar _getMinMax = __webpack_require__(16);\n\nObject.defineProperty(exports, 'getMinMax', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_getMinMax).default;\n  }\n});\n\nvar _isColorImage = __webpack_require__(17);\n\nObject.defineProperty(exports, 'isColorImage', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_isColorImage).default;\n  }\n});\n\nvar _isJPEGBaseline8BitColor = __webpack_require__(18);\n\nObject.defineProperty(exports, 'isJPEGBaseline8BitColor', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_isJPEGBaseline8BitColor).default;\n  }\n});\n\nvar _webWorkerManager = __webpack_require__(19);\n\nObject.defineProperty(exports, 'webWorkerManager', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_webWorkerManager).default;\n  }\n});\n\nvar _version = __webpack_require__(3);\n\nObject.defineProperty(exports, 'version', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_version).default;\n  }\n});\n\nvar _internal = __webpack_require__(2);\n\nObject.defineProperty(exports, 'internal', {\n  enumerable: true,\n  get: function get() {\n    return _internal.internal;\n  }\n});\n\nvar _events = __webpack_require__(14);\n\nObject.defineProperty(exports, 'events', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_events).default;\n  }\n});\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/***/ }),\n/* 47 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _jquery = __webpack_require__(0);\n\nvar _jquery2 = _interopRequireDefault(_jquery);\n\nvar _options = __webpack_require__(20);\n\nvar _cornerstoneCore = __webpack_require__(1);\n\nvar cornerstone = _interopRequireWildcard(_cornerstoneCore);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction xhrRequest(url, imageId) {\n  var headers = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n  var deferred = _jquery2.default.Deferred();\n  var options = (0, _options.getOptions)();\n\n  // Make the request for the DICOM P10 SOP Instance\n  var xhr = new XMLHttpRequest();\n\n  xhr.open('get', url, true);\n  xhr.responseType = 'arraybuffer';\n  options.beforeSend(xhr);\n  Object.keys(headers).forEach(function (key) {\n    xhr.setRequestHeader(key, headers[key]);\n  });\n\n  // handle response data\n  xhr.onreadystatechange = function () {\n    // TODO: consider sending out progress messages here as we receive the pixel data\n    if (xhr.readyState === 4) {\n      if (xhr.status === 200) {\n        deferred.resolve(xhr.response, xhr);\n      } else {\n        // request failed, reject the deferred\n        deferred.reject(xhr);\n      }\n    }\n  };\n  xhr.onprogress = function (oProgress) {\n    // console.log('progress:',oProgress)\n\n    if (oProgress.lengthComputable) {\n      // evt.loaded the bytes browser receive\n      // evt.total the total bytes seted by the header\n      //\n      var loaded = oProgress.loaded;\n      var total = oProgress.total;\n      var percentComplete = Math.round(loaded / total * 100);\n\n      (0, _jquery2.default)(cornerstone.events).trigger('CornerstoneImageLoadProgress', {\n        imageId: imageId,\n        loaded: loaded,\n        total: total,\n        percentComplete: percentComplete\n      });\n    }\n  };\n\n  xhr.send();\n\n  return deferred.promise();\n}\n\nexports.default = xhrRequest;\n\n/***/ }),\n/* 48 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _jquery = __webpack_require__(0);\n\nvar _jquery2 = _interopRequireDefault(_jquery);\n\nvar _cornerstoneCore = __webpack_require__(1);\n\nvar cornerstone = _interopRequireWildcard(_cornerstoneCore);\n\nvar _metaDataManager = __webpack_require__(8);\n\nvar _metaDataManager2 = _interopRequireDefault(_metaDataManager);\n\nvar _getPixelData = __webpack_require__(22);\n\nvar _getPixelData2 = _interopRequireDefault(_getPixelData);\n\nvar _createImage = __webpack_require__(7);\n\nvar _createImage2 = _interopRequireDefault(_createImage);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction getTransferSyntaxForContentType() /* contentType */{\n  return '1.2.840.10008.1.2'; // hard code to ILE for now\n}\n\nfunction loadImage(imageId, options) {\n  var start = new Date().getTime();\n\n  var deferred = _jquery2.default.Deferred();\n\n  var uri = imageId.substring(7);\n\n  // check to make sure we have metadata for this imageId\n  var metaData = _metaDataManager2.default.get(imageId);\n\n  if (metaData === undefined) {\n    deferred.reject('no metadata for imageId ' + imageId);\n\n    return deferred.promise();\n  }\n\n  // TODO: load bulk data items that we might need\n\n  var mediaType = 'multipart/related; type=\"application/octet-stream\"'; // 'image/dicom+jp2';\n\n  // get the pixel data from the server\n  (0, _getPixelData2.default)(uri, imageId, mediaType).then(function (result) {\n\n    var transferSyntax = getTransferSyntaxForContentType(result.contentType);\n    var pixelData = result.imageFrame.pixelData;\n    var imagePromise = (0, _createImage2.default)(imageId, pixelData, transferSyntax, options);\n\n    imagePromise.then(function (image) {\n      // add the loadTimeInMS property\n      var end = new Date().getTime();\n\n      image.loadTimeInMS = end - start;\n      deferred.resolve(image);\n    });\n  }).fail(function (reason) {\n    deferred.reject(reason);\n  });\n\n  return deferred;\n}\n\n// register wadors scheme\ncornerstone.registerImageLoader('wadors', loadImage);\n\nexports.default = loadImage;\n\n/***/ }),\n/* 49 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _getValue = __webpack_require__(4);\n\nvar _getValue2 = _interopRequireDefault(_getValue);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\r\n * Returns the first string value as a Javascript number\r\n *\r\n * @param element - The javascript object for the specified element in the metadata\r\n * @param [index] - the index of the value in a multi-valued element, default is 0\r\n * @param [defaultValue] - The default value to return if the element does not exist\r\n * @returns {*}\r\n */\nfunction getNumberString(element, index, defaultValue) {\n  var value = (0, _getValue2.default)(element, index, defaultValue);\n\n  if (value === undefined) {\n    return;\n  }\n\n  return parseFloat(value);\n}\n\nexports.default = getNumberString;\n\n/***/ }),\n/* 50 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _getNumberString = __webpack_require__(49);\n\nObject.defineProperty(exports, 'getNumberString', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_getNumberString).default;\n  }\n});\n\nvar _getNumberValue = __webpack_require__(23);\n\nObject.defineProperty(exports, 'getNumberValue', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_getNumberValue).default;\n  }\n});\n\nvar _getNumberValues = __webpack_require__(24);\n\nObject.defineProperty(exports, 'getNumberValues', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_getNumberValues).default;\n  }\n});\n\nvar _getValue = __webpack_require__(4);\n\nObject.defineProperty(exports, 'getValue', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_getValue).default;\n  }\n});\n\nvar _metaDataProvider = __webpack_require__(51);\n\nObject.defineProperty(exports, 'metaDataProvider', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_metaDataProvider).default;\n  }\n});\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/***/ }),\n/* 51 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _getNumberValues = __webpack_require__(24);\n\nvar _getNumberValues2 = _interopRequireDefault(_getNumberValues);\n\nvar _getValue = __webpack_require__(4);\n\nvar _getValue2 = _interopRequireDefault(_getValue);\n\nvar _getNumberValue = __webpack_require__(23);\n\nvar _getNumberValue2 = _interopRequireDefault(_getNumberValue);\n\nvar _metaDataManager = __webpack_require__(8);\n\nvar _metaDataManager2 = _interopRequireDefault(_metaDataManager);\n\nvar _dicomParser = __webpack_require__(6);\n\nvar dicomParser = _interopRequireWildcard(_dicomParser);\n\nvar _cornerstoneCore = __webpack_require__(1);\n\nvar cornerstone = _interopRequireWildcard(_cornerstoneCore);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction metaDataProvider(type, imageId) {\n  var metaData = _metaDataManager2.default.get(imageId);\n\n  if (!metaData) {\n    return;\n  }\n\n  if (type === 'generalSeriesModule') {\n    return {\n      modality: (0, _getValue2.default)(metaData['00080060']),\n      seriesInstanceUID: (0, _getValue2.default)(metaData['0020000e']),\n      seriesNumber: (0, _getNumberValue2.default)(metaData['00200011']),\n      studyInstanceUID: (0, _getValue2.default)(metaData['0020000d']),\n      seriesDate: dicomParser.parseDA((0, _getValue2.default)(metaData['00080021'])),\n      seriesTime: dicomParser.parseTM((0, _getValue2.default)(metaData['00080031'], 0, ''))\n    };\n  }\n\n  if (type === 'patientStudyModule') {\n    return {\n      patientAge: (0, _getNumberValue2.default)(metaData['00101010']),\n      patientSize: (0, _getNumberValue2.default)(metaData['00101020']),\n      patientWeight: (0, _getNumberValue2.default)(metaData['00101030'])\n    };\n  }\n\n  if (type === 'imagePlaneModule') {\n    return {\n      pixelSpacing: (0, _getNumberValues2.default)(metaData['00280030'], 2),\n      imageOrientationPatient: (0, _getNumberValues2.default)(metaData['00200037'], 6),\n      imagePositionPatient: (0, _getNumberValues2.default)(metaData['00200032'], 3),\n      sliceThickness: (0, _getNumberValue2.default)(metaData['00180050']),\n      sliceLocation: (0, _getNumberValue2.default)(metaData['00201041'])\n    };\n  }\n\n  if (type === 'imagePixelModule') {\n    return {\n      samplesPerPixel: (0, _getNumberValue2.default)(metaData['00280002']),\n      photometricInterpretation: (0, _getValue2.default)(metaData['00280004']),\n      rows: (0, _getNumberValue2.default)(metaData['00280010']),\n      columns: (0, _getNumberValue2.default)(metaData['00280011']),\n      bitsAllocated: (0, _getNumberValue2.default)(metaData['00280100']),\n      bitsStored: (0, _getNumberValue2.default)(metaData['00280101']),\n      highBit: (0, _getValue2.default)(metaData['00280102']),\n      pixelRepresentation: (0, _getNumberValue2.default)(metaData['00280103']),\n      planarConfiguration: (0, _getNumberValue2.default)(metaData['00280006']),\n      pixelAspectRatio: (0, _getValue2.default)(metaData['00280034']),\n      smallestPixelValue: (0, _getNumberValue2.default)(metaData['00280106']),\n      largestPixelValue: (0, _getNumberValue2.default)(metaData['00280107']),\n      redPaletteColorLookupTableDescriptor: (0, _getNumberValues2.default)(metaData['00281101']),\n      greenPaletteColorLookupTableDescriptor: (0, _getNumberValues2.default)(metaData['00281102']),\n      bluePaletteColorLookupTableDescriptor: (0, _getNumberValues2.default)(metaData['00281103']),\n      redPaletteColorLookupTableData: (0, _getNumberValues2.default)(metaData['00281201']),\n      greenPaletteColorLookupTableData: (0, _getNumberValues2.default)(metaData['00281202']),\n      bluePaletteColorLookupTableData: (0, _getNumberValues2.default)(metaData['00281203'])\n    };\n  }\n\n  if (type === 'voiLutModule') {\n    return {\n      // TODO VOT LUT Sequence\n      windowCenter: (0, _getNumberValues2.default)(metaData['00281050'], 1),\n      windowWidth: (0, _getNumberValues2.default)(metaData['00281051'], 1)\n    };\n  }\n\n  if (type === 'modalityLutModule') {\n    return {\n      // TODO VOT LUT Sequence\n      rescaleIntercept: (0, _getNumberValue2.default)(metaData['00281052']),\n      rescaleSlope: (0, _getNumberValue2.default)(metaData['00281053']),\n      rescaleType: (0, _getValue2.default)(metaData['00281054'])\n    };\n  }\n\n  if (type === 'sopCommonModule') {\n    return {\n      sopClassUID: (0, _getValue2.default)(metaData['00080016']),\n      sopInstanceUID: (0, _getValue2.default)(metaData['00080018'])\n    };\n  }\n\n  if (type === 'petIsotopeModule') {\n    var radiopharmaceuticalInfo = (0, _getValue2.default)(metaData['00540016']);\n\n    if (radiopharmaceuticalInfo === undefined) {\n      return;\n    }\n\n    return {\n      radiopharmaceuticalInfo: {\n        radiopharmaceuticalStartTime: dicomParser.parseTM((0, _getValue2.default)(radiopharmaceuticalInfo['00181072'], 0, '')),\n        radionuclideTotalDose: (0, _getNumberValue2.default)(radiopharmaceuticalInfo['00181074']),\n        radionuclideHalfLife: (0, _getNumberValue2.default)(radiopharmaceuticalInfo['00181075'])\n      }\n    };\n  }\n}\n\ncornerstone.metaData.addProvider(metaDataProvider);\n\nexports.default = metaDataProvider;\n\n/***/ }),\n/* 52 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _jquery = __webpack_require__(0);\n\nvar _jquery2 = _interopRequireDefault(_jquery);\n\nvar _cornerstoneCore = __webpack_require__(1);\n\nvar cornerstone = _interopRequireWildcard(_cornerstoneCore);\n\nvar _createImage = __webpack_require__(7);\n\nvar _createImage2 = _interopRequireDefault(_createImage);\n\nvar _parseImageId = __webpack_require__(5);\n\nvar _parseImageId2 = _interopRequireDefault(_parseImageId);\n\nvar _dataSetCacheManager = __webpack_require__(9);\n\nvar _dataSetCacheManager2 = _interopRequireDefault(_dataSetCacheManager);\n\nvar _getEncapsulatedImageFrame = __webpack_require__(26);\n\nvar _getEncapsulatedImageFrame2 = _interopRequireDefault(_getEncapsulatedImageFrame);\n\nvar _getUncompressedImageFrame = __webpack_require__(27);\n\nvar _getUncompressedImageFrame2 = _interopRequireDefault(_getUncompressedImageFrame);\n\nvar _loadFileRequest = __webpack_require__(28);\n\nvar _loadFileRequest2 = _interopRequireDefault(_loadFileRequest);\n\nvar _internal = __webpack_require__(2);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// add a decache callback function to clear out our dataSetCacheManager\nfunction addDecache(image) {\n  image.decache = function () {\n    // console.log('decache');\n    var parsedImageId = (0, _parseImageId2.default)(image.imageId);\n\n    _dataSetCacheManager2.default.unload(parsedImageId.url);\n  };\n}\n\nfunction getPixelData(dataSet, frameIndex) {\n  var pixelDataElement = dataSet.elements.x7fe00010;\n\n  if (pixelDataElement.encapsulatedPixelData) {\n    return (0, _getEncapsulatedImageFrame2.default)(dataSet, frameIndex);\n  }\n\n  return (0, _getUncompressedImageFrame2.default)(dataSet, frameIndex);\n}\n\nfunction loadImageFromPromise(dataSetPromise, imageId, frame, sharedCacheKey, options) {\n\n  var start = new Date().getTime();\n\n  frame = frame || 0;\n  var deferred = _jquery2.default.Deferred();\n\n  dataSetPromise.then(function (dataSet /* , xhr*/) {\n    var pixelData = getPixelData(dataSet, frame);\n    var transferSyntax = dataSet.string('x00020010');\n    var loadEnd = new Date().getTime();\n    var imagePromise = (0, _createImage2.default)(imageId, pixelData, transferSyntax, options);\n\n    imagePromise.then(function (image) {\n      image.data = dataSet;\n      var end = new Date().getTime();\n\n      image.loadTimeInMS = loadEnd - start;\n      image.totalTimeInMS = end - start;\n      addDecache(image);\n      deferred.resolve(image);\n    });\n  }, function (error) {\n    deferred.reject(error);\n  });\n\n  return deferred;\n}\n\nfunction getLoaderForScheme(scheme) {\n  if (scheme === 'dicomweb' || scheme === 'wadouri') {\n    return _internal.xhrRequest;\n  } else if (scheme === 'dicomfile') {\n    return _loadFileRequest2.default;\n  }\n}\n\nfunction loadImage(imageId, options) {\n  var parsedImageId = (0, _parseImageId2.default)(imageId);\n  var loader = getLoaderForScheme(parsedImageId.scheme);\n\n  // if the dataset for this url is already loaded, use it\n  if (_dataSetCacheManager2.default.isLoaded(parsedImageId.url)) {\n    return loadImageFromPromise(_dataSetCacheManager2.default.load(parsedImageId.url, loader, imageId), imageId, parsedImageId.frame, parsedImageId.url, options);\n  }\n\n  // load the dataSet via the dataSetCacheManager\n  return loadImageFromPromise(_dataSetCacheManager2.default.load(parsedImageId.url, loader, imageId), imageId, parsedImageId.frame, parsedImageId.url, options);\n}\n\n// register dicomweb and wadouri image loader prefixes\ncornerstone.registerImageLoader('dicomweb', loadImage);\ncornerstone.registerImageLoader('wadouri', loadImage);\ncornerstone.registerImageLoader('dicomfile', loadImage);\n\nexports.default = loadImage;\n\n/***/ }),\n/* 53 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _getImagePixelModule = __webpack_require__(29);\n\nObject.defineProperty(exports, 'getImagePixelModule', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_getImagePixelModule).default;\n  }\n});\n\nvar _getLUTs = __webpack_require__(30);\n\nObject.defineProperty(exports, 'getLUTs', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_getLUTs).default;\n  }\n});\n\nvar _getModalityLUTOutputPixelRepresentation = __webpack_require__(31);\n\nObject.defineProperty(exports, 'getModalityLUTOutputPixelRepresentation', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_getModalityLUTOutputPixelRepresentation).default;\n  }\n});\n\nvar _getNumberValues = __webpack_require__(32);\n\nObject.defineProperty(exports, 'getNumberValues', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_getNumberValues).default;\n  }\n});\n\nvar _metaDataProvider = __webpack_require__(54);\n\nObject.defineProperty(exports, 'metaDataProvider', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_metaDataProvider).default;\n  }\n});\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/***/ }),\n/* 54 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _getNumberValues = __webpack_require__(32);\n\nvar _getNumberValues2 = _interopRequireDefault(_getNumberValues);\n\nvar _parseImageId = __webpack_require__(5);\n\nvar _parseImageId2 = _interopRequireDefault(_parseImageId);\n\nvar _dataSetCacheManager = __webpack_require__(9);\n\nvar _dataSetCacheManager2 = _interopRequireDefault(_dataSetCacheManager);\n\nvar _getImagePixelModule = __webpack_require__(29);\n\nvar _getImagePixelModule2 = _interopRequireDefault(_getImagePixelModule);\n\nvar _getLUTs = __webpack_require__(30);\n\nvar _getLUTs2 = _interopRequireDefault(_getLUTs);\n\nvar _getModalityLUTOutputPixelRepresentation = __webpack_require__(31);\n\nvar _getModalityLUTOutputPixelRepresentation2 = _interopRequireDefault(_getModalityLUTOutputPixelRepresentation);\n\nvar _dicomParser = __webpack_require__(6);\n\nvar dicomParser = _interopRequireWildcard(_dicomParser);\n\nvar _cornerstoneCore = __webpack_require__(1);\n\nvar cornerstone = _interopRequireWildcard(_cornerstoneCore);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction metaDataProvider(type, imageId) {\n  var parsedImageId = (0, _parseImageId2.default)(imageId);\n\n  var dataSet = _dataSetCacheManager2.default.get(parsedImageId.url);\n\n  if (!dataSet) {\n    return;\n  }\n\n  if (type === 'generalSeriesModule') {\n    return {\n      modality: dataSet.string('x00080060'),\n      seriesInstanceUID: dataSet.string('x0020000e'),\n      seriesNumber: dataSet.intString('x00200011'),\n      studyInstanceUID: dataSet.string('x0020000d'),\n      seriesDate: dicomParser.parseDA(dataSet.string('x00080021')),\n      seriesTime: dicomParser.parseTM(dataSet.string('x00080031') || '')\n    };\n  }\n\n  if (type === 'patientStudyModule') {\n    return {\n      patientAge: dataSet.intString('x00101010'),\n      patientSize: dataSet.floatString('x00101020'),\n      patientWeight: dataSet.floatString('x00101030')\n    };\n  }\n\n  if (type === 'imagePlaneModule') {\n    return {\n      pixelSpacing: (0, _getNumberValues2.default)(dataSet, 'x00280030', 2),\n      imageOrientationPatient: (0, _getNumberValues2.default)(dataSet, 'x00200037', 6),\n      imagePositionPatient: (0, _getNumberValues2.default)(dataSet, 'x00200032', 3),\n      sliceThickness: dataSet.floatString('x00180050'),\n      sliceLocation: dataSet.floatString('x00201041'),\n      frameOfReferenceUID: dataSet.string('x00200052')\n    };\n  }\n\n  if (type === 'imagePixelModule') {\n    return (0, _getImagePixelModule2.default)(dataSet);\n  }\n\n  if (type === 'modalityLutModule') {\n    return {\n      rescaleIntercept: dataSet.floatString('x00281052'),\n      rescaleSlope: dataSet.floatString('x00281053'),\n      rescaleType: dataSet.string('x00281054'),\n      modalityLUTSequence: (0, _getLUTs2.default)(dataSet.uint16('x00280103'), dataSet.elements.x00283000)\n    };\n  }\n\n  if (type === 'voiLutModule') {\n    var modalityLUTOutputPixelRepresentation = (0, _getModalityLUTOutputPixelRepresentation2.default)(dataSet);\n\n    return {\n      windowCenter: (0, _getNumberValues2.default)(dataSet, 'x00281050', 1),\n      windowWidth: (0, _getNumberValues2.default)(dataSet, 'x00281051', 1),\n      voiLUTSequence: (0, _getLUTs2.default)(modalityLUTOutputPixelRepresentation, dataSet.elements.x00283010)\n    };\n  }\n\n  if (type === 'sopCommonModule') {\n    return {\n      sopClassUID: dataSet.string('x00080016'),\n      sopInstanceUID: dataSet.string('x00080018')\n    };\n  }\n\n  if (type === 'petIsotopeModule') {\n    var radiopharmaceuticalInfo = dataSet.elements.x00540016;\n\n    if (radiopharmaceuticalInfo === undefined) {\n      return;\n    }\n\n    var firstRadiopharmaceuticalInfoDataSet = radiopharmaceuticalInfo.items[0].dataSet;\n\n    return {\n      radiopharmaceuticalInfo: {\n        radiopharmaceuticalStartTime: dicomParser.parseTM(firstRadiopharmaceuticalInfoDataSet.string('x00181072') || ''),\n        radionuclideTotalDose: firstRadiopharmaceuticalInfoDataSet.floatString('x00181074'),\n        radionuclideHalfLife: firstRadiopharmaceuticalInfoDataSet.floatString('x00181075')\n      }\n    };\n  }\n}\n\n// register our metadata provider\ncornerstone.metaData.addProvider(metaDataProvider);\n\nexports.default = metaDataProvider;\n\n/***/ })\n/******/ ]);\n});\n\n\n// WEBPACK FOOTER //\n// cornerstoneWADOImageLoader.min.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 46);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 3f162b5b26c62318ee42","module.exports = __WEBPACK_EXTERNAL_MODULE_0__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external {\"commonjs\":\"jquery\",\"commonjs2\":\"jquery\",\"amd\":\"jquery\",\"root\":\"$\"}\n// module id = 0\n// module chunks = 0","module.exports = __WEBPACK_EXTERNAL_MODULE_1__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external {\"commonjs\":\"cornerstone-core\",\"commonjs2\":\"cornerstone-core\",\"amd\":\"cornerstone-core\",\"root\":\"cornerstone\"}\n// module id = 1\n// module chunks = 0","import { default as xhrRequest } from './xhrRequest';\r\nimport { setOptions, getOptions } from './options';\r\n\r\nconst internal = {\r\n  xhrRequest,\r\n  setOptions,\r\n  getOptions\r\n};\r\n\r\nexport { setOptions, getOptions, xhrRequest, internal };\r\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/internal/index.js","export default '0.14.6';\n\n\n\n// WEBPACK FOOTER //\n// ./version.js","\r\n\r\n/**\r\n * Returns the raw value\r\n *\r\n * @param element - The javascript object for the specified element in the metadata\r\n * @param [index] - the index of the value in a multi-valued element, default is 0\r\n * @param [defaultValue] - The default value to return if the element does not exist\r\n * @returns {*}\r\n */\r\nfunction getValue (element, index, defaultValue) {\r\n  index = index || 0;\r\n  if (!element) {\r\n    return defaultValue;\r\n  }\r\n  // Value is not present if the attribute has a zero length value\r\n  if (!element.Value) {\r\n    return defaultValue;\r\n  }\r\n  // make sure we have the specified index\r\n  if (element.Value.length <= index) {\r\n    return defaultValue;\r\n  }\r\n\r\n  return element.Value[index];\r\n}\r\n\r\nexport default getValue;\r\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadors/metaData/getValue.js","\r\n\r\nfunction parseImageId (imageId) {\r\n  // build a url by parsing out the url scheme and frame index from the imageId\r\n  const firstColonIndex = imageId.indexOf(':');\r\n  let url = imageId.substring(firstColonIndex + 1);\r\n  const frameIndex = url.indexOf('frame=');\r\n  let frame;\r\n\r\n  if (frameIndex !== -1) {\r\n    const frameStr = url.substr(frameIndex + 6);\r\n\r\n    frame = parseInt(frameStr, 10);\r\n    url = url.substr(0, frameIndex - 1);\r\n  }\r\n\r\n  return {\r\n    scheme: imageId.substr(0, firstColonIndex),\r\n    url,\r\n    frame\r\n  };\r\n}\r\n\r\nexport default parseImageId;\r\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadouri/parseImageId.js","module.exports = __WEBPACK_EXTERNAL_MODULE_6__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external {\"commonjs\":\"dicom-parser\",\"commonjs2\":\"dicom-parser\",\"amd\":\"dicom-parser\",\"root\":\"dicomParser\"}\n// module id = 6\n// module chunks = 0","import $ from 'jquery';\r\nimport getImageFrame from './getImageFrame';\r\nimport decodeImageFrame from './decodeImageFrame';\r\nimport { default as isColorImageFn } from './isColorImage';\r\nimport convertColorSpace from './convertColorSpace';\r\nimport getMinMax from './getMinMax';\r\nimport isJPEGBaseline8BitColor from './isJPEGBaseline8BitColor';\r\nimport * as cornerstone from 'cornerstone-core';\r\n\r\nlet lastImageIdDrawn = '';\r\n\r\nfunction isModalityLUTForDisplay (sopClassUid) {\r\n  // special case for XA and XRF\r\n  // https://groups.google.com/forum/#!searchin/comp.protocols.dicom/Modality$20LUT$20XA/comp.protocols.dicom/UBxhOZ2anJ0/D0R_QP8V2wIJ\r\n  return sopClassUid !== '1.2.840.10008.5.1.4.1.1.12.1' && // XA\r\n         sopClassUid !== '1.2.840.10008.5.1.4.1.1.12.2.1'; // XRF\r\n}\r\n\r\n/**\r\n * Helper function to set pixel data to the right typed array.  This is needed because web workers\r\n * can transfer array buffers but not typed arrays\r\n * @param imageFrame\r\n */\r\nfunction setPixelDataType (imageFrame) {\r\n  if (imageFrame.bitsAllocated === 16) {\r\n    if (imageFrame.pixelRepresentation === 0) {\r\n      imageFrame.pixelData = new Uint16Array(imageFrame.pixelData);\r\n    } else {\r\n      imageFrame.pixelData = new Int16Array(imageFrame.pixelData);\r\n    }\r\n  } else {\r\n    imageFrame.pixelData = new Uint8Array(imageFrame.pixelData);\r\n  }\r\n}\r\n\r\nfunction createImage (imageId, pixelData, transferSyntax, options) {\r\n  const canvas = document.createElement('canvas');\r\n  const deferred = $.Deferred();\r\n  const imageFrame = getImageFrame(imageId);\r\n  const decodePromise = decodeImageFrame(imageFrame, transferSyntax, pixelData, canvas, options);\r\n\r\n  decodePromise.then(function (imageFrame) {\r\n    // var imagePixelModule = metaDataProvider('imagePixelModule', imageId);\r\n    const imagePlaneModule = cornerstone.metaData.get('imagePlaneModule', imageId);\r\n    const voiLutModule = cornerstone.metaData.get('voiLutModule', imageId);\r\n    const modalityLutModule = cornerstone.metaData.get('modalityLutModule', imageId);\r\n    const sopCommonModule = cornerstone.metaData.get('sopCommonModule', imageId);\r\n    const isColorImage = isColorImageFn(imageFrame.photometricInterpretation);\r\n\r\n    // JPEGBaseline (8 bits) is already returning the pixel data in the right format (rgba)\r\n    // because it's using a canvas to load and decode images.\r\n    if (!isJPEGBaseline8BitColor(imageFrame, transferSyntax)) {\r\n      setPixelDataType(imageFrame);\r\n\r\n      // convert color space\r\n      if (isColorImage) {\r\n        // setup the canvas context\r\n        canvas.height = imageFrame.rows;\r\n        canvas.width = imageFrame.columns;\r\n\r\n        const context = canvas.getContext('2d');\r\n        const imageData = context.createImageData(imageFrame.columns, imageFrame.rows);\r\n\r\n        convertColorSpace(imageFrame, imageData);\r\n        imageFrame.imageData = imageData;\r\n        imageFrame.pixelData = imageData.data;\r\n      }\r\n    }\r\n\r\n    const image = {\r\n      imageId,\r\n      color: isColorImage,\r\n      columnPixelSpacing: imagePlaneModule.pixelSpacing ? imagePlaneModule.pixelSpacing[1] : undefined,\r\n      columns: imageFrame.columns,\r\n      height: imageFrame.rows,\r\n      intercept: modalityLutModule.rescaleIntercept ? modalityLutModule.rescaleIntercept : 0,\r\n      invert: imageFrame.photometricInterpretation === 'MONOCHROME1',\r\n      minPixelValue: imageFrame.smallestPixelValue,\r\n      maxPixelValue: imageFrame.largestPixelValue,\r\n      render: undefined, // set below\r\n      rowPixelSpacing: imagePlaneModule.pixelSpacing ? imagePlaneModule.pixelSpacing[0] : undefined,\r\n      rows: imageFrame.rows,\r\n      sizeInBytes: imageFrame.pixelData.length,\r\n      slope: modalityLutModule.rescaleSlope ? modalityLutModule.rescaleSlope : 1,\r\n      width: imageFrame.columns,\r\n      windowCenter: voiLutModule.windowCenter ? voiLutModule.windowCenter[0] : undefined,\r\n      windowWidth: voiLutModule.windowWidth ? voiLutModule.windowWidth[0] : undefined,\r\n      decodeTimeInMS: imageFrame.decodeTimeInMS\r\n    };\r\n\r\n    // add function to return pixel data\r\n    image.getPixelData = () => imageFrame.pixelData;\r\n\r\n    // Setup the renderer\r\n    if (image.color) {\r\n      image.render = cornerstone.renderColorImage;\r\n      image.getCanvas = function () {\r\n        if (lastImageIdDrawn === imageId) {\r\n          return canvas;\r\n        }\r\n\r\n        canvas.height = image.rows;\r\n        canvas.width = image.columns;\r\n        const context = canvas.getContext('2d');\r\n\r\n        context.putImageData(imageFrame.imageData, 0, 0);\r\n        lastImageIdDrawn = imageId;\r\n\r\n        return canvas;\r\n      };\r\n\r\n    } else {\r\n      image.render = cornerstone.renderGrayscaleImage;\r\n    }\r\n\r\n    // calculate min/max if not supplied\r\n    if (image.minPixelValue === undefined || image.maxPixelValue === undefined) {\r\n      const minMax = getMinMax(imageFrame.pixelData);\r\n\r\n      image.minPixelValue = minMax.min;\r\n      image.maxPixelValue = minMax.max;\r\n    }\r\n\r\n    // Modality LUT\r\n    if (modalityLutModule.modalityLUTSequence &&\r\n      modalityLutModule.modalityLUTSequence.length > 0 &&\r\n      isModalityLUTForDisplay(sopCommonModule.sopClassUID)) {\r\n      image.modalityLUT = modalityLutModule.modalityLUTSequence[0];\r\n    }\r\n\r\n    // VOI LUT\r\n    if (voiLutModule.voiLUTSequence &&\r\n      voiLutModule.voiLUTSequence.length > 0) {\r\n      image.voiLUT = voiLutModule.voiLUTSequence[0];\r\n    }\r\n\r\n    // set the ww/wc to cover the dynamic range of the image if no values are supplied\r\n    if (image.windowCenter === undefined || image.windowWidth === undefined) {\r\n      if (image.color) {\r\n        image.windowWidth = 255;\r\n        image.windowCenter = 128;\r\n      } else {\r\n        const maxVoi = image.maxPixelValue * image.slope + image.intercept;\r\n        const minVoi = image.minPixelValue * image.slope + image.intercept;\r\n\r\n        image.windowWidth = maxVoi - minVoi;\r\n        image.windowCenter = (maxVoi + minVoi) / 2;\r\n      }\r\n    }\r\n    deferred.resolve(image);\r\n  });\r\n\r\n  return deferred.promise();\r\n}\r\n\r\nexport default createImage;\r\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/createImage.js","\r\n\r\nlet imageIds = [];\r\n\r\nfunction add (imageId, metadata) {\r\n  imageIds[imageId] = metadata;\r\n}\r\n\r\nfunction get (imageId) {\r\n  return imageIds[imageId];\r\n}\r\n\r\nfunction remove (imageId) {\r\n  imageIds[imageId] = undefined;\r\n}\r\n\r\nfunction purge () {\r\n  imageIds = [];\r\n}\r\n\r\nexport default {\r\n  add,\r\n  get,\r\n  remove,\r\n  purge\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadors/metaDataManager.js","import $ from 'jquery';\nimport * as dicomParser from 'dicom-parser';\nimport { xhrRequest } from '../internal';\nimport events from '../events.js';\n\n/**\n * This object supports loading of DICOM P10 dataset from a uri and caching it so it can be accessed\n * by the caller.  This allows a caller to access the datasets without having to go through cornerstone's\n * image loader mechanism.  One reason a caller may need to do this is to determine the number of frames\n * in a multiframe sop instance so it can create the imageId's correctly.\n */\nlet loadedDataSets = {};\nlet promises = {};\n\n// returns true if the wadouri for the specified index has been loaded\nfunction isLoaded (uri) {\n  return loadedDataSets[uri] !== undefined;\n}\n\nfunction get (uri) {\n  // if already loaded return it right away\n  if (!loadedDataSets[uri]) {\n    return;\n  }\n\n  return loadedDataSets[uri].dataSet;\n}\n\n\n  // loads the dicom dataset from the wadouri sp\nfunction load (uri, loadRequest, imageId) {\n  loadRequest = loadRequest || xhrRequest;\n\n  // if already loaded return it right away\n  if (loadedDataSets[uri]) {\n    // console.log('using loaded dataset ' + uri);\n    const alreadyLoadedpromise = $.Deferred();\n\n    loadedDataSets[uri].cacheCount++;\n    alreadyLoadedpromise.resolve(loadedDataSets[uri].dataSet);\n\n    return alreadyLoadedpromise;\n  }\n\n  // if we are currently loading this uri, return its promise\n  if (promises[uri]) {\n    // console.log('returning existing load promise for ' + uri);\n    return promises[uri];\n  }\n\n  // console.log('loading ' + uri);\n\n  // This uri is not loaded or being loaded, load it via an xhrRequest\n  const promise = loadRequest(uri, imageId);\n\n  // handle success and failure of the XHR request load\n  const loadDeferred = $.Deferred();\n\n  promise.then(function (dicomPart10AsArrayBuffer/* , xhr*/) {\n    const byteArray = new Uint8Array(dicomPart10AsArrayBuffer);\n\n    // Reject the promise if parsing the dicom file fails\n    let dataSet;\n\n    try {\n      dataSet = dicomParser.parseDicom(byteArray);\n    } catch (error) {\n      loadDeferred.reject(error);\n\n      return;\n    }\n\n    loadedDataSets[uri] = {\n      dataSet,\n      cacheCount: 1\n    };\n    $(events).trigger('DataSetsCacheChanged', {\n      uri,\n      action: 'loaded',\n      dataSet: loadedDataSets[uri].dataSet\n    });\n\n    loadDeferred.resolve(dataSet);\n    // done loading, remove the promise\n    delete promises[uri];\n  }).always(function () {\n      // error thrown, remove the promise\n    delete promises[uri];\n  });\n\n  promises[uri] = loadDeferred;\n\n  return loadDeferred;\n}\n\n// remove the cached/loaded dicom dataset for the specified wadouri to free up memory\nfunction unload (uri) {\n  // console.log('unload for ' + uri);\n  if (loadedDataSets[uri]) {\n    loadedDataSets[uri].cacheCount--;\n    if (loadedDataSets[uri].cacheCount === 0) {\n      // console.log('removing loaded dataset for ' + uri);\n      $(events).trigger('DataSetsCacheChanged', {\n        uri,\n        action: 'unloaded',\n        dataSet: loadedDataSets[uri].dataSet\n      });\n      delete loadedDataSets[uri];\n    }\n  }\n}\n\n// removes all cached datasets from memory\nfunction purge () {\n  loadedDataSets = {};\n  promises = {};\n}\n\nexport default {\n  isLoaded,\n  load,\n  unload,\n  purge,\n  get\n};\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadouri/dataSetCacheManager.js","export { default as convertRGBColorByPixel } from './convertRGBColorByPixel';\r\nexport { default as convertRGBColorByPlane } from './convertRGBColorByPlane';\r\nexport { default as convertYBRFullByPixel } from './convertYBRFullByPixel';\r\nexport { default as convertYBRFullByPlane } from './convertYBRFullByPlane';\r\nexport { default as convertPALETTECOLOR } from './convertPALETTECOLOR';\r\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/colorSpaceConverters/index.js","import { convertRGBColorByPixel, convertRGBColorByPlane,\r\n         convertYBRFullByPixel, convertYBRFullByPlane,\r\n         convertPALETTECOLOR } from './colorSpaceConverters';\r\n\r\nfunction convertRGB (imageFrame, rgbaBuffer) {\r\n  if (imageFrame.planarConfiguration === 0) {\r\n    convertRGBColorByPixel(imageFrame.pixelData, rgbaBuffer);\r\n  } else {\r\n    convertRGBColorByPlane(imageFrame.pixelData, rgbaBuffer);\r\n  }\r\n}\r\n\r\nfunction convertYBRFull (imageFrame, rgbaBuffer) {\r\n  if (imageFrame.planarConfiguration === 0) {\r\n    convertYBRFullByPixel(imageFrame.pixelData, rgbaBuffer);\r\n  } else {\r\n    convertYBRFullByPlane(imageFrame.pixelData, rgbaBuffer);\r\n  }\r\n}\r\n\r\nexport default function convertColorSpace (imageFrame, imageData) {\r\n  const rgbaBuffer = imageData.data;\r\n  // convert based on the photometric interpretation\r\n\r\n  if (imageFrame.photometricInterpretation === 'RGB') {\r\n    convertRGB(imageFrame, rgbaBuffer);\r\n  } else if (imageFrame.photometricInterpretation === 'YBR_RCT') {\r\n    convertRGB(imageFrame, rgbaBuffer);\r\n  } else if (imageFrame.photometricInterpretation === 'YBR_ICT') {\r\n    convertRGB(imageFrame, rgbaBuffer);\r\n  } else if (imageFrame.photometricInterpretation === 'PALETTE COLOR') {\r\n    convertPALETTECOLOR(imageFrame, rgbaBuffer);\r\n  } else if (imageFrame.photometricInterpretation === 'YBR_FULL_422') {\r\n    convertRGB(imageFrame, rgbaBuffer);\r\n  } else if (imageFrame.photometricInterpretation === 'YBR_FULL') {\r\n    convertYBRFull(imageFrame, rgbaBuffer);\r\n  } else {\r\n    throw new Error(`No color space conversion for photometric interpretation ${imageFrame.photometricInterpretation}`);\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/convertColorSpace.js","import webWorkerManager from './webWorkerManager';\r\nimport decodeJPEGBaseline8BitColor from './decodeJPEGBaseline8BitColor';\r\n\r\nfunction addDecodeTask (imageFrame, transferSyntax, pixelData, options) {\r\n  const priority = options.priority || undefined;\r\n  const transferList = options.transferPixelData ? [pixelData.buffer] : undefined;\r\n\r\n  return webWorkerManager.addTask(\r\n    'decodeTask',\r\n    {\r\n      imageFrame,\r\n      transferSyntax,\r\n      pixelData,\r\n      options\r\n    }, priority, transferList).promise;\r\n}\r\n\r\nfunction decodeImageFrame (imageFrame, transferSyntax, pixelData, canvas, options) {\r\n  options = options || {};\r\n\r\n  // TODO: Turn this into a switch statement instead\r\n  if (transferSyntax === '1.2.840.10008.1.2') {\r\n    // Implicit VR Little Endian\r\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\r\n  } else if (transferSyntax === '1.2.840.10008.1.2.1') {\r\n    // Explicit VR Little Endian\r\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\r\n  } else if (transferSyntax === '1.2.840.10008.1.2.2') {\r\n    // Explicit VR Big Endian (retired)\r\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\r\n  } else if (transferSyntax === '1.2.840.10008.1.2.1.99') {\r\n    // Deflate transfer syntax (deflated by dicomParser)\r\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\r\n  } else if (transferSyntax === '1.2.840.10008.1.2.5') {\r\n    // RLE Lossless\r\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\r\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.50') {\r\n    // JPEG Baseline lossy process 1 (8 bit)\r\n\r\n    // Handle 8-bit JPEG Baseline color images using the browser's built-in\r\n    // JPEG decoding\r\n    if (imageFrame.bitsAllocated === 8 &&\r\n       (imageFrame.samplesPerPixel === 3 || imageFrame.samplesPerPixel === 4)) {\r\n      return decodeJPEGBaseline8BitColor(imageFrame, pixelData, canvas);\r\n    }\r\n\r\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\r\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.51') {\r\n    // JPEG Baseline lossy process 2 & 4 (12 bit)\r\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\r\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.57') {\r\n    // JPEG Lossless, Nonhierarchical (Processes 14)\r\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\r\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.70') {\r\n    // JPEG Lossless, Nonhierarchical (Processes 14 [Selection 1])\r\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\r\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.80') {\r\n    // JPEG-LS Lossless Image Compression\r\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\r\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.81') {\r\n    // JPEG-LS Lossy (Near-Lossless) Image Compression\r\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\r\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.90') {\r\n    // JPEG 2000 Lossless\r\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\r\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.91') {\r\n    // JPEG 2000 Lossy\r\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\r\n  }\r\n\r\n  /* Don't know if these work...\r\n   // JPEG 2000 Part 2 Multicomponent Image Compression (Lossless Only)\r\n   else if(transferSyntax === \"1.2.840.10008.1.2.4.92\")\r\n   {\r\n   return cornerstoneWADOImageLoader.decodeJPEG2000(dataSet, frame);\r\n   }\r\n   // JPEG 2000 Part 2 Multicomponent Image Compression\r\n   else if(transferSyntax === \"1.2.840.10008.1.2.4.93\")\r\n   {\r\n   return cornerstoneWADOImageLoader.decodeJPEG2000(dataSet, frame);\r\n   }\r\n   */\r\n\r\n  throw new Error(`No decoder for transfer syntax ${transferSyntax}`);\r\n}\r\n\r\nexport default decodeImageFrame;\r\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/decodeImageFrame.js","import $ from 'jquery';\r\n\r\n/**\r\n * Special decoder for 8 bit jpeg that leverages the browser's built in JPEG decoder for increased performance\r\n */\r\n\r\nfunction arrayBufferToString (buffer) {\r\n  return binaryToString(String.fromCharCode.apply(null, Array.prototype.slice.apply(new Uint8Array(buffer))));\r\n}\r\n\r\nfunction binaryToString (binary) {\r\n  let error;\r\n\r\n  try {\r\n    return decodeURIComponent(escape(binary));\r\n  } catch (_error) {\r\n    error = _error;\r\n    if (error instanceof URIError) {\r\n      return binary;\r\n    }\r\n    throw error;\r\n\r\n  }\r\n}\r\n\r\nfunction decodeJPEGBaseline8BitColor (imageFrame, pixelData, canvas) {\r\n  const start = new Date().getTime();\r\n  const deferred = $.Deferred();\r\n\r\n  const imgBlob = new Blob([pixelData], { type: 'image/jpeg' });\r\n\r\n  const r = new FileReader();\r\n\r\n  if (r.readAsBinaryString === undefined) {\r\n    r.readAsArrayBuffer(imgBlob);\r\n  } else {\r\n    r.readAsBinaryString(imgBlob); // doesn't work on IE11\r\n  }\r\n\r\n  r.onload = function () {\r\n    const img = new Image();\r\n\r\n    img.onload = function () {\r\n      canvas.height = img.height;\r\n      canvas.width = img.width;\r\n      imageFrame.rows = img.height;\r\n      imageFrame.columns = img.width;\r\n      const context = canvas.getContext('2d');\r\n\r\n      context.drawImage(this, 0, 0);\r\n      const imageData = context.getImageData(0, 0, img.width, img.height);\r\n      const end = new Date().getTime();\r\n\r\n      imageFrame.pixelData = imageData.data;\r\n      imageFrame.imageData = imageData;\r\n      imageFrame.decodeTimeInMS = end - start;\r\n      deferred.resolve(imageFrame);\r\n    };\r\n    img.onerror = function (error) {\r\n      deferred.reject(error);\r\n    };\r\n    if (r.readAsBinaryString === undefined) {\r\n      img.src = `data:image/jpeg;base64,${window.btoa(arrayBufferToString(r.result))}`;\r\n    } else {\r\n      img.src = `data:image/jpeg;base64,${window.btoa(r.result)}`; // doesn't work on IE11\r\n    }\r\n\r\n  };\r\n\r\n  return deferred.promise();\r\n}\r\n\r\nexport default decodeJPEGBaseline8BitColor;\r\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/decodeJPEGBaseline8BitColor.js","const events = {\n  name: 'cornerstoneWADOImageLoader'\n};\n\nexport default events;\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/events.js","import * as cornerstone from 'cornerstone-core';\r\n\r\nfunction getImageFrame (imageId) {\r\n  const imagePixelModule = cornerstone.metaData.get('imagePixelModule', imageId);\r\n\r\n  return {\r\n    samplesPerPixel: imagePixelModule.samplesPerPixel,\r\n    photometricInterpretation: imagePixelModule.photometricInterpretation,\r\n    planarConfiguration: imagePixelModule.planarConfiguration,\r\n    rows: imagePixelModule.rows,\r\n    columns: imagePixelModule.columns,\r\n    bitsAllocated: imagePixelModule.bitsAllocated,\r\n    pixelRepresentation: imagePixelModule.pixelRepresentation, // 0 = unsigned,\r\n    smallestPixelValue: imagePixelModule.smallestPixelValue,\r\n    largestPixelValue: imagePixelModule.largestPixelValue,\r\n    redPaletteColorLookupTableDescriptor: imagePixelModule.redPaletteColorLookupTableDescriptor,\r\n    greenPaletteColorLookupTableDescriptor: imagePixelModule.greenPaletteColorLookupTableDescriptor,\r\n    bluePaletteColorLookupTableDescriptor: imagePixelModule.bluePaletteColorLookupTableDescriptor,\r\n    redPaletteColorLookupTableData: imagePixelModule.redPaletteColorLookupTableData,\r\n    greenPaletteColorLookupTableData: imagePixelModule.greenPaletteColorLookupTableData,\r\n    bluePaletteColorLookupTableData: imagePixelModule.bluePaletteColorLookupTableData,\r\n    pixelData: undefined // populated later after decoding\r\n  };\r\n}\r\n\r\nexport default getImageFrame;\r\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/getImageFrame.js","export default function getMinMax (storedPixelData) {\r\n  // we always calculate the min max values since they are not always\r\n  // present in DICOM and we don't want to trust them anyway as cornerstone\r\n  // depends on us providing reliable values for these\r\n  let min = storedPixelData[0];\r\n  let max = storedPixelData[0];\r\n  let storedPixel;\r\n  const numPixels = storedPixelData.length;\r\n\r\n  for (let index = 0; index < numPixels; index++) {\r\n    storedPixel = storedPixelData[index];\r\n    min = Math.min(min, storedPixel);\r\n    max = Math.max(max, storedPixel);\r\n  }\r\n\r\n  return {\r\n    min,\r\n    max\r\n  };\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/getMinMax.js","export default function (photoMetricInterpretation) {\r\n  return (photoMetricInterpretation === 'RGB' ||\r\n    photoMetricInterpretation === 'PALETTE COLOR' ||\r\n    photoMetricInterpretation === 'YBR_FULL' ||\r\n    photoMetricInterpretation === 'YBR_FULL_422' ||\r\n    photoMetricInterpretation === 'YBR_PARTIAL_422' ||\r\n    photoMetricInterpretation === 'YBR_PARTIAL_420' ||\r\n    photoMetricInterpretation === 'YBR_RCT' ||\r\n    photoMetricInterpretation === 'YBR_ICT');\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/isColorImage.js","function isJPEGBaseline8BitColor (imageFrame, transferSyntax) {\r\n  transferSyntax = transferSyntax || imageFrame.transferSyntax;\r\n\r\n  if (imageFrame.bitsAllocated === 8 &&\r\n     transferSyntax === '1.2.840.10008.1.2.4.50' &&\r\n     (imageFrame.samplesPerPixel === 3 || imageFrame.samplesPerPixel === 4)) {\r\n    return true;\r\n  }\r\n}\r\n\r\nexport default isJPEGBaseline8BitColor;\r\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/isJPEGBaseline8BitColor.js","import $ from 'jquery';\r\n\r\n// the taskId to assign to the next task added via addTask()\r\nlet nextTaskId = 0;\r\n\r\n// array of queued tasks sorted with highest priority task first\r\nconst tasks = [];\r\n\r\n// array of web workers to dispatch decode tasks to\r\nconst webWorkers = [];\r\n\r\nconst defaultConfig = {\r\n  maxWebWorkers: navigator.hardwareConcurrency || 1,\r\n  startWebWorkersOnDemand: true,\r\n  webWorkerPath: '../../dist/cornerstoneWADOImageLoaderWebWorker.js',\r\n  webWorkerTaskPaths: [],\r\n  taskConfiguration: {\r\n    decodeTask: {\r\n      loadCodecsOnStartup: true,\r\n      initializeCodecsOnStartup: false,\r\n      codecsPath: '../dist/cornerstoneWADOImageLoaderCodecs.js',\r\n      usePDFJS: false\r\n    }\r\n  }\r\n};\r\n\r\nlet config;\r\n\r\nconst statistics = {\r\n  maxWebWorkers: 0,\r\n  numWebWorkers: 0,\r\n  numTasksQueued: 0,\r\n  numTasksExecuting: 0,\r\n  numTasksCompleted: 0,\r\n  totalTaskTimeInMS: 0,\r\n  totalTimeDelayedInMS: 0\r\n};\r\n\r\n/**\r\n * Function to start a task on a web worker\r\n */\r\nfunction startTaskOnWebWorker () {\r\n  // return immediately if no decode tasks to do\r\n  if (!tasks.length) {\r\n    return;\r\n  }\r\n\r\n  // look for a web worker that is ready\r\n  for (let i = 0; i < webWorkers.length; i++) {\r\n    if (webWorkers[i].status === 'ready') {\r\n      // mark it as busy so tasks are not assigned to it\r\n      webWorkers[i].status = 'busy';\r\n\r\n      // get the highest priority task\r\n      const task = tasks.shift();\r\n\r\n      task.start = new Date().getTime();\r\n\r\n      // update stats with how long this task was delayed (waiting in queue)\r\n      const end = new Date().getTime();\r\n\r\n      statistics.totalTimeDelayedInMS += end - task.added;\r\n\r\n      // assign this task to this web worker and send the web worker\r\n      // a message to execute it\r\n      webWorkers[i].task = task;\r\n      webWorkers[i].worker.postMessage({\r\n        taskType: task.taskType,\r\n        workerIndex: i,\r\n        data: task.data\r\n      }, task.transferList);\r\n      statistics.numTasksExecuting++;\r\n\r\n      return;\r\n    }\r\n  }\r\n\r\n  // if no available web workers and we haven't started max web workers, start a new one\r\n  if (webWorkers.length < config.maxWebWorkers) {\r\n    spawnWebWorker();\r\n  }\r\n}\r\n\r\n/**\r\n * Function to handle a message from a web worker\r\n * @param msg\r\n */\r\nfunction handleMessageFromWorker (msg) {\r\n  // console.log('handleMessageFromWorker', msg.data);\r\n  if (msg.data.taskType === 'initialize') {\r\n    webWorkers[msg.data.workerIndex].status = 'ready';\r\n    startTaskOnWebWorker();\r\n  } else {\r\n    const start = webWorkers[msg.data.workerIndex].task.start;\r\n\r\n    webWorkers[msg.data.workerIndex].task.deferred.resolve(msg.data.result);\r\n    webWorkers[msg.data.workerIndex].task = undefined;\r\n\r\n    statistics.numTasksExecuting--;\r\n    webWorkers[msg.data.workerIndex].status = 'ready';\r\n    statistics.numTasksCompleted++;\r\n\r\n    const end = new Date().getTime();\r\n\r\n    statistics.totalTaskTimeInMS += end - start;\r\n\r\n    startTaskOnWebWorker();\r\n  }\r\n}\r\n\r\n/**\r\n * Spawns a new web worker\r\n */\r\nfunction spawnWebWorker () {\r\n  // prevent exceeding maxWebWorkers\r\n  if (webWorkers.length >= config.maxWebWorkers) {\r\n    return;\r\n  }\r\n\r\n  // spawn the webworker\r\n  const worker = new Worker(config.webWorkerPath);\r\n\r\n  webWorkers.push({\r\n    worker,\r\n    status: 'initializing'\r\n  });\r\n  worker.addEventListener('message', handleMessageFromWorker);\r\n  worker.postMessage({\r\n    taskType: 'initialize',\r\n    workerIndex: webWorkers.length - 1,\r\n    config\r\n  });\r\n}\r\n\r\n/**\r\n * Initialization function for the web worker manager - spawns web workers\r\n * @param configObject\r\n */\r\nfunction initialize (configObject) {\r\n  configObject = configObject || defaultConfig;\r\n\r\n  // prevent being initialized more than once\r\n  if (config) {\r\n    throw new Error('WebWorkerManager already initialized');\r\n  }\r\n\r\n  config = configObject;\r\n\r\n  config.maxWebWorkers = config.maxWebWorkers || (navigator.hardwareConcurrency || 1);\r\n\r\n  // Spawn new web workers\r\n  if (!config.startWebWorkersOnDemand) {\r\n    for (let i = 0; i < config.maxWebWorkers; i++) {\r\n      spawnWebWorker();\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * dynamically loads a web worker task\r\n * @param sourcePath\r\n * @param taskConfig\r\n */\r\nfunction loadWebWorkerTask (sourcePath, taskConfig) {\r\n  // add it to the list of web worker tasks paths so on demand web workers\r\n  // load this properly\r\n  config.webWorkerTaskPaths.push(sourcePath);\r\n\r\n  // if a task specific configuration is provided, merge it into the config\r\n  if (taskConfig) {\r\n    config.taskConfiguration = Object.assign(config.taskConfiguration, taskConfig);\r\n  }\r\n\r\n  // tell each spawned web worker to load this task\r\n  for (let i = 0; i < webWorkers.length; i++) {\r\n    webWorkers[i].worker.postMessage({\r\n      taskType: 'loadWebWorkerTask',\r\n      workerIndex: webWorkers.length - 1,\r\n      sourcePath,\r\n      config\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Function to add a decode task to be performed\r\n *\r\n * @param taskType - the taskType for this task\r\n * @param data - data specific to the task\r\n * @param priority - optional priority of the task (defaults to 0), > 0 is higher, < 0 is lower\r\n * @param transferList - optional array of data to transfer to web worker\r\n * @returns {*}\r\n */\r\nfunction addTask (taskType, data, priority = 0, transferList) {\r\n  if (!config) {\r\n    initialize();\r\n  }\r\n\r\n  const deferred = $.Deferred();\r\n\r\n  // find the right spot to insert this decode task (based on priority)\r\n  let i;\r\n\r\n  for (i = 0; i < tasks.length; i++) {\r\n    if (tasks[i].priority <= priority) {\r\n      break;\r\n    }\r\n  }\r\n\r\n  const taskId = nextTaskId++;\r\n\r\n  // insert the decode task at position i\r\n  tasks.splice(i, 0, {\r\n    taskId,\r\n    taskType,\r\n    status: 'ready',\r\n    added: new Date().getTime(),\r\n    data,\r\n    deferred,\r\n    priority,\r\n    transferList\r\n  });\r\n\r\n  // try to start a task on the web worker since we just added a new task and a web worker may be available\r\n  startTaskOnWebWorker();\r\n\r\n  return {\r\n    taskId,\r\n    promise: deferred.promise()\r\n  };\r\n}\r\n\r\n/**\r\n * Changes the priority of a queued task\r\n * @param taskId - the taskId to change the priority of\r\n * @param priority - priority of the task (defaults to 0), > 0 is higher, < 0 is lower\r\n * @returns boolean - true on success, false if taskId not found\r\n */\r\nfunction setTaskPriority (taskId, priority = 0) {\r\n  // search for this taskId\r\n  for (let i = 0; i < tasks.length; i++) {\r\n    if (tasks[i].taskId === taskId) {\r\n      // taskId found, remove it\r\n      const task = tasks.splice(i, 1)[0];\r\n\r\n      // set its priority\r\n      task.priority = priority;\r\n\r\n      // find the right spot to insert this decode task (based on priority)\r\n      for (i = 0; i < tasks.length; i++) {\r\n        if (tasks[i].priority <= priority) {\r\n          break;\r\n        }\r\n      }\r\n\r\n      // insert the decode task at position i\r\n      tasks.splice(i, 0, task);\r\n\r\n      return true;\r\n    }\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\n/**\r\n * Cancels a queued task and rejects\r\n * @param taskId - the taskId to cancel\r\n * @param reason - optional reason the task was rejected\r\n * @returns boolean - true on success, false if taskId not found\r\n */\r\nfunction cancelTask (taskId, reason) {\r\n  // search for this taskId\r\n  for (let i = 0; i < tasks.length; i++) {\r\n    if (tasks[i].taskId === taskId) {\r\n      // taskId found, remove it\r\n      const task = tasks.splice(i, 1);\r\n\r\n      task.promise.reject(reason);\r\n\r\n      return true;\r\n    }\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\n/**\r\n * Function to return the statistics on running web workers\r\n * @returns object containing statistics\r\n */\r\nfunction getStatistics () {\r\n  statistics.maxWebWorkers = config.maxWebWorkers;\r\n  statistics.numWebWorkers = webWorkers.length;\r\n  statistics.numTasksQueued = tasks.length;\r\n\r\n  return statistics;\r\n}\r\n\r\nexport default {\r\n  initialize,\r\n  loadWebWorkerTask,\r\n  addTask,\r\n  getStatistics,\r\n  setTaskPriority,\r\n  cancelTask\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/webWorkerManager.js","let options = {\r\n  // callback allowing customization of the xhr (e.g. adding custom auth headers, cors, etc)\r\n  beforeSend (/* xhr */) {\r\n  },\r\n  // callback allowing modification of newly created image objects\r\n  imageCreated (/* image */) {\r\n  }\r\n};\r\n\r\nexport function setOptions (newOptions) {\r\n  options = newOptions;\r\n}\r\n\r\nexport function getOptions () {\r\n  return options;\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/internal/options.js","function checkToken (token, data, dataOffset) {\r\n\r\n  if (dataOffset + token.length > data.length) {\r\n    return false;\r\n  }\r\n\r\n  let endIndex = dataOffset;\r\n\r\n  for (let i = 0; i < token.length; i++) {\r\n    if (token[i] !== data[endIndex++]) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\nfunction stringToUint8Array (str) {\r\n  const uint = new Uint8Array(str.length);\r\n\r\n  for (let i = 0, j = str.length; i < j; i++) {\r\n    uint[i] = str.charCodeAt(i);\r\n  }\r\n\r\n  return uint;\r\n}\r\n\r\nfunction findIndexOfString (data, str, offset) {\r\n\r\n  offset = offset || 0;\r\n\r\n  const token = stringToUint8Array(str);\r\n\r\n  for (let i = offset; i < data.length; i++) {\r\n    if (token[0] === data[i]) {\r\n      // console.log('match @', i);\r\n      if (checkToken(token, data, i)) {\r\n        return i;\r\n      }\r\n    }\r\n  }\r\n\r\n  return -1;\r\n}\r\nexport default findIndexOfString;\r\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadors/findIndexOfString.js","import $ from 'jquery';\r\nimport { xhrRequest } from '../internal';\r\nimport findIndexOfString from './findIndexOfString';\r\n\r\nfunction findBoundary (header) {\r\n  for (let i = 0; i < header.length; i++) {\r\n    if (header[i].substr(0, 2) === '--') {\r\n      return header[i];\r\n    }\r\n  }\r\n\r\n  return undefined;\r\n}\r\n\r\nfunction findContentType (header) {\r\n  for (let i = 0; i < header.length; i++) {\r\n    if (header[i].substr(0, 13) === 'Content-Type:') {\r\n      return header[i].substr(13).trim();\r\n    }\r\n  }\r\n\r\n  return undefined;\r\n}\r\n\r\nfunction uint8ArrayToString (data, offset, length) {\r\n  offset = offset || 0;\r\n  length = length || data.length - offset;\r\n  let str = '';\r\n\r\n  for (let i = offset; i < offset + length; i++) {\r\n    str += String.fromCharCode(data[i]);\r\n  }\r\n\r\n  return str;\r\n}\r\n\r\nfunction getPixelData (uri, imageId, mediaType) {\r\n  mediaType = mediaType || 'application/octet-stream';\r\n  const headers = {\r\n    accept: mediaType\r\n  };\r\n\r\n  const deferred = $.Deferred();\r\n\r\n  const loadPromise = xhrRequest(uri, imageId, headers);\r\n\r\n  loadPromise.then(function (imageFrameAsArrayBuffer/* , xhr*/) {\r\n\r\n    // request succeeded, Parse the multi-part mime response\r\n    const response = new Uint8Array(imageFrameAsArrayBuffer);\r\n\r\n    // First look for the multipart mime header\r\n    const tokenIndex = findIndexOfString(response, '\\r\\n\\r\\n');\r\n\r\n    if (tokenIndex === -1) {\r\n      deferred.reject('invalid response - no multipart mime header');\r\n    }\r\n    const header = uint8ArrayToString(response, 0, tokenIndex);\r\n    // Now find the boundary  marker\r\n    const split = header.split('\\r\\n');\r\n    const boundary = findBoundary(split);\r\n\r\n    if (!boundary) {\r\n      deferred.reject('invalid response - no boundary marker');\r\n    }\r\n    const offset = tokenIndex + 4; // skip over the \\r\\n\\r\\n\r\n\r\n    // find the terminal boundary marker\r\n    const endIndex = findIndexOfString(response, boundary, offset);\r\n\r\n    if (endIndex === -1) {\r\n      deferred.reject('invalid response - terminating boundary not found');\r\n    }\r\n\r\n    // Remove \\r\\n from the length\r\n    const length = endIndex - offset - 2;\r\n\r\n    // return the info for this pixel data\r\n    deferred.resolve({\r\n      contentType: findContentType(split),\r\n      imageFrame: {\r\n        pixelData: new Uint8Array(imageFrameAsArrayBuffer, offset, length)\r\n      }\r\n    });\r\n  });\r\n\r\n  return deferred.promise();\r\n}\r\n\r\nexport default getPixelData;\r\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadors/getPixelData.js","import getValue from './getValue';\r\n\r\nfunction getNumberValue (element, index) {\r\n  const value = getValue(element, index);\r\n\r\n  if (value === undefined) {\r\n    return;\r\n  }\r\n\r\n  return parseFloat(value);\r\n}\r\n\r\nexport default getNumberValue;\r\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadors/metaData/getNumberValue.js","\r\n\r\n/**\r\n * Returns the values as an array of javascript numbers\r\n *\r\n * @param element - The javascript object for the specified element in the metadata\r\n * @param [minimumLength] - the minimum number of values\r\n * @returns {*}\r\n */\r\nfunction getNumberValues (element, minimumLength) {\r\n  if (!element) {\r\n    return;\r\n  }\r\n  // Value is not present if the attribute has a zero length value\r\n  if (!element.Value) {\r\n    return;\r\n  }\r\n  // make sure we have the expected length\r\n  if (minimumLength && element.Value.length < minimumLength) {\r\n    return;\r\n  }\r\n\r\n  const values = [];\r\n\r\n  for (let i = 0; i < element.Value.length; i++) {\r\n    values.push(parseFloat(element.Value[i]));\r\n  }\r\n\r\n  return values;\r\n}\r\n\r\nexport default getNumberValues;\r\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadors/metaData/getNumberValues.js","let files = [];\r\n\r\nfunction add (file) {\r\n  const fileIndex = files.push(file);\r\n\r\n  return `dicomfile:${fileIndex - 1}`;\r\n}\r\n\r\nfunction get (index) {\r\n  return files[index];\r\n}\r\n\r\nfunction remove (index) {\r\n  files[index] = undefined;\r\n}\r\n\r\nfunction purge () {\r\n  files = [];\r\n}\r\n\r\nexport default {\r\n  add,\r\n  get,\r\n  remove,\r\n  purge\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadouri/fileManager.js","import * as dicomParser from 'dicom-parser';\r\n\r\n/**\r\n * Function to deal with extracting an image frame from an encapsulated data set.\r\n */\r\n\r\n\r\nfunction framesAreFragmented (dataSet) {\r\n  const numberOfFrames = dataSet.intString('x00280008');\r\n  const pixelDataElement = dataSet.elements.x7fe00010;\r\n\r\n  return (numberOfFrames !== pixelDataElement.fragments.length);\r\n}\r\n\r\nexport default function getEncapsulatedImageFrame (dataSet, frameIndex) {\r\n  if (dataSet.elements.x7fe00010.basicOffsetTable.length) {\r\n    // Basic Offset Table is not empty\r\n    return dicomParser.readEncapsulatedImageFrame(dataSet, dataSet.elements.x7fe00010, frameIndex);\r\n  }\r\n\r\n  // Empty basic offset table\r\n\r\n  if (framesAreFragmented(dataSet)) {\r\n    const basicOffsetTable = dicomParser.createJPEGBasicOffsetTable(dataSet, dataSet.elements.x7fe00010);\r\n\r\n    return dicomParser.readEncapsulatedImageFrame(dataSet, dataSet.elements.x7fe00010, frameIndex, basicOffsetTable);\r\n  }\r\n\r\n  return dicomParser.readEncapsulatedPixelDataFromFragments(dataSet, dataSet.elements.x7fe00010, frameIndex);\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadouri/getEncapsulatedImageFrame.js","import unpackBinaryFrame from './unpackBinaryFrame';\r\n\r\n/**\r\n * Function to deal with extracting an image frame from an encapsulated data set.\r\n */\r\n\r\nfunction getUncompressedImageFrame (dataSet, frameIndex) {\r\n  const pixelDataElement = dataSet.elements.x7fe00010;\r\n  const bitsAllocated = dataSet.uint16('x00280100');\r\n  const rows = dataSet.uint16('x00280010');\r\n  const columns = dataSet.uint16('x00280011');\r\n  const samplesPerPixel = dataSet.uint16('x00280002');\r\n\r\n  const pixelDataOffset = pixelDataElement.dataOffset;\r\n  const pixelsPerFrame = rows * columns * samplesPerPixel;\r\n\r\n  let frameOffset;\r\n\r\n  if (bitsAllocated === 8) {\r\n    frameOffset = pixelDataOffset + frameIndex * pixelsPerFrame;\r\n    if (frameOffset >= dataSet.byteArray.length) {\r\n      throw 'frame exceeds size of pixelData';\r\n    }\r\n\r\n    return new Uint8Array(dataSet.byteArray.buffer, frameOffset, pixelsPerFrame);\r\n  } else if (bitsAllocated === 16) {\r\n    frameOffset = pixelDataOffset + frameIndex * pixelsPerFrame * 2;\r\n    if (frameOffset >= dataSet.byteArray.length) {\r\n      throw 'frame exceeds size of pixelData';\r\n    }\r\n\r\n    return new Uint8Array(dataSet.byteArray.buffer, frameOffset, pixelsPerFrame * 2);\r\n  } else if (bitsAllocated === 1) {\r\n    frameOffset = pixelDataOffset + frameIndex * pixelsPerFrame * 0.125;\r\n    if (frameOffset >= dataSet.byteArray.length) {\r\n      throw 'frame exceeds size of pixelData';\r\n    }\r\n\r\n    return unpackBinaryFrame(dataSet.byteArray, frameOffset, pixelsPerFrame);\r\n  }\r\n\r\n  throw 'unsupported pixel format';\r\n}\r\n\r\nexport default getUncompressedImageFrame;\r\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadouri/getUncompressedImageFrame.js","import $ from 'jquery';\r\nimport parseImageId from './parseImageId';\r\nimport fileManager from './fileManager';\r\n\r\nfunction loadFileRequest (uri) {\r\n  const parsedImageId = parseImageId(uri);\r\n  const fileIndex = parseInt(parsedImageId.url, 10);\r\n  const file = fileManager.get(fileIndex);\r\n\r\n  // create a deferred object\r\n  const deferred = $.Deferred();\r\n\r\n  const fileReader = new FileReader();\r\n\r\n  fileReader.onload = function (e) {\r\n    const dicomPart10AsArrayBuffer = e.target.result;\r\n\r\n    deferred.resolve(dicomPart10AsArrayBuffer);\r\n  };\r\n  fileReader.readAsArrayBuffer(file);\r\n\r\n  return deferred.promise();\r\n}\r\n\r\nexport default loadFileRequest;\r\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadouri/loadFileRequest.js","\r\n\r\nfunction getLutDescriptor (dataSet, tag) {\r\n  if (!dataSet.elements[tag] || dataSet.elements[tag].length !== 6) {\r\n    return;\r\n  }\r\n\r\n  return [dataSet.uint16(tag, 0), dataSet.uint16(tag, 1), dataSet.uint16(tag, 2)];\r\n}\r\n\r\nfunction getLutData (lutDataSet, tag, lutDescriptor) {\r\n  const lut = [];\r\n  const lutData = lutDataSet.elements[tag];\r\n  const numLutEntries = lutDescriptor[0];\r\n\r\n  for (let i = 0; i < numLutEntries; i++) {\r\n    // Output range is always unsigned\r\n    if (lutDescriptor[2] === 16) {\r\n      lut[i] = lutDataSet.uint16(tag, i);\r\n    } else {\r\n      lut[i] = lutDataSet.byteArray[i + lutData.dataOffset];\r\n    }\r\n  }\r\n\r\n  return lut;\r\n}\r\n\r\nfunction populatePaletteColorLut (dataSet, imagePixelModule) {\r\n  // return immediately if no palette lut elements\r\n  if (!dataSet.elements.x00281101) {\r\n    return;\r\n  }\r\n  imagePixelModule.redPaletteColorLookupTableDescriptor = getLutDescriptor(dataSet, 'x00281101');\r\n  imagePixelModule.greenPaletteColorLookupTableDescriptor = getLutDescriptor(dataSet, 'x00281102');\r\n  imagePixelModule.bluePaletteColorLookupTableDescriptor = getLutDescriptor(dataSet, 'x00281103');\r\n\r\n  imagePixelModule.redPaletteColorLookupTableData = getLutData(dataSet, 'x00281201', imagePixelModule.redPaletteColorLookupTableDescriptor);\r\n  imagePixelModule.greenPaletteColorLookupTableData = getLutData(dataSet, 'x00281202', imagePixelModule.greenPaletteColorLookupTableDescriptor);\r\n  imagePixelModule.bluePaletteColorLookupTableData = getLutData(dataSet, 'x00281203', imagePixelModule.bluePaletteColorLookupTableDescriptor);\r\n}\r\n\r\nfunction populateSmallestLargestPixelValues (dataSet, imagePixelModule) {\r\n  const pixelRepresentation = dataSet.uint16('x00280103');\r\n\r\n  if (pixelRepresentation === 0) {\r\n    imagePixelModule.smallestPixelValue = dataSet.uint16('x00280106');\r\n    imagePixelModule.largestPixelValue = dataSet.uint16('x00280107');\r\n  } else {\r\n    imagePixelModule.smallestPixelValue = dataSet.int16('x00280106');\r\n    imagePixelModule.largestPixelValue = dataSet.int16('x00280107');\r\n  }\r\n}\r\n\r\nfunction getImagePixelModule (dataSet) {\r\n\r\n  const imagePixelModule = {\r\n    samplesPerPixel: dataSet.uint16('x00280002'),\r\n    photometricInterpretation: dataSet.string('x00280004'),\r\n    rows: dataSet.uint16('x00280010'),\r\n    columns: dataSet.uint16('x00280011'),\r\n    bitsAllocated: dataSet.uint16('x00280100'),\r\n    bitsStored: dataSet.uint16('x00280101'),\r\n    highBit: dataSet.uint16('x00280102'),\r\n    pixelRepresentation: dataSet.uint16('x00280103'),\r\n    planarConfiguration: dataSet.uint16('x00280006'),\r\n    pixelAspectRatio: dataSet.string('x00280034')\r\n  };\r\n\r\n  populateSmallestLargestPixelValues(dataSet, imagePixelModule);\r\n  populatePaletteColorLut(dataSet, imagePixelModule);\r\n\r\n  return imagePixelModule;\r\n\r\n}\r\n\r\nexport default getImagePixelModule;\r\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadouri/metaData/getImagePixelModule.js","\r\n\r\nfunction getLUT (pixelRepresentation, lutDataSet) {\r\n  let numLUTEntries = lutDataSet.uint16('x00283002', 0);\r\n\r\n  if (numLUTEntries === 0) {\r\n    numLUTEntries = 65535;\r\n  }\r\n  let firstValueMapped = 0;\r\n\r\n  if (pixelRepresentation === 0) {\r\n    firstValueMapped = lutDataSet.uint16('x00283002', 1);\r\n  } else {\r\n    firstValueMapped = lutDataSet.int16('x00283002', 1);\r\n  }\r\n  const numBitsPerEntry = lutDataSet.uint16('x00283002', 2);\r\n  // console.log('LUT(', numLUTEntries, ',', firstValueMapped, ',', numBitsPerEntry, ')');\r\n  const lut = {\r\n    id: '1',\r\n    firstValueMapped,\r\n    numBitsPerEntry,\r\n    lut: []\r\n  };\r\n\r\n  // console.log(\"minValue=\", minValue, \"; maxValue=\", maxValue);\r\n  for (let i = 0; i < numLUTEntries; i++) {\r\n    if (pixelRepresentation === 0) {\r\n      lut.lut[i] = lutDataSet.uint16('x00283006', i);\r\n    } else {\r\n      lut.lut[i] = lutDataSet.int16('x00283006', i);\r\n    }\r\n  }\r\n\r\n  return lut;\r\n}\r\n\r\n\r\nfunction getLUTs (pixelRepresentation, lutSequence) {\r\n  if (!lutSequence || !lutSequence.items.length) {\r\n    return;\r\n  }\r\n  const luts = [];\r\n\r\n  for (let i = 0; i < lutSequence.items.length; i++) {\r\n    const lutDataSet = lutSequence.items[i].dataSet;\r\n    const lut = getLUT(pixelRepresentation, lutDataSet);\r\n\r\n    if (lut) {\r\n      luts.push(lut);\r\n    }\r\n  }\r\n\r\n  return luts;\r\n}\r\n\r\nexport default getLUTs;\r\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadouri/metaData/getLUTs.js","/* eslint no-bitwise: 0 */\r\n\r\nfunction getMinStoredPixelValue (dataSet) {\r\n  const pixelRepresentation = dataSet.uint16('x00280103');\r\n  const bitsStored = dataSet.uint16('x00280101');\r\n\r\n  if (pixelRepresentation === 0) {\r\n    return 0;\r\n  }\r\n\r\n  return -1 << (bitsStored - 1);\r\n}\r\n\r\n// 0 = unsigned / US, 1 = signed / SS\r\nfunction getModalityLUTOutputPixelRepresentation (dataSet) {\r\n\r\n  // CT SOP Classes are always signed\r\n  const sopClassUID = dataSet.string('x00080016');\r\n\r\n  if (sopClassUID === '1.2.840.10008.5.1.4.1.1.2' ||\r\n    sopClassUID === '1.2.840.10008.5.1.4.1.1.2.1') {\r\n    return 1;\r\n  }\r\n\r\n  // if rescale intercept and rescale slope are present, pass the minimum stored\r\n  // pixel value through them to see if we get a signed output range\r\n  const rescaleIntercept = dataSet.floatString('x00281052');\r\n  const rescaleSlope = dataSet.floatString('x00281053');\r\n\r\n  if (rescaleIntercept !== undefined && rescaleSlope !== undefined) {\r\n    const minStoredPixelValue = getMinStoredPixelValue(dataSet); //\r\n    const minModalityLutValue = minStoredPixelValue * rescaleSlope + rescaleIntercept;\r\n\r\n    if (minModalityLutValue < 0) {\r\n      return 1;\r\n    }\r\n\r\n    return 0;\r\n\r\n  }\r\n\r\n  // Output of non linear modality lut is always unsigned\r\n  if (dataSet.elements.x00283000 && dataSet.elements.x00283000.length > 0) {\r\n    return 0;\r\n  }\r\n\r\n  // If no modality lut transform, output is same as pixel representation\r\n  return dataSet.uint16('x00280103');\r\n}\r\n\r\nexport default getModalityLUTOutputPixelRepresentation;\r\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadouri/metaData/getModalityLUTOutputPixelRepresentation.js","function getNumberValues (dataSet, tag, minimumLength) {\r\n  const values = [];\r\n  const valueAsString = dataSet.string(tag);\r\n\r\n  if (!valueAsString) {\r\n    return;\r\n  }\r\n  const split = valueAsString.split('\\\\');\r\n\r\n  if (minimumLength && split.length < minimumLength) {\r\n    return;\r\n  }\r\n  for (let i = 0; i < split.length; i++) {\r\n    values.push(parseFloat(split[i]));\r\n  }\r\n\r\n  return values;\r\n}\r\n\r\nexport default getNumberValues;\r\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadouri/metaData/getNumberValues.js","/* eslint no-bitwise: 0 */\r\n\r\nfunction isBitSet (byte, bitPos) {\r\n  return byte & (1 << bitPos);\r\n}\r\n\r\n/**\r\n * Function to deal with unpacking a binary frame\r\n */\r\nfunction unpackBinaryFrame (byteArray, frameOffset, pixelsPerFrame) {\r\n  // Create a new pixel array given the image size\r\n  const pixelData = new Uint8Array(pixelsPerFrame);\r\n\r\n  for (let i = 0; i < pixelsPerFrame; i++) {\r\n    // Compute byte position\r\n    const bytePos = Math.floor(i / 8);\r\n\r\n    // Get the current byte\r\n    const byte = byteArray[bytePos + frameOffset];\r\n\r\n    // Bit position (0-7) within byte\r\n    const bitPos = (i % 8);\r\n\r\n    // Check whether bit at bitpos is set\r\n    pixelData[i] = isBitSet(byte, bitPos) ? 1 : 0;\r\n  }\r\n\r\n  return pixelData;\r\n}\r\n\r\nexport default unpackBinaryFrame;\r\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadouri/unpackBinaryFrame.js","import { setOptions } from './internal';\r\n\r\nfunction configure (options) {\r\n  setOptions(options);\r\n}\r\n\r\nexport default configure;\r\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/configure.js","import { getNumberString,\r\n         getNumberValue,\r\n         getNumberValues,\r\n         getValue,\r\n         metaDataProvider } from './metaData';\r\n\r\nimport findIndexOfString from './findIndexOfString';\r\nimport getPixelData from './getPixelData';\r\nimport metaDataManager from './metaDataManager';\r\nimport loadImage from './loadImage';\r\n\r\nconst metaData = {\r\n  getNumberString,\r\n  getNumberValue,\r\n  getNumberValues,\r\n  getValue,\r\n  metaDataProvider\r\n};\r\n\r\nexport default {\r\n  metaData,\r\n  findIndexOfString,\r\n  getPixelData,\r\n  loadImage,\r\n  metaDataManager\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadors/index.js","import { getImagePixelModule,\r\n         getLUTs,\r\n         getModalityLUTOutputPixelRepresentation,\r\n         getNumberValues,\r\n         metaDataProvider } from './metaData';\r\n\r\nimport dataSetCacheManager from './dataSetCacheManager';\r\nimport fileManager from './fileManager';\r\nimport getEncapsulatedImageFrame from './getEncapsulatedImageFrame';\r\nimport getUncompressedImageFrame from './getUncompressedImageFrame';\r\nimport loadFileRequest from './loadFileRequest';\r\nimport loadImage from './loadImage';\r\nimport parseImageId from './parseImageId';\r\nimport unpackBinaryFrame from './unpackBinaryFrame';\r\n\r\nconst metaData = {\r\n  getImagePixelModule,\r\n  getLUTs,\r\n  getModalityLUTOutputPixelRepresentation,\r\n  getNumberValues,\r\n  metaDataProvider\r\n};\r\n\r\nexport default {\r\n  metaData,\r\n  dataSetCacheManager,\r\n  fileManager,\r\n  getEncapsulatedImageFrame,\r\n  getUncompressedImageFrame,\r\n  loadFileRequest,\r\n  loadImage,\r\n  parseImageId,\r\n  unpackBinaryFrame\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadouri/index.js","/* eslint no-bitwise: 0 */\r\n\r\nexport default function (imageFrame, rgbaBuffer) {\r\n  const numPixels = imageFrame.columns * imageFrame.rows;\r\n  let palIndex = 0;\r\n  let rgbaIndex = 0;\r\n  const pixelData = imageFrame.pixelData;\r\n  const start = imageFrame.redPaletteColorLookupTableDescriptor[1];\r\n  const rData = imageFrame.redPaletteColorLookupTableData;\r\n  const gData = imageFrame.greenPaletteColorLookupTableData;\r\n  const bData = imageFrame.bluePaletteColorLookupTableData;\r\n  const shift = imageFrame.redPaletteColorLookupTableDescriptor[2] === 8 ? 0 : 8;\r\n  let len = imageFrame.redPaletteColorLookupTableData.length;\r\n\r\n  if (len === 0) {\r\n    len = 65535;\r\n  }\r\n\r\n  for (let i = 0; i < numPixels; ++i) {\r\n    let value = pixelData[palIndex++];\r\n\r\n    if (value < start) {\r\n      value = 0;\r\n    } else if (value > start + len - 1) {\r\n      value = len - 1;\r\n    } else {\r\n      value -= start;\r\n    }\r\n\r\n    rgbaBuffer[rgbaIndex++] = rData[value] >> shift;\r\n    rgbaBuffer[rgbaIndex++] = gData[value] >> shift;\r\n    rgbaBuffer[rgbaIndex++] = bData[value] >> shift;\r\n    rgbaBuffer[rgbaIndex++] = 255;\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/colorSpaceConverters/convertPALETTECOLOR.js","export default function (imageFrame, rgbaBuffer) {\r\n  if (imageFrame === undefined) {\r\n    throw new Error('decodeRGB: rgbBuffer must not be undefined');\r\n  }\r\n  if (imageFrame.length % 3 !== 0) {\r\n    throw new Error('decodeRGB: rgbBuffer length must be divisible by 3');\r\n  }\r\n\r\n  const numPixels = imageFrame.length / 3;\r\n  let rgbIndex = 0;\r\n  let rgbaIndex = 0;\r\n\r\n  for (let i = 0; i < numPixels; i++) {\r\n    rgbaBuffer[rgbaIndex++] = imageFrame[rgbIndex++]; // red\r\n    rgbaBuffer[rgbaIndex++] = imageFrame[rgbIndex++]; // green\r\n    rgbaBuffer[rgbaIndex++] = imageFrame[rgbIndex++]; // blue\r\n    rgbaBuffer[rgbaIndex++] = 255; // alpha\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/colorSpaceConverters/convertRGBColorByPixel.js","export default function (imageFrame, rgbaBuffer) {\r\n  if (imageFrame === undefined) {\r\n    throw new Error('decodeRGB: rgbBuffer must not be undefined');\r\n  }\r\n  if (imageFrame.length % 3 !== 0) {\r\n    throw new Error('decodeRGB: rgbBuffer length must be divisible by 3');\r\n  }\r\n\r\n  const numPixels = imageFrame.length / 3;\r\n  let rgbaIndex = 0;\r\n  let rIndex = 0;\r\n  let gIndex = numPixels;\r\n  let bIndex = numPixels * 2;\r\n\r\n  for (let i = 0; i < numPixels; i++) {\r\n    rgbaBuffer[rgbaIndex++] = imageFrame[rIndex++]; // red\r\n    rgbaBuffer[rgbaIndex++] = imageFrame[gIndex++]; // green\r\n    rgbaBuffer[rgbaIndex++] = imageFrame[bIndex++]; // blue\r\n    rgbaBuffer[rgbaIndex++] = 255; // alpha\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/colorSpaceConverters/convertRGBColorByPlane.js","export default function (imageFrame, rgbaBuffer) {\r\n  if (imageFrame === undefined) {\r\n    throw new Error('decodeRGB: ybrBuffer must not be undefined');\r\n  }\r\n  if (imageFrame.length % 3 !== 0) {\r\n    throw new Error('decodeRGB: ybrBuffer length must be divisble by 3');\r\n  }\r\n\r\n  const numPixels = imageFrame.length / 3;\r\n  let ybrIndex = 0;\r\n  let rgbaIndex = 0;\r\n\r\n  for (let i = 0; i < numPixels; i++) {\r\n    const y = imageFrame[ybrIndex++];\r\n    const cb = imageFrame[ybrIndex++];\r\n    const cr = imageFrame[ybrIndex++];\r\n\r\n    rgbaBuffer[rgbaIndex++] = y + 1.40200 * (cr - 128);// red\r\n    rgbaBuffer[rgbaIndex++] = y - 0.34414 * (cb - 128) - 0.71414 * (cr - 128); // green\r\n    rgbaBuffer[rgbaIndex++] = y + 1.77200 * (cb - 128); // blue\r\n    rgbaBuffer[rgbaIndex++] = 255; // alpha\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/colorSpaceConverters/convertYBRFullByPixel.js","export default function (imageFrame, rgbaBuffer) {\r\n  if (imageFrame === undefined) {\r\n    throw new Error('decodeRGB: ybrBuffer must not be undefined');\r\n  }\r\n  if (imageFrame.length % 3 !== 0) {\r\n    throw new Error('decodeRGB: ybrBuffer length must be divisble by 3');\r\n  }\r\n\r\n  const numPixels = imageFrame.length / 3;\r\n  let rgbaIndex = 0;\r\n  let yIndex = 0;\r\n  let cbIndex = numPixels;\r\n  let crIndex = numPixels * 2;\r\n\r\n  for (let i = 0; i < numPixels; i++) {\r\n    const y = imageFrame[yIndex++];\r\n    const cb = imageFrame[cbIndex++];\r\n    const cr = imageFrame[crIndex++];\r\n\r\n    rgbaBuffer[rgbaIndex++] = y + 1.40200 * (cr - 128);// red\r\n    rgbaBuffer[rgbaIndex++] = y - 0.34414 * (cb - 128) - 0.71414 * (cr - 128); // green\r\n    rgbaBuffer[rgbaIndex++] = y + 1.77200 * (cb - 128); // blue\r\n    rgbaBuffer[rgbaIndex++] = 255; // alpha\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/colorSpaceConverters/convertYBRFullByPlane.js","export * from './colorSpaceConverters';\n\nexport { default as wadouri } from './wadouri';\nexport { default as wadors } from './wadors';\nexport { default as configure } from './configure';\nexport { default as convertColorSpace } from './convertColorSpace';\nexport { default as createImage } from './createImage';\nexport { default as decodeImageFrame } from './decodeImageFrame';\nexport { default as decodeJPEGBaseline8BitColor } from './decodeJPEGBaseline8BitColor';\nexport { default as getImageFrame } from './getImageFrame';\nexport { default as getMinMax } from './getMinMax';\nexport { default as isColorImage } from './isColorImage';\nexport { default as isJPEGBaseline8BitColor } from './isJPEGBaseline8BitColor';\nexport { default as webWorkerManager } from './webWorkerManager';\nexport { default as version } from '../version';\nexport { internal } from './internal/';\n\nexport { default as events } from './events.js';\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/index.js","import $ from 'jquery';\r\nimport { getOptions } from './options';\r\nimport * as cornerstone from 'cornerstone-core';\r\n\r\nfunction xhrRequest (url, imageId, headers = {}) {\r\n  const deferred = $.Deferred();\r\n  const options = getOptions();\r\n\r\n  // Make the request for the DICOM P10 SOP Instance\r\n  const xhr = new XMLHttpRequest();\r\n\r\n  xhr.open('get', url, true);\r\n  xhr.responseType = 'arraybuffer';\r\n  options.beforeSend(xhr);\r\n  Object.keys(headers).forEach(function (key) {\r\n    xhr.setRequestHeader(key, headers[key]);\r\n  });\r\n\r\n  // handle response data\r\n  xhr.onreadystatechange = function () {\r\n    // TODO: consider sending out progress messages here as we receive the pixel data\r\n    if (xhr.readyState === 4) {\r\n      if (xhr.status === 200) {\r\n        deferred.resolve(xhr.response, xhr);\r\n      } else {\r\n        // request failed, reject the deferred\r\n        deferred.reject(xhr);\r\n      }\r\n    }\r\n  };\r\n  xhr.onprogress = function (oProgress) {\r\n    // console.log('progress:',oProgress)\r\n\r\n    if (oProgress.lengthComputable) {  // evt.loaded the bytes browser receive\r\n      // evt.total the total bytes seted by the header\r\n      //\r\n      const loaded = oProgress.loaded;\r\n      const total = oProgress.total;\r\n      const percentComplete = Math.round((loaded / total) * 100);\r\n\r\n      $(cornerstone.events).trigger('CornerstoneImageLoadProgress', {\r\n        imageId,\r\n        loaded,\r\n        total,\r\n        percentComplete\r\n      });\r\n    }\r\n  };\r\n\r\n  xhr.send();\r\n\r\n  return deferred.promise();\r\n}\r\n\r\nexport default xhrRequest;\r\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/internal/xhrRequest.js","import $ from 'jquery';\r\nimport * as cornerstone from 'cornerstone-core';\r\nimport metaDataManager from './metaDataManager';\r\nimport getPixelData from './getPixelData';\r\nimport createImage from '../createImage';\r\n\r\nfunction getTransferSyntaxForContentType (/* contentType */) {\r\n  return '1.2.840.10008.1.2'; // hard code to ILE for now\r\n}\r\n\r\nfunction loadImage (imageId, options) {\r\n  const start = new Date().getTime();\r\n\r\n  const deferred = $.Deferred();\r\n\r\n  const uri = imageId.substring(7);\r\n\r\n  // check to make sure we have metadata for this imageId\r\n  const metaData = metaDataManager.get(imageId);\r\n\r\n  if (metaData === undefined) {\r\n    deferred.reject(`no metadata for imageId ${imageId}`);\r\n\r\n    return deferred.promise();\r\n  }\r\n\r\n  // TODO: load bulk data items that we might need\r\n\r\n  const mediaType = 'multipart/related; type=\"application/octet-stream\"'; // 'image/dicom+jp2';\r\n\r\n  // get the pixel data from the server\r\n  getPixelData(uri, imageId, mediaType).then(function (result) {\r\n\r\n    const transferSyntax = getTransferSyntaxForContentType(result.contentType);\r\n    const pixelData = result.imageFrame.pixelData;\r\n    const imagePromise = createImage(imageId, pixelData, transferSyntax, options);\r\n\r\n    imagePromise.then(function (image) {\r\n      // add the loadTimeInMS property\r\n      const end = new Date().getTime();\r\n\r\n      image.loadTimeInMS = end - start;\r\n      deferred.resolve(image);\r\n    });\r\n  }).fail(function (reason) {\r\n    deferred.reject(reason);\r\n  });\r\n\r\n  return deferred;\r\n}\r\n\r\n// register wadors scheme\r\ncornerstone.registerImageLoader('wadors', loadImage);\r\n\r\nexport default loadImage;\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadors/loadImage.js","import getValue from './getValue';\r\n\r\n/**\r\n * Returns the first string value as a Javascript number\r\n *\r\n * @param element - The javascript object for the specified element in the metadata\r\n * @param [index] - the index of the value in a multi-valued element, default is 0\r\n * @param [defaultValue] - The default value to return if the element does not exist\r\n * @returns {*}\r\n */\r\nfunction getNumberString (element, index, defaultValue) {\r\n  const value = getValue(element, index, defaultValue);\r\n\r\n  if (value === undefined) {\r\n    return;\r\n  }\r\n\r\n  return parseFloat(value);\r\n}\r\n\r\nexport default getNumberString;\r\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadors/metaData/getNumberString.js","export { default as getNumberString } from './getNumberString';\r\nexport { default as getNumberValue } from './getNumberValue';\r\nexport { default as getNumberValues } from './getNumberValues';\r\nexport { default as getValue } from './getValue';\r\nexport { default as metaDataProvider } from './metaDataProvider';\r\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadors/metaData/index.js","import getNumberValues from './getNumberValues';\r\nimport getValue from './getValue';\r\nimport getNumberValue from './getNumberValue';\r\nimport metaDataManager from '../metaDataManager';\r\nimport * as dicomParser from 'dicom-parser';\r\nimport * as cornerstone from 'cornerstone-core';\r\n\r\nfunction metaDataProvider (type, imageId) {\r\n  const metaData = metaDataManager.get(imageId);\r\n\r\n  if (!metaData) {\r\n    return;\r\n  }\r\n\r\n  if (type === 'generalSeriesModule') {\r\n    return {\r\n      modality: getValue(metaData['00080060']),\r\n      seriesInstanceUID: getValue(metaData['0020000e']),\r\n      seriesNumber: getNumberValue(metaData['00200011']),\r\n      studyInstanceUID: getValue(metaData['0020000d']),\r\n      seriesDate: dicomParser.parseDA(getValue(metaData['00080021'])),\r\n      seriesTime: dicomParser.parseTM(getValue(metaData['00080031'], 0, ''))\r\n    };\r\n  }\r\n\r\n  if (type === 'patientStudyModule') {\r\n    return {\r\n      patientAge: getNumberValue(metaData['00101010']),\r\n      patientSize: getNumberValue(metaData['00101020']),\r\n      patientWeight: getNumberValue(metaData['00101030'])\r\n    };\r\n  }\r\n\r\n  if (type === 'imagePlaneModule') {\r\n    return {\r\n      pixelSpacing: getNumberValues(metaData['00280030'], 2),\r\n      imageOrientationPatient: getNumberValues(metaData['00200037'], 6),\r\n      imagePositionPatient: getNumberValues(metaData['00200032'], 3),\r\n      sliceThickness: getNumberValue(metaData['00180050']),\r\n      sliceLocation: getNumberValue(metaData['00201041'])\r\n    };\r\n  }\r\n\r\n  if (type === 'imagePixelModule') {\r\n    return {\r\n      samplesPerPixel: getNumberValue(metaData['00280002']),\r\n      photometricInterpretation: getValue(metaData['00280004']),\r\n      rows: getNumberValue(metaData['00280010']),\r\n      columns: getNumberValue(metaData['00280011']),\r\n      bitsAllocated: getNumberValue(metaData['00280100']),\r\n      bitsStored: getNumberValue(metaData['00280101']),\r\n      highBit: getValue(metaData['00280102']),\r\n      pixelRepresentation: getNumberValue(metaData['00280103']),\r\n      planarConfiguration: getNumberValue(metaData['00280006']),\r\n      pixelAspectRatio: getValue(metaData['00280034']),\r\n      smallestPixelValue: getNumberValue(metaData['00280106']),\r\n      largestPixelValue: getNumberValue(metaData['00280107']),\r\n      redPaletteColorLookupTableDescriptor: getNumberValues(metaData['00281101']),\r\n      greenPaletteColorLookupTableDescriptor: getNumberValues(metaData['00281102']),\r\n      bluePaletteColorLookupTableDescriptor: getNumberValues(metaData['00281103']),\r\n      redPaletteColorLookupTableData: getNumberValues(metaData['00281201']),\r\n      greenPaletteColorLookupTableData: getNumberValues(metaData['00281202']),\r\n      bluePaletteColorLookupTableData: getNumberValues(metaData['00281203'])\r\n    };\r\n  }\r\n\r\n  if (type === 'voiLutModule') {\r\n    return {\r\n      // TODO VOT LUT Sequence\r\n      windowCenter: getNumberValues(metaData['00281050'], 1),\r\n      windowWidth: getNumberValues(metaData['00281051'], 1)\r\n    };\r\n  }\r\n\r\n  if (type === 'modalityLutModule') {\r\n    return {\r\n      // TODO VOT LUT Sequence\r\n      rescaleIntercept: getNumberValue(metaData['00281052']),\r\n      rescaleSlope: getNumberValue(metaData['00281053']),\r\n      rescaleType: getValue(metaData['00281054'])\r\n    };\r\n  }\r\n\r\n  if (type === 'sopCommonModule') {\r\n    return {\r\n      sopClassUID: getValue(metaData['00080016']),\r\n      sopInstanceUID: getValue(metaData['00080018'])\r\n    };\r\n  }\r\n\r\n  if (type === 'petIsotopeModule') {\r\n    const radiopharmaceuticalInfo = getValue(metaData['00540016']);\r\n\r\n    if (radiopharmaceuticalInfo === undefined) {\r\n      return;\r\n    }\r\n\r\n    return {\r\n      radiopharmaceuticalInfo: {\r\n        radiopharmaceuticalStartTime: dicomParser.parseTM(getValue(radiopharmaceuticalInfo['00181072'], 0, '')),\r\n        radionuclideTotalDose: getNumberValue(radiopharmaceuticalInfo['00181074']),\r\n        radionuclideHalfLife: getNumberValue(radiopharmaceuticalInfo['00181075'])\r\n      }\r\n    };\r\n  }\r\n\r\n}\r\n\r\ncornerstone.metaData.addProvider(metaDataProvider);\r\n\r\nexport default metaDataProvider;\r\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadors/metaData/metaDataProvider.js","import $ from 'jquery';\r\nimport * as cornerstone from 'cornerstone-core';\r\nimport createImage from '../createImage';\r\nimport parseImageId from './parseImageId';\r\nimport dataSetCacheManager from './dataSetCacheManager';\r\nimport getEncapsulatedImageFrame from './getEncapsulatedImageFrame';\r\nimport getUncompressedImageFrame from './getUncompressedImageFrame';\r\nimport loadFileRequest from './loadFileRequest';\r\nimport { xhrRequest } from '../internal';\r\n\r\n// add a decache callback function to clear out our dataSetCacheManager\r\nfunction addDecache (image) {\r\n  image.decache = function () {\r\n    // console.log('decache');\r\n    const parsedImageId = parseImageId(image.imageId);\r\n\r\n    dataSetCacheManager.unload(parsedImageId.url);\r\n  };\r\n}\r\n\r\nfunction getPixelData (dataSet, frameIndex) {\r\n  const pixelDataElement = dataSet.elements.x7fe00010;\r\n\r\n  if (pixelDataElement.encapsulatedPixelData) {\r\n    return getEncapsulatedImageFrame(dataSet, frameIndex);\r\n  }\r\n\r\n  return getUncompressedImageFrame(dataSet, frameIndex);\r\n\r\n}\r\n\r\nfunction loadImageFromPromise (dataSetPromise, imageId, frame, sharedCacheKey, options) {\r\n\r\n  const start = new Date().getTime();\r\n\r\n  frame = frame || 0;\r\n  const deferred = $.Deferred();\r\n\r\n  dataSetPromise.then(function (dataSet/* , xhr*/) {\r\n    const pixelData = getPixelData(dataSet, frame);\r\n    const transferSyntax = dataSet.string('x00020010');\r\n    const loadEnd = new Date().getTime();\r\n    const imagePromise = createImage(imageId, pixelData, transferSyntax, options);\r\n\r\n    imagePromise.then(function (image) {\r\n      image.data = dataSet;\r\n      const end = new Date().getTime();\r\n\r\n      image.loadTimeInMS = loadEnd - start;\r\n      image.totalTimeInMS = end - start;\r\n      addDecache(image);\r\n      deferred.resolve(image);\r\n    });\r\n  }, function (error) {\r\n    deferred.reject(error);\r\n  });\r\n\r\n  return deferred;\r\n}\r\n\r\nfunction getLoaderForScheme (scheme) {\r\n  if (scheme === 'dicomweb' || scheme === 'wadouri') {\r\n    return xhrRequest;\r\n  } else if (scheme === 'dicomfile') {\r\n    return loadFileRequest;\r\n  }\r\n}\r\n\r\nfunction loadImage (imageId, options) {\r\n  const parsedImageId = parseImageId(imageId);\r\n  const loader = getLoaderForScheme(parsedImageId.scheme);\r\n\r\n  // if the dataset for this url is already loaded, use it\r\n  if (dataSetCacheManager.isLoaded(parsedImageId.url)) {\r\n    return loadImageFromPromise(dataSetCacheManager.load(parsedImageId.url, loader, imageId), imageId, parsedImageId.frame, parsedImageId.url, options);\r\n  }\r\n\r\n  // load the dataSet via the dataSetCacheManager\r\n  return loadImageFromPromise(dataSetCacheManager.load(parsedImageId.url, loader, imageId), imageId, parsedImageId.frame, parsedImageId.url, options);\r\n}\r\n\r\n// register dicomweb and wadouri image loader prefixes\r\ncornerstone.registerImageLoader('dicomweb', loadImage);\r\ncornerstone.registerImageLoader('wadouri', loadImage);\r\ncornerstone.registerImageLoader('dicomfile', loadImage);\r\n\r\nexport default loadImage;\r\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadouri/loadImage.js","export { default as getImagePixelModule } from './getImagePixelModule';\r\nexport { default as getLUTs } from './getLUTs';\r\nexport { default as getModalityLUTOutputPixelRepresentation } from './getModalityLUTOutputPixelRepresentation';\r\nexport { default as getNumberValues } from './getNumberValues';\r\nexport { default as metaDataProvider } from './metaDataProvider';\r\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadouri/metaData/index.js","import getNumberValues from './getNumberValues';\r\nimport parseImageId from '../parseImageId';\r\nimport dataSetCacheManager from '../dataSetCacheManager';\r\nimport getImagePixelModule from './getImagePixelModule';\r\nimport getLUTs from './getLUTs';\r\nimport getModalityLUTOutputPixelRepresentation from './getModalityLUTOutputPixelRepresentation';\r\nimport * as dicomParser from 'dicom-parser';\r\nimport * as cornerstone from 'cornerstone-core';\r\n\r\nfunction metaDataProvider (type, imageId) {\r\n  const parsedImageId = parseImageId(imageId);\r\n\r\n  const dataSet = dataSetCacheManager.get(parsedImageId.url);\r\n\r\n  if (!dataSet) {\r\n    return;\r\n  }\r\n\r\n  if (type === 'generalSeriesModule') {\r\n    return {\r\n      modality: dataSet.string('x00080060'),\r\n      seriesInstanceUID: dataSet.string('x0020000e'),\r\n      seriesNumber: dataSet.intString('x00200011'),\r\n      studyInstanceUID: dataSet.string('x0020000d'),\r\n      seriesDate: dicomParser.parseDA(dataSet.string('x00080021')),\r\n      seriesTime: dicomParser.parseTM(dataSet.string('x00080031') || '')\r\n    };\r\n  }\r\n\r\n  if (type === 'patientStudyModule') {\r\n    return {\r\n      patientAge: dataSet.intString('x00101010'),\r\n      patientSize: dataSet.floatString('x00101020'),\r\n      patientWeight: dataSet.floatString('x00101030')\r\n    };\r\n  }\r\n\r\n  if (type === 'imagePlaneModule') {\r\n    return {\r\n      pixelSpacing: getNumberValues(dataSet, 'x00280030', 2),\r\n      imageOrientationPatient: getNumberValues(dataSet, 'x00200037', 6),\r\n      imagePositionPatient: getNumberValues(dataSet, 'x00200032', 3),\r\n      sliceThickness: dataSet.floatString('x00180050'),\r\n      sliceLocation: dataSet.floatString('x00201041'),\r\n      frameOfReferenceUID: dataSet.string('x00200052')\r\n    };\r\n  }\r\n\r\n  if (type === 'imagePixelModule') {\r\n    return getImagePixelModule(dataSet);\r\n  }\r\n\r\n  if (type === 'modalityLutModule') {\r\n    return {\r\n      rescaleIntercept: dataSet.floatString('x00281052'),\r\n      rescaleSlope: dataSet.floatString('x00281053'),\r\n      rescaleType: dataSet.string('x00281054'),\r\n      modalityLUTSequence: getLUTs(dataSet.uint16('x00280103'), dataSet.elements.x00283000)\r\n    };\r\n  }\r\n\r\n  if (type === 'voiLutModule') {\r\n    const modalityLUTOutputPixelRepresentation = getModalityLUTOutputPixelRepresentation(dataSet);\r\n\r\n\r\n    return {\r\n      windowCenter: getNumberValues(dataSet, 'x00281050', 1),\r\n      windowWidth: getNumberValues(dataSet, 'x00281051', 1),\r\n      voiLUTSequence: getLUTs(modalityLUTOutputPixelRepresentation, dataSet.elements.x00283010)\r\n    };\r\n  }\r\n\r\n  if (type === 'sopCommonModule') {\r\n    return {\r\n      sopClassUID: dataSet.string('x00080016'),\r\n      sopInstanceUID: dataSet.string('x00080018')\r\n    };\r\n  }\r\n\r\n  if (type === 'petIsotopeModule') {\r\n    const radiopharmaceuticalInfo = dataSet.elements.x00540016;\r\n\r\n    if (radiopharmaceuticalInfo === undefined) {\r\n      return;\r\n    }\r\n\r\n    const firstRadiopharmaceuticalInfoDataSet = radiopharmaceuticalInfo.items[0].dataSet;\r\n\r\n\r\n    return {\r\n      radiopharmaceuticalInfo: {\r\n        radiopharmaceuticalStartTime: dicomParser.parseTM(firstRadiopharmaceuticalInfoDataSet.string('x00181072') || ''),\r\n        radionuclideTotalDose: firstRadiopharmaceuticalInfoDataSet.floatString('x00181074'),\r\n        radionuclideHalfLife: firstRadiopharmaceuticalInfoDataSet.floatString('x00181075')\r\n      }\r\n    };\r\n  }\r\n\r\n}\r\n\r\n// register our metadata provider\r\ncornerstone.metaData.addProvider(metaDataProvider);\r\n\r\nexport default metaDataProvider;\r\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadouri/metaData/metaDataProvider.js"],"sourceRoot":""}